var e,t,n,i,r,o,a,s;s=["ask-concurrent","beep","display","export-interface","file-close","file-close-all","file-delete","file-flush","file-open","file-print","file-show","file-type","file-write","hubnet-broadcast","hubnet-broadcast-clear-output","hubnet-broadcast-message","hubnet-clear-override","hubnet-clear-overrides","hubnet-kick-all-clients","hubnet-kick-client","hubnet-fetch-message","hubnet-reset","hubnet-reset-perspective","hubnet-send","hubnet-send-clear-output","hubnet-send-follow","hubnet-send-message","hubnet-send-override","hubnet-send-watch","inspect","no-display","set-current-directory","file-at-end\\?","file-exists\\?","file-read","file-read-characters","file-read-line","hubnet-clients-list","hubnet-enter-message\\?","hubnet-exit-message\\?","hubnet-message","hubnet-message-source","hubnet-message-tag","hubnet-message-waiting\\?","movie-status","user-directory","user-file","user-new-file","user-one-of"];var l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E,S,A,T,P={all:[].concat(e=["__apply","__bench","__change-topology","__done","__experimentstepend","__export-drawing","__foreverbuttonend","__ignore","__let","__linkcode","__make-preview","__mkdir","__observercode","__patchcode","__plot-pen-hide","__plot-pen-show","__pwd","__reload-extensions","__set-line-thickness","__stderr","__stdout","__thunk-did-finish","__turtlecode","ask","ask-concurrent","auto-plot-off","auto-plot-on","back","beep","bk","ca","carefully","cd","clear-all","clear-all-plots","clear-drawing","clear-globals","clear-links","clear-output","clear-patches","clear-plot","clear-ticks","clear-turtles","cp","create-link-from","create-link-to","create-link-with","create-links-from","create-links-to","create-links-with","create-ordered-turtles","create-temporary-plot-pen","create-turtles","cro","crt","ct","die","diffuse","diffuse4","display","downhill","downhill4","error","every","export-all-plots","export-interface","export-output","export-plot","export-view","export-world","face","facexy","fd","file-close","file-close-all","file-delete","file-flush","file-open","file-print","file-show","file-type","file-write","follow","follow-me","foreach","forward","hatch","hide-link","hide-turtle","histogram","home","ht","hubnet-broadcast","hubnet-broadcast-clear-output","hubnet-broadcast-message","hubnet-clear-override","hubnet-clear-overrides","hubnet-kick-all-clients","hubnet-kick-client","hubnet-fetch-message","hubnet-reset","hubnet-reset-perspective","hubnet-send","hubnet-send-clear-output","hubnet-send-follow","hubnet-send-message","hubnet-send-override","hubnet-send-watch","if","if-else","ifelse","import-drawing","import-pcolors","import-pcolors-rgb","import-world","inspect","jump","layout-circle","layout-radial","layout-spring","layout-tutte","left","let","loop","lt","move-to","no-display","output-print","output-show","output-type","output-write","pd","pe","pen-down","pen-erase","pen-up","pendown","penup","plot","plot-pen-down","plot-pen-reset","plot-pen-up","plotxy","print","pu","random-seed","repeat","report","reset-perspective","reset-ticks","reset-timer","resize-world","ride","ride-me","right","rp","rt","run","set","set-current-directory","set-current-plot","set-current-plot-pen","set-default-shape","set-histogram-num-bars","set-patch-size","set-plot-background-color","set-plot-pen-color","set-plot-pen-interval","set-plot-pen-mode","set-plot-x-range","set-plot-y-range","setup-plots","setxy","show","show-link","show-turtle","sprout","st","stamp","stamp-erase","stop","stop-inspecting","stop-inspecting-dead-agents","tick","tick-advance","tie","type","untie","update-plots","uphill","uphill4","user-message","wait","watch","watch-me","while","with-local-randomness","without-interruption","write"],t=["TRUE","FALSE","NOBODY","E","PI","gray","grey","red","orange","brown","yellow","green","lime","turquoise","cyan","sky","blue","violet","magenta","pink","black","white"],n=["BREED","TO","TO-REPORT","END","GLOBALS","TURTLES-OWN","LINKS-OWN","PATCHES-OWN","DIRECTED-LINK-BREED","UNDIRECTED-LINK-BREED","EXTENSIONS","__INCLUDES"],i=["END1","END2","COLOR","LABEL","LABEL-COLOR","HIDDEN\\?","BREED","THICKNESS","SHAPE","TIE-MODE"],r=["PXCOR","PYCOR","PCOLOR","PLABEL","PLABEL-COLOR"],o=["!=","\\*","\\+","-","/","<","<=","=",">",">=","\\^","__apply-result","__boom","__check-syntax","__dump","__dump-extension-prims","__dump-extensions","__dump1","__hubnet-in-q-size","__hubnet-out-q-size","__nano-time","__patchcol","__patchrow","__processors","__random-state","__stack-trace","__to-string","abs","acos","all\\?","and","any\\?","approximate-hsb","approximate-rgb","asin","at-points","atan","autoplot\\?","base-colors","behaviorspace-experiment-name","behaviorspace-run-number","bf","bl","both-ends","but-first","but-last","butfirst","butlast","can-move\\?","ceiling","cos","count","date-and-time","distance","distance-nowrap","distancexy","distancexy-nowrap","dx","dy","empty\\?","end1","end2","error-message","exp","extract-hsb","extract-rgb","file-at-end\\?","file-exists\\?","file-read","file-read-characters","file-read-line","filter","first","floor","fput","hsb","hubnet-clients-list","hubnet-enter-message\\?","hubnet-exit-message\\?","hubnet-message","hubnet-message-source","hubnet-message-tag","hubnet-message-waiting\\?","ifelse-value","in-cone","in-cone-nowrap","in-link-from","in-link-neighbor\\?","in-link-neighbors","in-radius","in-radius-nowrap","insert-item","int","is-agent\\?","is-agentset\\?","is-anonymous-command\\?","is-anonymous-reporter\\?","is-boolean\\?","is-command-task\\?","is-directed-link\\?","is-link-set\\?","is-link\\?","is-list\\?","is-number\\?","is-patch-set\\?","is-patch\\?","is-reporter-task\\?","is-string\\?","is-turtle-set\\?","is-turtle\\?","is-undirected-link\\?","item","last","length","link","link-heading","link-length","link-neighbor\\?","link-neighbors","link-set","link-shapes","link-with","links","list","ln","log","lput","map","max","max-n-of","max-one-of","max-pxcor","max-pycor","mean","median","member\\?","min","min-n-of","min-one-of","min-pxcor","min-pycor","mod","modes","mouse-down\\?","mouse-inside\\?","mouse-xcor","mouse-ycor","movie-status","my-in-links","my-links","my-out-links","myself","n-of","n-values","neighbors","neighbors4","netlogo-applet\\?","netlogo-version","netlogo-web\\?","new-seed","no-links","no-patches","no-turtles","not","of","one-of","or","other","other-end","out-link-neighbor\\?","out-link-neighbors","out-link-to","patch","patch-ahead","patch-at","patch-at-heading-and-distance","patch-here","patch-left-and-ahead","patch-right-and-ahead","patch-set","patch-size","patches","plot-name","plot-pen-exists\\?","plot-x-max","plot-x-min","plot-y-max","plot-y-min","position","precision","random","random-exponential","random-float","random-gamma","random-normal","random-or-random-float","random-poisson","random-pxcor","random-pycor","random-xcor","random-ycor","range","read-from-string","reduce","remainder","remove","remove-duplicates","remove-item","replace-item","reverse","rgb","round","run-result","runresult","scale-color","se","self","sentence","shade-of\\?","shapes","shuffle","sin","sort","sort-by","sort-on","sqrt","standard-deviation","subject","sublist","substring","subtract-headings","sum","tan","task","ticks","timer","towards","towards-nowrap","towardsxy","towardsxy-nowrap","turtle","turtle-set","turtles","turtles-at","turtles-here","turtles-on","user-directory","user-file","user-input","user-new-file","user-one-of","user-yes-or-no\\?","value-from","values-from","variance","with","with-max","with-min","word","world-height","world-width","wrap-color","xor"],a=["WHO","COLOR","HEADING","XCOR","YCOR","SHAPE","LABEL","LABEL-COLOR","BREED","HIDDEN\\?","SIZE","PEN-SIZE","PEN-MODE"]).map((function(e){return e.toLowerCase()})),commands:e,constants:t,directives:n,linkVars:i,patchVars:r,reporters:o,turtleVars:a,unsupported:s};({commands:c,constants:p,directives:f,linkVars:g,patchVars:w,reporters:y,turtleVars:b}=P),k=/[^\s\[\(\]\)]/.source,_=`(?=${/[\s\[\(\]\)]/.source}|$)`,C=function(e){return new RegExp(`${e}${_}`,"i")},u={token:"comment",regex:/;.*/},h={token:"constant",regex:(m=function(e){return C(`(?:${e.join("|")})`)})(p)},v={regex:/[\[\(]/,indent:!0},d={regex:/[\]\)]/,dedent:!0},x={token:"variable",regex:new RegExp(k+"+")},l=[].concat(y,b,w,g).reverse(),CodeMirror.defineSimpleMode("netlogo",{start:[{token:"keyword",regex:C("to(?:-report)?"),indent:!0},{token:"keyword",regex:C("end"),dedent:!0},{token:"keyword",regex:m(f)},{token:"keyword",regex:C(`${k}*-own`)},{token:"command",regex:m(c.reverse())},{token:"reporter",regex:m(l)},{token:"string",regex:/"(?:[^\\]|\\.)*?"/},{token:"number",regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i},h,u,v,d,x],meta:{electricChars:"dD])\n",lineComment:";"}}),({isSomething:S,toArray:T}=tortoise_require("brazier/maybe")),E=class e{constructor(e,t){var n,i;this.findConsole=function(){return null},i=(e,t)=>this.isLinkableProcedure(e,t),n=(e,t)=>this.isKnownProcedure(e,t),this._ractive=new Ractive({el:e,template:A,data:{isActive:!1,isDismissable:!0,isStandalone:t,message:void 0,title:void 0,frames:void 0},on:{show:function(e,t,n,i){this.get("isActive")?(this.set("title",`${this.get("title")} / ${t}`),this.set("message",`${this.get("message")}<br/><br/>Next message: ${n}`)):(this.set("title",t),this.set("message",n),this.set("frames",i),this.set("isActive",!0))},hide:function(){this.set("isDismissable",!0),this.set("isActive",!1)},"*.copy-message":function(e){var t;t=this.find("#alert-message"),navigator.clipboard.writeText(null!=t?t.innerText:void 0)}},isLinkableProcedure:i,isKnownProcedure:n})}static makeRemoteLoadErrorMessage(e){return`Unable to load NetLogo model from ${e}, please ensure:\n<ul>\n  <li>That you can download the resource <a target="_blank" href="${e}">at the link given for it.</a></li>\n  <li>That the server containing the resource has\n    <a target="_blank" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">\n      Cross-Origin Resource Sharing\n    </a>\n    configured appropriately</li>\n</ul>\nIf you have followed the above steps and are still seeing this error,\nplease send an email to our <a href="mailto:bugs@ccl.northwestern.edu">"bugs" mailing list</a>\nwith the following information:\n<ul>\n  <li>The full URL of this page (copy and paste from address bar)</li>\n  <li>Your operating system and browser version</li>\n</ul>`}static makeCompilerErrorMessage(e){var t;return t=function(e,t){return e.indexOf(t)>-1},e.map((function(e){return"string"==typeof e?e:null!=e.message&&(t(e.message,"Couldn't find corresponding reader")||t(e.message,"Models must have 12 sections"))?("https://netlogoweb.org/docs/faq#model-format-error",`${e.message} (see <a href='https://netlogoweb.org/docs/faq#model-format-error'>here</a> for more information)`):null!=e.lineNumber?`(Line ${e.lineNumber}) ${e.message}`:e.message}))}static makeBareFrameError(e){switch(e.type){case"command":return`called by command ${e.name.toUpperCase()}`;case"reporter":return`called by reporter ${e.name.toUpperCase()}`;case"plot":return`called by plot ${e.name}`;default:return"called by unknown"}}static makeBareRuntimeErrorMessage(e,t,n,i,r){var o;return`${e}\nerror while running ${""===t?"a primitive":t.toUpperCase()}${S(n)?(o=T(n)[0],` on line ${r.slice(0,o).split("\n").length}`):""}`}static makeLinkedRuntimeErrorMessage(e,t,n,i){var r;return r=""===t?"a primitive":t.toUpperCase(),`${e}\nerror while running ${S(n)&&S(i)?`<a href='/ignore' onclick='${`this.parentElement._ractive.proxy.ractive.fire("jump-to-code", ${T(n)[0]}, ${T(i)[0]}); return false;`}'>${r}</a>`:r}`}static makeTypeErrorMessage(e){return`A type error has occurred in the simulation engine.\nMore information about these sorts of errors can be found\n<a href="https://netlogoweb.org/docs/faq#type-errors">here</a>.<br><br>\nAdvanced users might find the generated error helpful, which is as follows:<br><br>\n<b>${e}</b><br><br>`}static makeProtocolErrorMessage(e,t,n){return`<p>The linked model protocol is insecure (HTTP) but the NetLogo Web page is secure (HTTPS),\nso the model cannot be loaded as specified.</p>\n<p>You can try to load the model securely by changing to the below link, but it assumes the default\nsecure port for the model's host, which may not be correct.</p>\n<p>Original model link: ${e}</p>\n<p>New model link to try: ${null==n?t:`<a href="${n}">${t}</a>`}</p>\n<ul>`}listenForErrors(e){this.findConsole=function(){return e.ractive.findComponent("console")},this._ractive.off("jump-to-procedure"),this._ractive.on("jump-to-procedure",(function(t,n){return this.fire("hide"),e.jumpToProcedure(n),!1})),this._ractive.off("jump-to-code"),this._ractive.on("jump-to-code",(function(t,n,i){return this.fire("hide"),e.jumpToCode(n,i),!1})),e.ractive.on("*.nlw-notify",((e,t)=>this.reportNotification(t))),e.ractive.on("*.nlw-runtime-error",((t,n,i)=>this.reportRuntimeError(n,i,e.ractive.get("code")))),e.ractive.on("*.nlw-compiler-error",((e,t,n)=>this.reportCompilerErrors(t,n))),e.ractive.on("*.nlw-extension-error",((e,t)=>this.reportError(t.join("<br/>"))))}reportRuntimeError(t,n,i){var r,o,a,s;if(n instanceof Exception.HaltInterrupt)throw new Error("`HaltInterrupt` should be handled and should not be reported to users.");"console"===t?(r=n instanceof Exception.RuntimeException?(s=e.makeBareRuntimeErrorMessage(n.message,n.primitive,n.sourceStart,n.sourceEnd,i),""===(a=n.stackTrace.map(e.makeBareFrameError).join("\n"))?s:`${s}\n${a}`):n instanceof TypeError?e.makeTypeErrorMessage(n.message):n.message,this.reportConsoleError(r)):(r=n instanceof Exception.RuntimeException?e.makeLinkedRuntimeErrorMessage(n.message,n.primitive,n.sourceStart,n.sourceEnd):n instanceof TypeError?e.makeTypeErrorMessage(n.message):n.message,this.reportError(r,null!=(o=n.stackTrace)?o:[]))}reportCompilerErrors(t,n){var i;switch(t){case"load-from-url":i=e.makeRemoteLoadErrorMessage(n[0]),this._ractive.set("isDismissable",!1),this.reportError(i);break;case"console":i=e.makeCompilerErrorMessage(n).join("\n"),this.reportConsoleError(i);break;default:i=e.makeCompilerErrorMessage(n).join("<br/>"),"compile-fatal"===t&&this._ractive.set("isDismissable",!1),this.reportError(i)}}reportProtocolError(t,n,i){var r;return r=e.makeProtocolErrorMessage(t,n,i),this._ractive.set("isDismissable",!1),this.reportError(r)}hide(){return this._ractive.fire("hide")}reportError(e,t=[]){this.show("Error",e,t)}reportConsoleError(e){var t;null!=(t=this.findConsole())&&(e=e.replace("\n"," "),t.appendText(`ERROR: ${e}\n`))}reportNotification(e){this.show("NetLogo Notification",e,[])}show(e,t,n){this._ractive.fire("show",e,t,n)}isLinkableProcedure(e,t){return["command","reporter"].includes(e)}isKnownProcedure(e,t){return["command","reporter","plot"].includes(e)}},A='<div class="dark-overlay alert-overlay"{{# !isActive}} style="display: none;"{{/}}>\n\n  {{# isActive}}\n  <div class="alert-dialog" id="alert-dialog">\n\n    <h3 id="alert-title">{{ title }}</h3>\n\n    <div id="alert-message" class="alert-text">\n      {{{message}}}<br/>\n      {{#each frames }}\n\n        {{#if @.isLinkableProcedure(type, name) }}\n          called by {{type}} <a href="/ignore" on-click=[\'jump-to-procedure\', name]>{{ name.toUpperCase() }}</a><br/>\n\n        {{elseif @.isKnownProcedure(type, name) }}\n          called by {{type}} {{name}}<br/>\n\n        {{else}}\n          called by unknown<br/>\n\n        {{/if}}\n      {{/each}}\n    </div>\n\n    {{# isStandalone }}\n    <div class="alert-text standalone-text">\n      It looks like you\'re using NetLogo Web in standalone mode.\n      <br/>\n      If the above error is being caused by an unimplemented primitive, we recommend a quick visit to\n      <a href="https://netlogoweb.org" target="_blank">NetLogoWeb.org</a>\n      to see if the primitive has been implemented in the most up-to-date version.\n    </div>\n    {{/ isStandalone }}\n\n    <div id="alert-dismiss-container">\n      <input id="alert-copy" type="button" class="alert-button" on-click="copy-message" value="Copy Message to Clipboard" />\n      {{# isDismissable }}\n      <input id="alert-dismiss" type="button" class="alert-button alert-separator-top" on-click="hide" value="Dismiss" />\n      {{/ isDismissable }}\n    </div>\n\n  </div>\n  {{/ isActive }}\n\n</div>';var L=E;var I,z,B,M,O="\n@#$#@#$#@\nGRAPHICS-WINDOW\n210\n10\n647\n448\n-1\n-1\n13.0\n1\n10\n1\n1\n1\n0\n1\n1\n1\n-16\n16\n-16\n16\n1\n1\n1\nticks\n30.0\n\n@#$#@#$#@\n## WHAT IS IT?\n\n(a general understanding of what the model is trying to show or explain)\n\n## HOW IT WORKS\n\n(what rules the agents use to create the overall behavior of the model)\n\n## HOW TO USE IT\n\n(how to use the model, including a description of each of the items in the Interface tab)\n\n## THINGS TO NOTICE\n\n(suggested things for the user to notice while running the model)\n\n## THINGS TO TRY\n\n(suggested things for the user to try to do (move sliders, switches, etc.) with the model)\n\n## EXTENDING THE MODEL\n\n(suggested things to add or change in the Code tab to make the model more complicated, detailed, accurate, etc.)\n\n## NETLOGO FEATURES\n\n(interesting or unusual features of NetLogo that the model uses, particularly in the Code tab; or where workarounds were needed for missing features)\n\n## RELATED MODELS\n\n(models in the NetLogo Models Library and elsewhere which are of related interest)\n\n## CREDITS AND REFERENCES\n\n(a reference to the model's URL on the web if it has one, as well as any other necessary credits, citations, and links)\n@#$#@#$#@\ndefault\ntrue\n0\nPolygon -7500403 true true 150 5 40 250 150 205 260 250\n\nairplane\ntrue\n0\nPolygon -7500403 true true 150 0 135 15 120 60 120 105 15 165 15 195 120 180 135 240 105 270 120 285 150 270 180 285 210 270 165 240 180 180 285 195 285 165 180 105 180 60 165 15\n\narrow\ntrue\n0\nPolygon -7500403 true true 150 0 0 150 105 150 105 293 195 293 195 150 300 150\n\nbox\nfalse\n0\nPolygon -7500403 true true 150 285 285 225 285 75 150 135\nPolygon -7500403 true true 150 135 15 75 150 15 285 75\nPolygon -7500403 true true 15 75 15 225 150 285 150 135\nLine -16777216 false 150 285 150 135\nLine -16777216 false 150 135 15 75\nLine -16777216 false 150 135 285 75\n\nbug\ntrue\n0\nCircle -7500403 true true 96 182 108\nCircle -7500403 true true 110 127 80\nCircle -7500403 true true 110 75 80\nLine -7500403 true 150 100 80 30\nLine -7500403 true 150 100 220 30\n\nbutterfly\ntrue\n0\nPolygon -7500403 true true 150 165 209 199 225 225 225 255 195 270 165 255 150 240\nPolygon -7500403 true true 150 165 89 198 75 225 75 255 105 270 135 255 150 240\nPolygon -7500403 true true 139 148 100 105 55 90 25 90 10 105 10 135 25 180 40 195 85 194 139 163\nPolygon -7500403 true true 162 150 200 105 245 90 275 90 290 105 290 135 275 180 260 195 215 195 162 165\nPolygon -16777216 true false 150 255 135 225 120 150 135 120 150 105 165 120 180 150 165 225\nCircle -16777216 true false 135 90 30\nLine -16777216 false 150 105 195 60\nLine -16777216 false 150 105 105 60\n\ncar\nfalse\n0\nPolygon -7500403 true true 300 180 279 164 261 144 240 135 226 132 213 106 203 84 185 63 159 50 135 50 75 60 0 150 0 165 0 225 300 225 300 180\nCircle -16777216 true false 180 180 90\nCircle -16777216 true false 30 180 90\nPolygon -16777216 true false 162 80 132 78 134 135 209 135 194 105 189 96 180 89\nCircle -7500403 true true 47 195 58\nCircle -7500403 true true 195 195 58\n\ncircle\nfalse\n0\nCircle -7500403 true true 0 0 300\n\ncircle 2\nfalse\n0\nCircle -7500403 true true 0 0 300\nCircle -16777216 true false 30 30 240\n\ncow\nfalse\n0\nPolygon -7500403 true true 200 193 197 249 179 249 177 196 166 187 140 189 93 191 78 179 72 211 49 209 48 181 37 149 25 120 25 89 45 72 103 84 179 75 198 76 252 64 272 81 293 103 285 121 255 121 242 118 224 167\nPolygon -7500403 true true 73 210 86 251 62 249 48 208\nPolygon -7500403 true true 25 114 16 195 9 204 23 213 25 200 39 123\n\ncylinder\nfalse\n0\nCircle -7500403 true true 0 0 300\n\ndot\nfalse\n0\nCircle -7500403 true true 90 90 120\n\nface happy\nfalse\n0\nCircle -7500403 true true 8 8 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nPolygon -16777216 true false 150 255 90 239 62 213 47 191 67 179 90 203 109 218 150 225 192 218 210 203 227 181 251 194 236 217 212 240\n\nface neutral\nfalse\n0\nCircle -7500403 true true 8 7 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nRectangle -16777216 true false 60 195 240 225\n\nface sad\nfalse\n0\nCircle -7500403 true true 8 8 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nPolygon -16777216 true false 150 168 90 184 62 210 47 232 67 244 90 220 109 205 150 198 192 205 210 220 227 242 251 229 236 206 212 183\n\nfish\nfalse\n0\nPolygon -1 true false 44 131 21 87 15 86 0 120 15 150 0 180 13 214 20 212 45 166\nPolygon -1 true false 135 195 119 235 95 218 76 210 46 204 60 165\nPolygon -1 true false 75 45 83 77 71 103 86 114 166 78 135 60\nPolygon -7500403 true true 30 136 151 77 226 81 280 119 292 146 292 160 287 170 270 195 195 210 151 212 30 166\nCircle -16777216 true false 215 106 30\n\nflag\nfalse\n0\nRectangle -7500403 true true 60 15 75 300\nPolygon -7500403 true true 90 150 270 90 90 30\nLine -7500403 true 75 135 90 135\nLine -7500403 true 75 45 90 45\n\nflower\nfalse\n0\nPolygon -10899396 true false 135 120 165 165 180 210 180 240 150 300 165 300 195 240 195 195 165 135\nCircle -7500403 true true 85 132 38\nCircle -7500403 true true 130 147 38\nCircle -7500403 true true 192 85 38\nCircle -7500403 true true 85 40 38\nCircle -7500403 true true 177 40 38\nCircle -7500403 true true 177 132 38\nCircle -7500403 true true 70 85 38\nCircle -7500403 true true 130 25 38\nCircle -7500403 true true 96 51 108\nCircle -16777216 true false 113 68 74\nPolygon -10899396 true false 189 233 219 188 249 173 279 188 234 218\nPolygon -10899396 true false 180 255 150 210 105 210 75 240 135 240\n\nhouse\nfalse\n0\nRectangle -7500403 true true 45 120 255 285\nRectangle -16777216 true false 120 210 180 285\nPolygon -7500403 true true 15 120 150 15 285 120\nLine -16777216 false 30 120 270 120\n\nleaf\nfalse\n0\nPolygon -7500403 true true 150 210 135 195 120 210 60 210 30 195 60 180 60 165 15 135 30 120 15 105 40 104 45 90 60 90 90 105 105 120 120 120 105 60 120 60 135 30 150 15 165 30 180 60 195 60 180 120 195 120 210 105 240 90 255 90 263 104 285 105 270 120 285 135 240 165 240 180 270 195 240 210 180 210 165 195\nPolygon -7500403 true true 135 195 135 240 120 255 105 255 105 285 135 285 165 240 165 195\n\nline\ntrue\n0\nLine -7500403 true 150 0 150 300\n\nline half\ntrue\n0\nLine -7500403 true 150 0 150 150\n\npentagon\nfalse\n0\nPolygon -7500403 true true 150 15 15 120 60 285 240 285 285 120\n\nperson\nfalse\n0\nCircle -7500403 true true 110 5 80\nPolygon -7500403 true true 105 90 120 195 90 285 105 300 135 300 150 225 165 300 195 300 210 285 180 195 195 90\nRectangle -7500403 true true 127 79 172 94\nPolygon -7500403 true true 195 90 240 150 225 180 165 105\nPolygon -7500403 true true 105 90 60 150 75 180 135 105\n\nplant\nfalse\n0\nRectangle -7500403 true true 135 90 165 300\nPolygon -7500403 true true 135 255 90 210 45 195 75 255 135 285\nPolygon -7500403 true true 165 255 210 210 255 195 225 255 165 285\nPolygon -7500403 true true 135 180 90 135 45 120 75 180 135 210\nPolygon -7500403 true true 165 180 165 210 225 180 255 120 210 135\nPolygon -7500403 true true 135 105 90 60 45 45 75 105 135 135\nPolygon -7500403 true true 165 105 165 135 225 105 255 45 210 60\nPolygon -7500403 true true 135 90 120 45 150 15 180 45 165 90\n\nsheep\nfalse\n15\nCircle -1 true true 203 65 88\nCircle -1 true true 70 65 162\nCircle -1 true true 150 105 120\nPolygon -7500403 true false 218 120 240 165 255 165 278 120\nCircle -7500403 true false 214 72 67\nRectangle -1 true true 164 223 179 298\nPolygon -1 true true 45 285 30 285 30 240 15 195 45 210\nCircle -1 true true 3 83 150\nRectangle -1 true true 65 221 80 296\nPolygon -1 true true 195 285 210 285 210 240 240 210 195 210\nPolygon -7500403 true false 276 85 285 105 302 99 294 83\nPolygon -7500403 true false 219 85 210 105 193 99 201 83\n\nsquare\nfalse\n0\nRectangle -7500403 true true 30 30 270 270\n\nsquare 2\nfalse\n0\nRectangle -7500403 true true 30 30 270 270\nRectangle -16777216 true false 60 60 240 240\n\nstar\nfalse\n0\nPolygon -7500403 true true 151 1 185 108 298 108 207 175 242 282 151 216 59 282 94 175 3 108 116 108\n\ntarget\nfalse\n0\nCircle -7500403 true true 0 0 300\nCircle -16777216 true false 30 30 240\nCircle -7500403 true true 60 60 180\nCircle -16777216 true false 90 90 120\nCircle -7500403 true true 120 120 60\n\ntree\nfalse\n0\nCircle -7500403 true true 118 3 94\nRectangle -6459832 true false 120 195 180 300\nCircle -7500403 true true 65 21 108\nCircle -7500403 true true 116 41 127\nCircle -7500403 true true 45 90 120\nCircle -7500403 true true 104 74 152\n\ntriangle\nfalse\n0\nPolygon -7500403 true true 150 30 15 255 285 255\n\ntriangle 2\nfalse\n0\nPolygon -7500403 true true 150 30 15 255 285 255\nPolygon -16777216 true false 151 99 225 223 75 224\n\ntruck\nfalse\n0\nRectangle -7500403 true true 4 45 195 187\nPolygon -7500403 true true 296 193 296 150 259 134 244 104 208 104 207 194\nRectangle -1 true false 195 60 195 105\nPolygon -16777216 true false 238 112 252 141 219 141 218 112\nCircle -16777216 true false 234 174 42\nRectangle -7500403 true true 181 185 214 194\nCircle -16777216 true false 144 174 42\nCircle -16777216 true false 24 174 42\nCircle -7500403 false true 24 174 42\nCircle -7500403 false true 144 174 42\nCircle -7500403 false true 234 174 42\n\nturtle\ntrue\n0\nPolygon -10899396 true false 215 204 240 233 246 254 228 266 215 252 193 210\nPolygon -10899396 true false 195 90 225 75 245 75 260 89 269 108 261 124 240 105 225 105 210 105\nPolygon -10899396 true false 105 90 75 75 55 75 40 89 31 108 39 124 60 105 75 105 90 105\nPolygon -10899396 true false 132 85 134 64 107 51 108 17 150 2 192 18 192 52 169 65 172 87\nPolygon -10899396 true false 85 204 60 233 54 254 72 266 85 252 107 210\nPolygon -7500403 true true 119 75 179 75 209 101 224 135 220 225 175 261 128 261 81 224 74 135 88 99\n\nwheel\nfalse\n0\nCircle -7500403 true true 3 3 294\nCircle -16777216 true false 30 30 240\nLine -7500403 true 150 285 150 15\nLine -7500403 true 15 150 285 150\nCircle -7500403 true true 120 120 60\nLine -7500403 true 216 40 79 269\nLine -7500403 true 40 84 269 221\nLine -7500403 true 40 216 269 79\nLine -7500403 true 84 40 221 269\n\nwolf\nfalse\n0\nPolygon -16777216 true false 253 133 245 131 245 133\nPolygon -7500403 true true 2 194 13 197 30 191 38 193 38 205 20 226 20 257 27 265 38 266 40 260 31 253 31 230 60 206 68 198 75 209 66 228 65 243 82 261 84 268 100 267 103 261 77 239 79 231 100 207 98 196 119 201 143 202 160 195 166 210 172 213 173 238 167 251 160 248 154 265 169 264 178 247 186 240 198 260 200 271 217 271 219 262 207 258 195 230 192 198 210 184 227 164 242 144 259 145 284 151 277 141 293 140 299 134 297 127 273 119 270 105\nPolygon -7500403 true true -1 195 14 180 36 166 40 153 53 140 82 131 134 133 159 126 188 115 227 108 236 102 238 98 268 86 269 92 281 87 269 103 269 113\n\nx\nfalse\n0\nPolygon -7500403 true true 270 75 225 30 30 225 75 270\nPolygon -7500403 true true 30 75 75 30 270 225 225 270\n@#$#@#$#@\nNetLogo 6.2.2\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\ndefault\n0.0\n-0.2 0 0.0 1.0\n0.0 1 1.0 0.0\n0.2 0 0.0 1.0\nlink direction\ntrue\n0\nLine -7500403 true 150 150 90 180\nLine -7500403 true 150 150 210 180\n@#$#@#$#@\n0\n@#$#@#$#@";M=function(e,t,n){var i,r,o,a,s,l,d,c,u,h,p,f,g,m,v;return({experimentName:r,parameterSet:h,repetitionsPerCombo:p,metrics:c,setup:g,go:s,stopCondition:m,iterationLimit:l}=e),h=function(){switch(h.type){case"discreteCombos":return h.combos;case"cartesianProduct":return B(h.variables);default:throw new Exception(`Unknown parameter set type: ${type}`)}}(),o=function(e){return[].concat(...e)}(function(){var e,t,n;for(n=[],e=0,t=h.length;e<t;e++)i=h[e],n.push(function(){var e,t,n;for(n=[],e=1,t=p;1<=t?e<=t:e>=t;1<=t?e++:e--)n.push(i);return n}());return n}()),window.Meta.behaviorSpaceName=null!=r?r:"BabyBehaviorSpace",window.Meta.behaviorSpaceRun=0,a=function(){var e,i,r;for(r=[],e=0,i=o.length;e<i;e++){for(d in u=o[e])v=u[d],t(d,v);f=z(g,s,m,l,c,n),window.Meta.behaviorSpaceRun=window.Meta.behaviorSpaceRun+1,r.push({config:u,results:f})}return r}(),window.Meta.behaviorSpaceName="",window.Meta.behaviorSpaceRun=0,a},I=function(e){return e.reduce((function(e,t){return e.map((function(e){return t.map((function(t){return e.concat(t)}))})).reduce((function(e,t){return e.concat(t)}),[])}),[[]])},B=function(e){var t,n;return t=e.map((function({name:e,parameterSpace:{type:t,values:n,min:i,max:r,interval:o}}){var a;return(n=function(){var e,s,l,d;switch(t){case"discreteValues":return n;case"range":for(d=[],a=e=i,s=r,l=o;0!==l&&(l>0?e<=s:e>=s);a=e+=l)d.push(a);return d;default:throw new Exception(`Unknown parameter space type: ${t}`)}}()).map((function(t){return{name:e,value:t}}))})),n=function(e,{name:t,value:n}){return e[t]=n,e},I(t).map((function(e){return e.reduce(n,{})}))},z=function(e,t,n,i,r,o){var a,s,l,d;for(a=0,s=i<1?-1:i,d={},l=function(e){var t,n,i,a;for(i in n={},r)({reporter:a,interval:t}=r[i]),0!==t&&e%t!=0||(n[i]=o(a()));Object.keys(n).length>0&&(d[e]=n)},e();!n()&&a<s;)l(a),t(),a++;return l(a),d};var R,N,U,D=M;({fold:N}=tortoise_require("brazier/maybe")),({DisplayMode:{displayModeToString:R},PenMode:{penModeToBool:U}}=tortoise_require("engine/plot/pen"));var V,F,j,W,H,Y,X,q,G=function(e,t,n,i,r){var o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C;for(l=function(e,t){return e.toUpperCase()===t.toUpperCase()},o=null!=(w=window.structuredClone)?w:function(e){return JSON.parse(JSON.stringify(e))},({currentPlotNameOrNull:s,plots:v}=o(e)),p=null!=s&&l(s,i)?r:s,y=Object.fromEntries(Object.entries(n).map((function([e,t]){return[t,e]}))),d=0,u=t.length;d<u;d++)if(m=t[d],x=l(m.name,r)?i:m.name,null!=(b=v.find((function(e){return l(e.name,x)})))){for(a=m.getCurrentPenMaybe(),b.currentPenNameOrNull=N((function(){return null}))((function(e){return e.name}))(a),b.name=m.name,b.isAutoplotting=m.isAutoplotting,b.isLegendOpen=m.isLegendEnabled,c=0,h=(g=m.getPens()).length;c<h;c++)f=g[c],_=l(m.name,r)&&null!=y[f.name]?y[f.name]:f.name,null!=(k=b.pens.find((function(e){return l(e.name,_)})))&&(k.color=f.getColor(),k.interval=f.getInterval(),k.isPenDown=U(f.getPenMode()),k.mode=R(f.getDisplayMode()),k.name=f.name);C=g.map((function(e){return e.name})),b.pens=b.pens.filter((function(e){return C.includes(e.name)}))}return{currentPlotNameOrNull:p,plots:v}};H=function(e){return e.replace(new RegExp("\x3c!---*\\s*((?:[^-]|-+[^->])*)\\s*-*--\x3e","g"),(function(e,t){return`[nlw-comment]: <> (${t.trim()})`}))},W=function(e){return e.replace(new RegExp("\\[nlw-comment\\]: <> \\(([^\\)]*)\\)","g"),(function(e,t){return`\x3c!-- ${t} --\x3e`}))},F=function(e){var t;return t=e.split(/\/|\\/),decodeURI(t[t.length-1])},V=function(e){return e.split(/^\@#\$#\@#\$#\@$/gm)},j=function(e){return e.join("@#$#@#$#@")},Y=tortoise_require("engine/plot/pen"),X=tortoise_require("engine/plot/plotops"),q=function(e,t){return{chart:{animation:!1,renderTo:e,spacingBottom:10,spacingLeft:15,spacingRight:15,zoomType:"xy"},credits:{enabled:!1},legend:{enabled:t.isLegendEnabled,margin:5,itemStyle:{fontSize:"10px"}},series:[],title:{text:t.name,style:{fontSize:"12px"}},exporting:{buttons:{contextButton:{height:10,symbolSize:10,symbolStrokeWidth:1,symbolY:5}}},tooltip:{formatter:function(){var e,t;return e=Number(Highcharts.numberFormat(this.point.x,2,".","")),t=Number(Highcharts.numberFormat(this.point.y,2,".","")),`<span style='color:${this.series.color}'>${this.series.name}</span>: <b>${e}, ${t}</b><br/>`}},xAxis:{title:{text:t.xLabel,style:{fontSize:"10px"}},labels:{style:{fontSize:"9px"}}},yAxis:{title:{text:t.yLabel,x:-7,style:{fontSize:"10px"}},labels:{padding:0,x:-15,style:{fontSize:"9px"}}},plotOptions:{series:{turboThreshold:1},column:{pointPadding:0,pointWidth:8,borderWidth:1,groupPadding:0,shadow:!1,grouping:!1}}}};var Z,K,J,Q,ee,te,ne,ie,re,oe,ae,se,le,de,ce,ue,he,pe,fe,ge,me,ve,we,ye,be,xe,ke,_e,Ce,Ee=function(){class e extends X{constructor(e){var t,n,i;n=function(e){var t,n,r,o;t=this._chart.series.length,r=this._chart.addSeries({color:this.colorToRGBString(e.getColor()),data:[],dataLabels:{enabled:!1},name:e.name}),o=this.modeToString(e.getDisplayMode()),n=i.seriesTypeOptions(o,e.getInterval()),r.update(n,!1),this._penNameToSeriesNum[e.name]=t},i=null,super((function(e,t,n,i){this._chart.xAxis[0].setExtremes(e,t,!1),this._chart.yAxis[0].setExtremes(n,i,!1)}),(function(t){this._chart.destroy(),this._chart=new Highcharts.Chart(q(e,t)),this._penNameToSeriesNum={}}),n,(e=>()=>{var t;null!=(t=i.penToSeries(e))&&t.setData([],!1)}),(e=>{var t;return t=null,(n,r)=>{var o,a;a=i.penToSeries(e),o=e.getPenMode()===Y.PenMode.Down?(null!==t&&(a.addPoint(t,!1),t=null),r):(t=[n,r],null),a.addPoint([n,o],!1)}}),(e=>t=>{var n,r,o;null!=(r=i.penToSeries(e))&&(o=i.modeToString(t),n=i.seriesTypeOptions(o,e.getInterval()),r.update(n,!1))}),(e=>t=>{var n,r;n=i.colorToRGBString(t),(r=i.penToSeries(e)).options.color=n,r.update(r.options,!1)})),i=this,t={name:"New Plot"},this._chart=new Highcharts.Chart(q(e,t)),this._penNameToSeriesNum={},null==this._chart.options.exporting.buttons.contextButton.menuItems.popped&&(this._chart.options.exporting.buttons.contextButton.menuItems.pop(),this._chart.options.exporting.buttons.contextButton.menuItems.pop(),this._chart.options.exporting.buttons.contextButton.menuItems.popped=!0)}dispose(){this._chart.destroy()}modeToString(e){var t,n,i;switch(({Bar:t,Line:n,Point:i}=Y.DisplayMode),e){case t:return"column";case n:return"line";case i:return"scatter";default:return"line"}}seriesTypeOptions(e,t){var n,i;return{marker:{enabled:i="scatter"===e,radius:i?1:4},lineWidth:(n="line"===e)?2:null,type:n?"scatter":e,pointRange:"column"===e?t:null,animation:!1,connectNulls:!1}}penToSeries(e){return this._chart.series[this._penNameToSeriesNum[e.name]]}redraw(){this._chart.redraw()}resizeElem(e,t){this._chart.setSize(e,t,!1)}setBGColor(e){this._chart.chartBackground.css({color:e})}}return e.prototype._chart=void 0,e.prototype._penNameToSeriesNum=void 0,e}.call(this);de=function(e,t,n,i){var r,o,a,s;for(o=r=0,a=t.length;r<a;o=++r)s=t[o],le(e,s,o,n,i)},Q=function(e){return new Function(`return ${e}`)},le=function(e,t,n,i,r){switch(t.id=n,null!=t.variable&&(t.variable=t.variable.toLowerCase()),t.type){case"switch":se(t,t);break;case"slider":t.currentValue=t.default,ae(t,t);break;case"inputBox":ie(t,t);break;case"button":te(e,i)(t,t);break;case"chooser":ne(t,t);break;case"monitor":re(t,t);break;case"plot":oe(r)(t,t)}},ie=function(e,t){t.boxedValue=e.boxedValue,t.currentValue=t.boxedValue.value,t.variable=e.variable,t.display=t.variable},oe=function(e){return function(t,n){var i,r;n.autoPlotOn=t.autoPlotOn,n.bottom=t.bottom,n.compilation=t.compilation,n.compiledPens=t.compiledPens,n.compiledSetupCode=t.compiledSetupCode,n.compiledUpdateCode=t.compiledUpdateCode,n.display=t.display,n.id=t.id,n.left=t.left,n.legendOn=t.legendOn,n.pens=t.pens,n.right=t.right,n.setupCode=t.setupCode,n.top=t.top,n.type=t.type,n.updateCode=t.updateCode,n.xAxis=t.xAxis,n.xmax=t.xmax,n.xmin=t.xmin,n.yAxis=t.yAxis,n.ymax=t.ymax,n.ymin=t.ymin,r=e.getPlotOps(),(i=new Ee(e.lookupElem(`#netlogo-${t.type}-${t.id}`))).setBGColor("#efefef"),r[t.display]=i,e.getPlotComps().find((function(e){return e.get("widget").display===t.display})).set("resizeCallback",i.resizeElem.bind(i))}},se=function(e,t){t.on=e.on,t.currentValue=t.on},ne=function(e,t){t.choices=e.choices,t.currentChoice=e.currentChoice,t.currentValue=t.choices[t.currentChoice]},ee=function(e,t,n){var i;try{return n()===StopInterrupt}catch(n){return(i=n)instanceof Exception.HaltInterrupt||t("runtime",e,i),!0}},K=function(e,t,n,i){return function(){ee("button",e,i)&&(n.running=!1,t())}},J=function(e,t,n){return function(){ee("button",e,n),t()}},Z=function(e,t,n){return function(){t.running=!1,e("compiler","button",["Button failed to compile with:"].concat(n))}},te=function(e,t){return function(n,i){var r,o,a,s;n.forever&&(i.running=!1),(null!=(o=n.compilation)?o.success:void 0)?(i.compiledSource=n.compiledSource,r=new Function(i.compiledSource),i.run=n.forever?K(e,t,i,r):J(e,t,r)):i.run=Z(e,i,null!=(a=null!=(s=n.compilation)?s.messages:void 0)?a:[])}},re=function(e,t){var n;(null!=(n=e.compilation)?n.success:void 0)?(t.compiledSource=e.compiledSource,t.reporter=Q(t.compiledSource),t.currentValue=""):(t.reporter=function(){return"N/A"},t.currentValue="N/A")},ae=function(e,t){var n;t.default=e.default,t.compiledMin=e.compiledMin,t.compiledMax=e.compiledMax,t.compiledStep=e.compiledStep,(null!=(n=e.compilation)?n.success:void 0)?(t.getMin=Q(t.compiledMin),t.getMax=Q(t.compiledMax),t.getStep=Q(t.compiledStep)):(t.getMin=function(){return t.currentValue},t.getMax=function(){return t.currentValue},t.getStep=function(){return.001}),t.minValue=t.currentValue,t.maxValue=t.currentValue+1,t.stepValue=.001},ce=class{constructor(e,t,n){this.reportError=this.reportError.bind(this),this.setCode=this.setCode.bind(this),this._countByType=this._countByType.bind(this),this.ractive=e,this.viewController=t,this.configs=n,this.ractive.observe("isEditing",(e=>{var t;return t=e?"#efefef":"#ffffff",Object.values(this.configs.plotOps).forEach((function(e){return e.setBGColor(t)}))}))}createWidget(e,t,n){var i,r,o,a,s,l,d;l=document.querySelector(".netlogo-widget-container").getBoundingClientRect(),o={left:i=Math.round(t-l.left),top:r=Math.round(n-l.top),type:e},s=pe(e,i,r,this._countByType),d=Object.assign(o,s),a=Math.max(...Object.keys(this.ractive.get("widgetObj")).map(parseFloat))+1,this.ractive.get("widgetObj")[a]=d,this.ractive.update("widgetObj"),le(this.reportError,d,a,(()=>(this.redraw(),this.updateWidgets())),this.plotSetupHelper()),null!=d.currentValue&&world.observer.setGlobal(d.variable,d.currentValue),this.ractive.findAllComponents("").find((function(e){return e.get("widget")===d})).fire("initialize-widget")}runForevers(){var e,t,n,i;for(e=0,t=(n=this.widgets()).length;e<t;e++)"button"===(i=n[e]).type&&i.forever&&i.running&&i.run()}updateWidgets(){var e,t,n,i,r,o,a,s;for(e in o=this.configs.plotOps)(t=o[e]).redraw(),n=this.ractive.get("isEditing")?"#efefef":"#ffffff",t.setBGColor(n);for(i=0,r=(a=this.widgets()).length;i<r;i++)s=a[i],xe(s);world.ticker.ticksAreStarted()?(this.ractive.set("ticks",Math.floor(world.ticker.tickCount())),this.ractive.set("ticksStarted",!0)):(this.ractive.set("ticks",""),this.ractive.set("ticksStarted",!1)),this.ractive.update()}removeWidgetById(e,t=!1){var n;if(n=this.ractive.get("widgetObj")[e].type,delete this.ractive.get("widgetObj")[e],this.ractive.update("widgetObj"),this.ractive.fire("deselect-widgets"),!t)switch(n){case"chooser":case"inputBox":case"plot":case"slider":case"switch":this.ractive.fire("controller.recompile")}}widgets(){var e,t,n,i;for(e in n=[],t=this.ractive.get("widgetObj"))i=t[e],n.push(i);return n}reportError(e,t,n){if(!["runtime","compiler"].includes(e))throw new Error('Only valid values for `time` are "runtime" or "compiler"');return this.ractive.fire(`nlw-${e}-error`,{},t,n)}freshenUpWidgets(e,t){var n,i,r,o,a,s,l,d;for(i=n=0,r=t.length;n<r;i=++n)(o=t[i]).id=i,[a,d]=function(){switch(o.type){case"button":return[ue,te(this.reportError,(()=>(this.redraw(),this.updateWidgets())))];case"chooser":return[he,ne];case"inputBox":return[fe,ie];case"monitor":return[ge,re];case"output":return[me,function(){}];case"plot":return[ve,oe(this.plotSetupHelper())];case"slider":return[we,ae];case"switch":return[ye,se];case"textBox":return[be,function(){}];case"view":return[ke,function(){}];default:throw new Error(`Unknown widget type: ${o.type}`)}}.call(this),null!=(s=e.find(_e(a)(o)))&&(s.compilation=o.compilation,d(o,s),null!=o.variable&&(s.variable=o.variable.toLowerCase()),"chooser"!==(l=o.type)&&"inputBox"!==l&&"slider"!==l&&"switch"!==l||world.observer.setGlobal(o.variable,s.currentValue));this.updateWidgets()}speed(){return this.ractive.get("speed")}setCode(e,t){var n;this.ractive.set("code",e),null!=(n=this.ractive.findComponent("codePane"))&&n.setCode(e),this.ractive.fire("controller.recompile",t)}jumpToProcedure(e){var t,n;this.ractive.set("showCode",!0),this.ractive.findComponent("codePane").set("jumpToProcedure",e),null!=(t=this.ractive.find("#netlogo-code-tab"))&&(n=function(){return t.scrollIntoView()},window.setTimeout(n,50))}jumpToCode(e,t){var n,i;this.ractive.set("showCode",!0),this.ractive.findComponent("codePane").set("jumpToCode",{start:e,end:t}),null!=(n=this.ractive.find("#netlogo-code-tab"))&&(i=function(){return n.scrollIntoView()},window.setTimeout(i,50))}redraw(){Updater.hasUpdates()&&this.viewController.update(Updater.collectUpdates())}teardown(){this.ractive.torndown||this.ractive.teardown()}code(){return this.ractive.get("code")}plotSetupHelper(){return{getPlotComps:()=>this.ractive.findAllComponents("plotWidget"),getPlotOps:()=>this.configs.plotOps,lookupElem:e=>this.ractive.find(e)}}_countByType(e){return this.widgets().filter((function(t){return t.type===e})).length}},xe=function(e){var t,n,i,r,o,a,s,l,d,c,u,h;switch(null!=e.currentValue&&(e.currentValue=function(){if(null!=e.variable)return world.observer.getGlobal(e.variable);if(null==e.reporter)return e.currentValue;try{return h=e.reporter(),i="number"==typeof h,!(null!=h&&(!i||isFinite(h)))?"N/A":null!=e.precision&&i?Ce(h,e.precision):h}catch(e){return"N/A"}}()),e.type){case"inputBox":e.boxedValue.value=e.currentValue;break;case"slider":a=e.getMax(),u=e.getStep(),d=e.getMin(),e.maxValue===a&&e.stepValue===u&&e.minValue===d||(e.maxValue=a,e.stepValue=u,e.minValue=d-1e-6,e.minValue=d);break;case"view":({maxPxcor:r,maxPycor:o,minPxcor:s,minPycor:l,patchSize:c}=e.dimensions),n=Math.round(c*(r-s+1)),t=Math.round(c*(o-l+1)),e.right=e.left+n,e.bottom=e.top+t}},Ce=function(e,t){var n,i;return n=Math.pow(10,t),i=Math.floor(e*n+.5)/n,t>0?i:Math.round(i)},pe=function(e,t,n,i){switch(e){case"output":return{bottom:n+60,right:t+180,fontSize:12};case"switch":return{bottom:n+33,right:t+100,on:!1,variable:""};case"slider":return{bottom:n+33,right:t+170,default:50,direction:"horizontal",max:"100",min:"0",step:"1"};case"inputBox":return{bottom:n+60,right:t+180,boxedValue:{multiline:!1,type:"String",value:""},variable:""};case"button":return{bottom:n+60,right:t+180,buttonKind:"Observer",disableUntilTicksStart:!1,forever:!1,running:!1};case"chooser":return{bottom:n+45,right:t+140,choices:[],currentChoice:-1,variable:""};case"monitor":return{bottom:n+45,right:t+70,fontSize:11,precision:17};case"plot":return{bottom:n+160,right:t+200,autoPlotOn:!0,display:`Plot ${i(e)+1}`,legendOn:!1,pens:[],setupCode:"",updateCode:"",xAxis:"",xmax:10,xmin:0,yAxis:"",ymax:10,ymin:0,exists:!1};case"textBox":return{bottom:n+60,right:t+180,color:0,display:"",fontSize:12,transparent:!0};default:throw new Error(`Huh?  What kind of widget is a ${e}?`)}},_e=function(e){return function(t){return function(n){var i,r,o;return({eq:i}=tortoise_require("brazier/equals")),r=["bottom","left","right","top"],o=function(e){return i(t[e])(n[e])},t.type===n.type&&r.concat(e).every(o)}}},ue=["buttonKind","disableUntilTicksStart","forever","source"],he=["choices","display","variable"],fe=["boxedValue","variable"],ge=["display","fontSize","precision","source"],me=["fontSize"],ve=["autoPlotOn","display","legendOn","pens","setupCode","updateCode","xAxis","xmax","xmin","yAxis","ymax","ymin"],we=["default","direction","display","max","min","step","units","variable"],ye=["display","on","variable"],be=["color","display","fontSize","transparent"],ke=["dimensions","fontSize","frameRate","showTickCounter","tickCounterLabel","updateMode"];var Se,Ae,Te,Pe,Le,Ie,ze,Be,Me,Oe,Re,Ne,Ue,De,Ve,Fe,$e,je,We=ce;for(Ne=function(e){var t,n,i,r,o;return[o,r,i]=n=Ve(e),(t=n.length>3?n[3]:255)<255?`rgba(${o}, ${r}, ${i}, ${t/255})`:`rgb(${o}, ${r}, ${i})`},De=function(e){var t,n,i;return[i,n,t]=Ve(e),`rgb(${i}, ${n}, ${t})`},Ue=function(e){return`#${Ve(e).map((function(e){var t;return 1===(t=e.toString(16)).length?`0${t}`:t})).join("")}`},Ie=function(e){var t,n,i,r,o;return i="([0-9a-f]{2})",o=e.toLowerCase().match(new RegExp(`#${i}${i}${i}`)).slice(1),[r,n,t]=o.map((function(e){return parseInt(e,16)})),ColorModel.nearestColorNumberOfRGB(r,n,t)},Ve=function(e){switch(typeof e){case"number":return Te[Math.floor(10*e)];case"object":return e.map(Math.round);case"string":return Oe[Re[e]];default:return console.error(`Unrecognized color: ${e}`)}},Re={},ze=Be=0,Me=($e=["gray","red","orange","brown","yellow","green","lime","turqoise","cyan","sky","blue","violet","magenta","pink","black","white"]).length;Be<Me;ze=++Be)Re[$e[ze]]=ze;Oe=[[140,140,140],[215,48,39],[241,105,19],[156,109,70],[237,237,47],[87,176,58],[42,209,57],[27,158,119],[82,196,196],[43,140,190],[50,92,168],[123,78,163],[166,25,105],[224,126,149],[0,0,0],[255,255,255]],Te=function(){var e,t;for(t=[],Pe=e=0;e<=1400;Pe=++e)Ae=Math.floor(Pe/100),[Fe,Le,Se]=Oe[Ae],(je=(Pe%100-50)/50.48+.012)<0?(Fe+=Math.floor(Fe*je),Le+=Math.floor(Le*je),Se+=Math.floor(Se*je)):(Fe+=Math.floor((255-Fe)*je),Le+=Math.floor((255-Le)*je),Se+=Math.floor((255-Se)*je)),t.push([Fe,Le,Se]);return t}();var He,Ye,Xe=Ractive.extend({data:function(){return{contextMenuOptions:void 0}},standardOptions:function(e){return{delete:{text:"Delete",isEnabled:!0,action:function(){return e.fire("hide-context-menu"),e.fire("unregister-widget",e.get("widget").id)}},edit:{text:"Edit",isEnabled:!0,action:function(){return e.fire("edit-widget")}}}}});He={dragstart:function(e,{original:t},n,i){var r,o,a,s,l;({clientX:r,clientY:o,dataTransfer:a,view:l}=t),n(r,o)?((s=document.createElement("img")).src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","function"==typeof a.setDragImage&&a.setDragImage(s,0,0),a.setData("text/plain",""),e.view=l,e.lastUpdateMs=(new Date).getTime(),i(r,o)):t.preventDefault()},drag:function(e,{original:{clientX:t,clientY:n,view:i}},r){var o,a,s,l,d,c;return null!=e.view&&(l=(o=function(e){return null!=e.parent?o(e.parent):e})(e),d=0!==t?t:null!=(a=l.get("lastDragX"))?a:-1,c=0!==n?n:null!=(s=l.get("lastDragY"))?s:-1,e.view===i&&d>0&&c>0&&(new Date).getTime()-e.lastUpdateMs>=1e3/60&&(e.lastUpdateMs=(new Date).getTime(),r(d,c))),!0},dragend:function(e,t){var n,i;null!=e.view&&((i=(n=function(e){return null!=e.parent?n(e.parent):e})(e)).set("lastDragX",void 0),i.set("lastDragY",void 0),e.view=void 0,e.lastUpdateMs=void 0,t())}},Ye=Xe.extend({lastUpdateMs:void 0,startLeft:void 0,startRight:void 0,startTop:void 0,startBottom:void 0,view:void 0,data:function(){return{left:void 0,right:void 0,top:void 0,bottom:void 0}},nudge:function(e){switch(e){case"up":if(this.get("top")>0)return this.set("top",this.get("top")-1),this.set("bottom",this.get("bottom")-1);break;case"down":return this.set("top",this.get("top")+1),this.set("bottom",this.get("bottom")+1);case"left":if(this.get("left")>0)return this.set("left",this.get("left")-1),this.set("right",this.get("right")-1);break;case"right":return this.set("left",this.get("left")+1),this.set("right",this.get("right")+1);default:return console.log(`'${e}' is an impossible direction for nudging...`)}},on:{"start-widget-drag":function(e){return He.dragstart(this,e,(function(){return!0}),((t,n)=>(this.fire("select-component",e.component),this.startLeft=this.get("left")-t,this.startRight=this.get("right")-t,this.startTop=this.get("top")-n,this.startBottom=this.get("bottom")-n)))},"drag-widget":function(e){var t,n;return t=window.navigator.platform.startsWith("Mac"),n=!t&&!e.original.ctrlKey||t&&!e.original.metaKey,He.drag(this,e,((e,t)=>{var i,r,o,a,s;return i=function(e){return e-5*Math.round(e/5)},a=n?i(this.startLeft+e):0,s=n?i(this.startTop+t):0,r=this.startLeft+e-a,o=this.startTop+t-s,r<0?(this.set("left",0),this.set("right",this.startRight-this.startLeft)):(this.set("left",r),this.set("right",this.startRight+e-a)),o<0?(this.set("top",0),this.set("bottom",this.startBottom-this.startTop)):(this.set("top",o),this.set("bottom",this.startBottom+t-s))}))},"stop-widget-drag":function(){return He.dragend(this,(()=>(this.startLeft=void 0,this.startRight=void 0,this.startTop=void 0,this.startBottom=void 0)))}}});var qe,Ge=[].splice;qe={recompileForPlot:function(e,t,n){return{run:function(i,r){return i.fire("recompile-for-plot",e,t,n)},type:"recompile-for-plot"}},recompile:function(){return{run:function(e,t){return e.fire("recompile")},type:"recompile"}},redrawView:function(){return{run:function(e,t){return e.fire("redraw-view")},type:"redrawView"}},refreshChooser:function(){return{run:function(e,t){return e.fire("refresh-chooser","ignore",t)},type:"refreshChooser"}},rename:function(e,t){return{run:function(n,i){return n.fire("rename-interface-global",e,t,i.currentValue)},type:`rename:${e},${t}`}},resizePatches:function(){return{run:function(e,t){return e.fire("set-patch-size",t.dimensions.patchSize)},type:"resizePatches"}},resizeView:function(){return{run:function(e,t){return e.fire("resize-view")},type:"resizeView"}},updateEngineValue:function(){return{run:function(e,t){return world.observer.setGlobal(t.variable,t.currentValue)},type:"updateCurrentValue"}},updateTopology:function(){return{run:function(e,t){return e.fire("update-topology")},type:"updateTopology"}}};var Ze,Ke,Je=Ye.extend({_weg:qe,data:function(){return{id:void 0,isEditing:void 0,isSelected:void 0,resizeDirs:["left","right","top","bottom","topLeft","topRight","bottomLeft","bottomRight"],widget:void 0}},components:{editForm:void 0},computed:{classes:function(){return`${this.get("isEditing")?"interface-unlocked":""}\n${this.get("isSelected")?"selected":""}`},dims:function(){return`position: absolute;\nleft: ${this.get("left")}px; top: ${this.get("top")}px;\nwidth: ${this.get("right")-this.get("left")}px; height: ${this.get("bottom")-this.get("top")}px;`}},handleResize:function({left:e,right:t,top:n,bottom:i}){this.set("widget.left",e),this.set("widget.right",t),this.set("widget.top",n),this.set("widget.bottom",i)},handleResizeEnd:function(){},on:{"edit-widget":function(){!0!==this.get("isNotEditable")&&(this.fire("hide-context-menu"),this.findComponent("editForm").fire("show-yourself"))},init:function(){var e;null!=(e=this.findComponent("editForm"))&&e.fire("activate-cloaking-device")},"initialize-widget":function(){return this.findComponent("editForm").fire("prove-your-worth"),!1},"*.has-been-proven-unworthy":function(){return this.fire("unregister-widget",this.get("widget").id,!0)},"*.update-widget-value":function(e,t){var n,i,r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E,S;l=function(e){return function(t){return t.split(".").reduce((function(e,t){return e[t]}),e)}},b=function(e){return function(t){return function(n){var i,r,o;return o=t.split("."),[...r]=o,[i]=Ge.call(r,-1),r.reduce((function(e,t){return e[t]}),e)[i]=n}}};try{if(s=t.__extras,delete t.__extras,E=this.get("widget"),S=Object.values(this.parent.get("widgetObj")),c=function(e){return e.variable===t.variable&&e.type!==E.type},null!=t.variable&&S.some(c))return this.fire("reject-duplicate-var",t.variable);for(u in y=function(e,t){return t.reduce((function(t,n){return t[n]=l(e)(n),t}),{})},k=this.eventTriggers(),x=Object.keys(k),v=y(E,x),t)C=t[u],b(E)(u)(C);for(g=y(E,x),r=function(){var e,t,n;for(n=[],e=0,t=x.length;e<t;e++)p=x[e],g[p]!==v[p]&&n.push(k[p].map((function(e){return e(v[p],g[p])})));return n}(),a=(null!=s?s.recompileForPlot:void 0)?[qe.recompileForPlot()]:[],_=[].concat(a,...r).reduce((function(e,t){return null==e.find((function(e){return e.type===t.type}))?e.concat([t]):e}),[]),d=0,h=_.length;d<h;d++)("recompile-for-plot"===(i=_[d]).type?(m=(n=this.findComponent("editForm")).getOldName(),f=E.display,w=n.getRenamings(),qe.recompileForPlot(m,f,w)):i).run(this,E);return this.fire("update-widgets")}catch(e){return o=e,console.error(o)}finally{return!1}}},partials:{editorOverlay:'{{ #isEditing }}\n  <div draggable="true" style="{{dims}}"\n       class="editor-overlay{{#isSelected}} selected{{/}}{{#widget.type === \'plot\'}} plot-overlay{{/}}"\n       on-click="@this.fire(\'hide-context-menu\') && @this.fire(\'select-widget\', @event)"\n       on-contextmenu="@this.fire(\'show-context-menu\', @event)"\n       on-dblclick="@this.fire(\'edit-widget\')"\n       on-dragstart="start-widget-drag"\n       on-drag="drag-widget"\n       on-dragend="stop-widget-drag"></div>\n{{/}}'}}),Qe=Ractive.extend({lastUpdateMs:void 0,startX:void 0,startY:void 0,view:void 0,data:function(){return{parentClass:"netlogo-widget-container",submitLabel:"OK",cancelLabel:"Cancel",horizontalOffset:void 0,verticalOffset:void 0,amProvingMyself:!1,idBasis:void 0,style:void 0,visible:void 0,xLoc:void 0,yLoc:void 0,draggable:!0}},computed:{id:function(){return`${this.get("idBasis")}-edit-window`}},twoway:!1,lazy:!0,on:{submit:function({node:e}){var t,n;try{if(null!=(n=this.genProps(e)))return this.fire("update-widget-value",{},n)}catch(e){return t=e,console.warn("Widget form submission error: ",t)}finally{return this.set("amProvingMyself",!1),this.fire("activate-cloaking-device"),!1}},"show-yourself":function(){var e,t,n,i,r,o,a,s,l,d;return a=function(e){return function({parentElement:t}){return null!=t?t.classList.contains(e)?t:a(e)(t):void 0}},this.set("visible",!0),(o=this.getElem()).focus(),this.fire("lock-selection",this.parent),this.fire("edit-form-opened",this),t=(e=a(this.get("parentClass"))(o)).offsetWidth/2,n=e.offsetHeight/2,r=o.offsetWidth/2,i=o.offsetHeight/2,this.set("xLoc",null!=(s=this.get("horizontalOffset"))?s:t-r),this.set("yLoc",null!=(l=this.get("verticalOffset"))?l:n-i),this.resetPartial("widgetFields",this.partials.widgetFields),d=e=>(e.addEventListener("focus",(e=>{this.set("draggable",!1)})),e.addEventListener("blur",(e=>{this.set("draggable",!0)}))),this.findAll("textarea").forEach(d),this.findAll("input").forEach(d),!1},"activate-cloaking-device":function(){return this.set("visible",!1),this.fire("unlock-selection"),this.fire("edit-form-closed",this),this.get("amProvingMyself")&&this.fire("has-been-proven-unworthy"),!1},"prove-your-worth":function(){return this.fire("show-yourself"),this.set("amProvingMyself",!0),!1},"start-edit-drag":function(e){return He.dragstart(this,e,(function(e,t){var n;switch((n=document.elementFromPoint(e,t)).tagName.toLowerCase()){case"input":return"number"!==n.type.toLowerCase()&&"text"!==n.type.toLowerCase();case"textarea":return!1;default:return!0}}),((e,t)=>(this.startX=this.get("xLoc")-e,this.startY=this.get("yLoc")-t)))},"drag-edit-dialog":function(e){return He.drag(this,e,((e,t)=>(this.set("xLoc",this.startX+e),this.set("yLoc",this.startY+t))))},"stop-edit-drag":function(){return He.dragend(this,(function(){}))},"cancel-edit":function(){this.fire("activate-cloaking-device")},"handle-key":function({original:{keyCode:e}}){27===e&&this.fire("cancel-edit")}},getElem:function(){return this.find(`#${this.get("id")}`)},template:'{{# visible }}\n<div class="widget-edit-form-overlay">\n  <div id="{{id}}"\n       class="widget-edit-popup widget-edit-text"\n       style="top: {{yLoc}}px; left: {{xLoc}}px; {{style}}"\n       on-keydown="handle-key"\n       draggable="{{draggable}}" on-drag="drag-edit-dialog" on-dragstart="start-edit-drag"\n       on-dragend="stop-edit-drag"\n       tabindex="0">\n    <div id="{{id}}-closer" class="widget-edit-closer" on-click="cancel-edit">X</div>\n    <form class="widget-edit-form" on-submit="submit">\n      <div class="widget-edit-form-title">{{>title}}</div>\n      {{>widgetFields}}\n      <div class="widget-edit-form-button-container">\n        <input class="widget-edit-text" type="submit" value="{{ submitLabel }}" />\n        <input class="widget-edit-text" type="button" on-click="cancel-edit" value="{{ cancelLabel }}" />\n      </div>\n    </form>\n  </div>\n</div>\n{{/}}',partials:{widgetFields:void 0}}),et=Ractive.extend({data:function(){return{class:void 0,id:void 0,isEnabled:!0,name:void 0,style:void 0,value:void 0}},on:{"handle-color-change":function({node:{value:e}}){var t;return t=function(){try{return Ie(e)}catch(e){return 0}}(),this.set("value",t),!1},render:function(){var e;e=function(e,t){var n,i;e!==t&&(n=function(){try{return Ue(this.get("value"))}catch(e){return"#000000"}}.call(this),(i=this.find("input")).value=n,null!=i.jsc&&(i.style.backgroundColor=i.value))},this.observe("value",e)}},template:'<input id="{{id}}" class="{{class}}" name="{{name}}" style="{{style}}" type="color"\n       on-change="handle-color-change"\n       {{# !isEnabled }}disabled{{/}} />'});Ke=(Ze=Ractive.extend({data:function(){return{disabled:void 0,id:void 0,isChecked:void 0,labelText:void 0,name:void 0}},twoway:!1,template:'<div class="widget-edit-checkbox-wrapper">\n  <input id="{{id}}" class="widget-edit-checkbox"\n         name="[[name]]" type="checkbox" checked="{{isChecked}}"\n         {{# disabled === true }} disabled {{/}} />\n  <label for="{{id}}" class="widget-edit-input-label" style="margin-right: 0px;">{{labelText}}</label>\n</div>'})).extend({twoway:!0});var tt,nt=Ractive.extend({data:function(){return{height:void 0,width:void 0}},template:'<div style="{{>height}} {{>width}}"></div>',partials:{height:"{{ #height }}height: {{height}};{{/}}",width:"{{ #width  }}width:  {{width }};{{/}}"}});(tt=Ractive.extend({data:function(){return{attrs:void 0,checked:void 0,class:void 0,divClass:"flex-row",id:void 0,labelStr:void 0,labelStyle:void 0,max:void 0,min:void 0,name:void 0,onChange:void 0,onInput:void 0,placeholder:void 0,required:void 0,style:void 0,type:void 0,value:void 0}},twoway:!1,on:{exec:function(e){var t;(t=this.get("onChange"))&&("number"===this.get("type")&&this.set("value",this.clampNumber(this.get("value"),this.get("min"),this.get("max"))),this.fire(t,e,this.get("value")))},"process-input":function(e){var t;return"function"==typeof(t=this.get("onInput"))?t(e):void 0}},clampNumber:function(e,t,n){return null!=t&&e<t?t:null!=n&&e>n?n:e},template:'<div class="{{ divClass }}">\n  <label for="{{ id }}" class="widget-edit-input-label" style="{{ labelStyle }}">{{ labelStr }}</label>\n  <div style="flex-grow: 1;">\n    <input class="widget-edit-text widget-edit-input {{ class }}"\n      type="{{ type }}" name="{{ name }}" style="{{ style }}"\n      value="{{ value }}" checked="{{ checked }}"\n      {{#if id}}id="{{ id }}"{{/if}}\n      {{#if placeholder}}placeholder="{{ placeholder }}"{{/if}}\n      {{#if min}}min="{{ min }}"{{/if}} {{#if max}}max="{{ max }}"{{/if}}\n      on-change="exec" on-input="process-input"\n      {{ attrs }} />\n  </div>\n</div>'})).extend({data:function(){return{attrs:'lazy step="any"'}},twoway:!0});var it,rt=tt.extend({data:function(){return{attrs:"min=0 step=1 required",labelStr:"Font size:",style:"width: 70px;",type:"number"}},twoway:!1});it=Qe.extend({data:function(){return{color:void 0,fontSize:void 0,text:void 0,transparent:void 0,_color:void 0}},twoway:!1,components:{colorInput:et,formCheckbox:Ze,formFontSize:rt,labeledInput:tt,spacer:nt},genProps:function(e){return{color:this.findComponent("colorInput").get("value"),display:e.text.value,fontSize:parseInt(e.fontSize.value),transparent:e.transparent.checked}},on:{init:function(){this.set("_color",this.get("color"))}},partials:{title:"Note",widgetFields:'<label for="{{id}}-text">Text</label><br>\n<textarea id="{{id}}-text" class="widget-edit-textbox"\n          name="text" placeholder="Enter note text here..."\n          value="{{text}}" autofocus></textarea>\n\n<spacer height="20px" />\n\n<div class="flex-row" style="align-items: center;">\n  <div style="width: 48%;">\n    <formFontSize id="{{id}}-font-size" name="fontSize" value="{{fontSize}}"/>\n  </div>\n  <spacer width="4%" />\n  <div style="width: 48%;">\n    <div class="flex-row" style="align-items: center;">\n      <label for="{{id}}-text-color" class="widget-edit-input-label">Text color:</label>\n      <div style="flex-grow: 1;">\n        <colorInput id="{{id}}-text-color" name="color" class="widget-edit-text widget-edit-input widget-edit-color-pick" value="{{_color}}" />\n      </div>\n    </div>\n  </div>\n</div>\n\n<spacer height="15px" />\n\n<formCheckbox id="{{id}}-transparent-checkbox" isChecked={{transparent}} labelText="Transparent background" name="transparent" />'}});var ot,at,st,lt,dt,ct=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],convertColor:Ne}},components:{editForm:it},eventTriggers:function(){return{}},minWidth:13,minHeight:13,template:"{{>editorOverlay}}\n{{>label}}\n{{>form}}",partials:{label:'<pre id="{{id}}" class="netlogo-widget netlogo-text-box {{classes}}"\n     style="{{dims}} font-size: {{widget.fontSize}}px; color: {{ convertColor(widget.color) }}; {{# widget.transparent}}background: transparent;{{/}}"\n     >{{ widget.display }}</pre>',form:'<editForm idBasis="{{id}}" color="{{widget.color}}"\n          fontSize="{{widget.fontSize}}" text="{{widget.display}}"\n          transparent="{{widget.transparent}}" />'}});at=(ot=Ractive.extend({_editor:void 0,data:function(){return{code:void 0,extraClasses:void 0,extraConfig:void 0,id:void 0,initialCode:void 0,isDisabled:!1,injectedConfig:void 0,onchange:function(){},style:void 0}},oncomplete:function(){var e,t;e=this.get("initialCode"),this.set("code",null!=(t=null!=e?e:this.get("code"))?t:""),this._setupCodeMirror()},twoway:!1,_setupCodeMirror:function(){var e,t,n,i;e={mode:"netlogo",theme:"netlogo-default",value:this.get("code").toString(),viewportMargin:Infinity},t=Object.assign({},e,null!=(n=this.get("extraConfig"))?n:{},null!=(i=this.get("injectedConfig"))?i:{}),this._editor=new CodeMirror(this.find(`#${this.get("id")}`),t),this._editor.on("change",(()=>{var e;return e=this._editor.getValue(),this.set("code",e),this.parent.fire("code-changed",e),this.get("onchange")(e)})),this.observe("isDisabled",(function(e){var t;this._editor.setOption("readOnly",!!e&&"nocursor"),t=this.find(".netlogo-code").querySelector(".CodeMirror-scroll").classList,e?t.add("cm-disabled"):t.remove("cm-disabled")}))},refresh:function(){this._editor.refresh()},setCode:function(e){var t;t=e.toString(),null!=this._editor&&this._editor.getValue()!==t&&this._editor.setValue(t)},template:'<div\n  id="{{id}}"\n  class="netlogo-code {{(extraClasses || []).join(\' \')}}"\n  style="{{style}}"\n  translate="no"\n/>'})).extend({data:function(){return{extraConfig:{tabSize:2,extraKeys:{"Ctrl-F":"findPersistent","Cmd-F":"findPersistent"}},jumpToProcedure:void 0,jumpToCode:void 0}},oncomplete:function(){return this._super(),this.jumpToProcedure(),this.jumpToCode()},observe:{jumpToProcedure:function(){return this.jumpToProcedure()},jumpToCode:function(){return this.jumpToCode()}},highlightProcedure:function(e,t){var n,i;n=this._editor.posFromIndex(t),i=CodeMirror.Pos(n.line,n.ch-e.length),this._editor.setSelection(i,n)},highlightLocation:function(e){var t,n;n=this._editor.posFromIndex(e.start),t=this._editor.posFromIndex(e.end),this._editor.setSelection(n,t)},jumpToProcedure:function(){var e;null!=(e=this.get("jumpToProcedure"))&&null!=this._editor&&this.highlightProcedure(e.procName,e.index)},jumpToCode:function(){var e;null!=(e=this.get("jumpToCode"))&&null!=this._editor&&this.highlightLocation(e)},getEditor:function(){return this._editor}}),lt=(dt=function(e){return Ractive.extend({data:function(){return{config:void 0,id:void 0,isCollapsible:!1,isDisabled:!1,isExpanded:void 0,label:void 0,onchange:function(){},style:void 0,value:void 0}},twoway:!1,components:{codeContainer:e},on:{init:function(){var e,t;e=null!=(t=this.get("isExpanded"))?t:!this.get("isCollapsible"),this.set("isExpanded",e),this.observe("isExpanded",(function(e,t){if(!0===e&&!1===t)return setTimeout((()=>this.findComponent("codeContainer").refresh()),0)}))},"toggle-expansion":function(){return this.get("isCollapsible")&&this.set("isExpanded",!this.get("isExpanded")),!1}},template:'<div class="flex-row code-container-label{{#isExpanded}} open{{/}}"\n     on-click="toggle-expansion">\n  {{# isCollapsible }}\n    <div for="{{id}}-is-expanded" class="expander widget-edit-checkbox-wrapper">\n      <span id="{{id}}-is-expanded" class="widget-edit-input-label expander-label">&#9654;</span>\n    </div>\n  {{/}}\n  <label for="{{id}}" class="expander-text">{{label}}</label>\n</div>\n<div class="{{# isCollapsible && !isExpanded }}hidden{{/}}" style="{{style}}">\n  <codeContainer id="{{id}}" initialCode="{{value}}" injectedConfig="{{config}}"\n                 isDisabled="{{isDisabled}}" onchange="{{onchange}}" />\n</div>'})})(ot.extend({oncomplete:function(){var e;this._super(),e=function(e,t){var n;return n=t.text.join("").replace(/\n/g,""),t.update(t.from,t.to,[n]),!0},this._editor.on("beforeChange",e)}})),st=dt(at);var ut,ht,pt=Ractive.extend({data:function(){return{id:void 0,name:void 0,value:void 0}},twoway:!1,on:{validate:function({node:e}){var t,n;return n=e.value.toLowerCase(),t=P.all.some((function(e){return e.toLowerCase()===n}))?`'${e.value}' is a reserved name`:"",e.setCustomValidity(t),!1}},template:'<label for="{{id}}">Global variable: </label>\n<input id="{{id}}" class="widget-edit-text" name="{{name}}" placeholder="(Required)"\n       type="text" value="{{value}}"\n       autofocus autocomplete="off" on-input="validate"\n       pattern="[=*!<>:#+/%\'&$^.?\\-_a-zA-Z][=*!<>:#+/%\'&$^.?\\-\\w]*"\n       title="One or more alphanumeric characters and characters in (( $^.?=*!<>:#+/%\'&-_ )).  Cannot start with a number"\n       required />'});(ut=Ractive.extend({data:function(){return{changeEvent:void 0,choices:void 0,disableds:void 0,name:void 0,id:void 0,label:void 0,selected:void 0,checkIsDisabled:function(e){var t;return(null!=(t=this.get("disableds"))?t:[]).some((function(t){return t===e||null!=e.value&&e.value===t}))},valOf:function(e){return null!=e.value?e.value:e},textOf:function(e){return null!=e.text?e.text:e}}},on:{"*.changed":function(e){var t;null!=(t=this.get("changeEvent"))&&this.fire(t)}},twoway:!1,template:'<div class="{{ divClass }}">\n  <label for="{{ id }}" class="widget-edit-input-label">{{ label }}</label>\n  <select id="{{ id }}" name="{{ name }}" class="widget-edit-dropdown" value="{{ selected }}" on-change="changed">\n    {{#choices }}\n      <option value="{{ valOf(this) }}" {{# checkIsDisabled(this) }} disabled {{/}}>{{ textOf(this) }}</option>\n    {{/}}\n  </select>\n</div>'})).extend({twoway:!0}),ht=Qe.extend({data:function(){return{boxtype:void 0,display:void 0,isMultiline:void 0,value:void 0}},components:{formCheckbox:Ze,formDropdown:ut,formVariable:pt,spacer:nt},twoway:!1,genProps:function(e){var t,n,i,r;return n=e.boxtype.value,r=e.variable.value,i=function(){if(n===this.get("boxtype"))return this.get("value");switch(n){case"Color":case"Number":return 0;default:return""}}.call(this),t="Color"!==n&&"Number"!==n?{multiline:e.multiline.checked}:{},{boxedValue:Object.assign(t,{type:n,value:i}),currentValue:i,display:r,variable:r.toLowerCase()}},partials:{title:"Input",widgetFields:'<formVariable id="{{id}}-varname" name="variable" value="{{display}}" />\n<spacer height="15px" />\n<div class="flex-row" style="align-items: center;">\n  <formDropdown id="{{id}}-boxtype" name="boxtype" label="Type" selected="{{boxtype}}"\n                choices="[\'String\', \'Number\', \'Color\', \'String (reporter)\', \'String (commands)\']" />\n  <formCheckbox id="{{id}}-multiline-checkbox" isChecked={{isMultiline}} labelText="Multiline"\n                name="multiline" disabled="typeof({{isMultiline}}) === \'undefined\'" />\n</div>\n<spacer height="10px" />'}});var ft,gt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete]}},components:{colorInput:et,editForm:ht,editor:at},eventTriggers:function(){return{currentValue:[this._weg.updateEngineValue],variable:[this._weg.recompile,this._weg.rename]}},on:{"code-changed":function(e,t){return this.get("widget").boxedValue.type.includes("String ")&&this.set("widget.currentValue",t),!1},"handle-keypress":function({original:{keyCode:e,target:t}}){if(!this.get("widget.boxedValue.multiline")&&13===e)return t.blur(),!1},render:function(){return this.observe("widget.currentValue",((e,t)=>{this.scrollToBottom(e),this.validateValue(e,t)}))}},scrollToBottom:function(e){var t,n;null!=(t=this.find(".netlogo-multiline-input"))&&setTimeout((function(){return t.scrollTop=t.scrollHeight}),0),null!=(n=this.findComponent("editor"))&&n.setCode(e)},resetValue:function(e,t,n){var i;return i=typeof t!==e?n:t,this.set("widget.currentValue",i),this.fire("set-global",this.get("widget.variable"),i)},validateValue:function(e,t){var n,i;n=this.get("widget.boxedValue.type"),i=typeof e,["Color","Number"].includes(n)&&"number"!==i?this.resetValue("number",t,0):n.startsWith("String")&&"string"!==i&&this.resetValue("string",t,"")},minWidth:70,minHeight:43,template:'{{>editorOverlay}}\n{{>input}}\n<editForm idBasis="{{id}}" boxtype="{{widget.boxedValue.type}}" display="{{widget.display}}"\n          {{# widget.boxedValue.type !== \'Color\' && widget.boxedValue.type !== \'Number\' }}\n            isMultiline="{{widget.boxedValue.multiline}}"\n          {{/}} value="{{widget.currentValue}}"\n          />',partials:{input:'<label id="{{id}}" class="netlogo-widget netlogo-input-box netlogo-input {{classes}}" style="{{dims}}">\n  <div class="netlogo-label">{{widget.variable}}</div>\n  {{# widget.boxedValue.type === \'Number\'}}\n    <input class="netlogo-multiline-input" type="number" value="{{widget.currentValue}}" lazy="true" {{# isEditing }}disabled{{/}} />\n  {{/}}\n  {{# widget.boxedValue.type === \'String\'}}\n    <textarea class="netlogo-multiline-input" value="{{widget.currentValue}}" on-keypress="handle-keypress" lazy="true" {{# isEditing }}disabled{{/}} ></textarea>\n  {{/}}\n  {{# widget.boxedValue.type === \'String (reporter)\' || widget.boxedValue.type === \'String (commands)\' }}\n    <editor extraClasses="[\'netlogo-multiline-input\']" id="{{id}}-code" injectedConfig="{ scrollbarStyle: \'null\' }" style="height: 50%;" initialCode="{{widget.currentValue}}" isDisabled="{{isEditing}}" />\n  {{/}}\n  {{# widget.boxedValue.type === \'Color\'}}\n    <colorInput class="netlogo-multiline-input" style="margin: 0; width: 100%;" value="{{widget.currentValue}}" isEnabled="{{!isEditing}}" />\n  {{/}}\n</label>'}});ft=Qe.extend({data:function(){return{actionKey:void 0,display:void 0,isForever:void 0,source:void 0,startsDisabled:void 0,type:void 0}},computed:{displayedType:{get:function(){return this._typeToDisplay(this.get("type"))}}},on:{"handle-action-key-press":function({event:{key:e},node:t}){if("Enter"!==e)return t.value=""}},twoway:!1,components:{formCheckbox:Ze,formCode:st,formDropdown:ut,labeledInput:tt,spacer:nt},genProps:function(e){var t,n;return t=e.actionKey.value,n=this.findComponent("formCode").findComponent("codeContainer").get("code"),{actionKey:1===t.length?t.toUpperCase():null,buttonKind:this._displayToType(e.type.value),disableUntilTicksStart:e.startsDisabled.checked,display:""!==e.display.value?e.display.value:void 0,forever:e.forever.checked,source:""!==n?n:void 0}},partials:{title:"Button",widgetFields:'<div class="flex-row" style="align-items: center;">\n  <formDropdown id="{{id}}-type" choices="[\'observer\', \'turtles\', \'patches\', \'links\']" name="type" label="Agent(s):" selected="{{displayedType}}" />\n  <formCheckbox id="{{id}}-forever-checkbox" isChecked={{isForever}} labelText="Forever" name="forever" />\n</div>\n\n<spacer height="15px" />\n\n<formCheckbox id="{{id}}-start-disabled-checkbox" isChecked={{startsDisabled}} labelText="Disable until ticks start" name="startsDisabled" />\n\n<spacer height="15px" />\n\n<formCode id="{{id}}-source" name="source" value="{{source}}" label="Commands" />\n\n<spacer height="15px" />\n\n<div class="flex-row" style="align-items: center;">\n  <labeledInput id="{{id}}-display" labelStr="Display name:" name="display" class="widget-edit-inputbox" type="text" value="{{display}}" />\n</div>\n\n<spacer height="15px" />\n\n<div class="flex-row" style="align-items: center;">\n  <label for="{{id}}-action-key">Action key:</label>\n  <input  id="{{id}}-action-key" name="actionKey" type="text" value="{{actionKey}}"\n          class="widget-edit-inputbox" style="text-transform: uppercase; width: 33px;"\n          on-keypress="handle-action-key-press" />\n</div>'},_displayToType:function(e){return{observer:"Observer",turtles:"Turtle",patches:"Patch",links:"Link"}[e]},_typeToDisplay:function(e){return{Observer:"observer",Turtle:"turtles",Patch:"patches",Link:"links"}[e]}});var mt,vt,wt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],errorClass:void 0,ticksStarted:void 0}},computed:{isEnabled:{get:function(){var e,t,n,i;return!this.get("isEditing")&&(i=this.get("widget"),n=this.get("ticksStarted"),e=!i.disableUntilTicksStart,t=!i.compilation.success,n||e||t)}}},oninit:function(){return this._super(),this.on("activate-button",(function(e,t){if(this.get("isEnabled"))return t()}))},components:{editForm:ft},eventTriggers:function(){return{buttonKind:[this._weg.recompile],forever:[this._weg.recompile],source:[this._weg.recompile]}},minWidth:35,minHeight:30,template:'{{>editorOverlay}}\n{{>button}}\n<editForm actionKey="{{widget.actionKey}}" display="{{widget.display}}"\n          idBasis="{{id}}" isForever="{{widget.forever}}" source="{{widget.source}}"\n          startsDisabled="{{widget.disableUntilTicksStart}}" type="{{widget.buttonKind}}" />',partials:{button:"{{# widget.forever }}\n  {{>foreverButton}}\n{{ else }}\n  {{>standardButton}}\n{{/}}",standardButton:'<button id="{{id}}" type="button" style="{{dims}}"\n        class="netlogo-widget netlogo-button netlogo-command{{# !isEnabled }} netlogo-disabled{{/}} {{errorClass}} {{classes}}"\n        on-click="@this.fire(\'activate-button\', @this.get(\'widget.run\'))">\n  {{>buttonContext}}\n  {{>label}}\n  {{>actionKeyIndicator}}\n</button>',foreverButton:'<label id="{{id}}" style="{{dims}}"\n       class="netlogo-widget netlogo-button netlogo-forever-button{{#widget.running}} netlogo-active{{/}} netlogo-command{{# !isEnabled }} netlogo-disabled{{/}} {{errorClass}} {{classes}}">\n  {{>buttonContext}}\n  {{>label}}\n  {{>actionKeyIndicator}}\n  <input type="checkbox" checked={{ widget.running }} {{# !isEnabled }}disabled{{/}}/>\n  <div class="netlogo-forever-icon"></div>\n</label>',buttonContext:'<div class="netlogo-button-agent-context">\n{{#if widget.buttonKind === "Turtle" }}\n  T\n{{elseif widget.buttonKind === "Patch" }}\n  P\n{{elseif widget.buttonKind === "Link" }}\n  L\n{{/if}}\n</div>',label:'<span class="netlogo-label">{{widget.display || widget.source}}</span>',actionKeyIndicator:'{{# widget.actionKey }}\n  <span class="netlogo-action-key {{# widget.hasFocus }}netlogo-focus{{/}}">\n    {{widget.actionKey}}\n  </span>\n{{/}}'}});mt=Ractive.extend({data:function(){return{id:void 0,hint:void 0,label:void 0,max:void 0,min:void 0,name:void 0,value:void 0}},isolated:!0,twoway:!1,components:{labeledInput:tt},template:'<div>\n  <labeledInput id="{{id}}" labelStr="{{label}}"\n                labelStyle="min-width: 100px; white-space: nowrap;"\n                name="{{name}}" style="text-align: right;" type="number"\n                attrs="min=\'{{min}}\' max=\'{{max}}\' step=1 required"\n                value="{{value}}" />\n  <div class="widget-edit-hint-text">{{hint}}</div>\n</div>'}),vt=Qe.extend({data:function(){return{framerate:void 0,isShowingTicks:void 0,maxX:void 0,maxY:void 0,minX:void 0,minY:void 0,patchSize:void 0,tickLabel:void 0,turtleLabelSize:void 0,wrapsInX:void 0,wrapsInY:void 0}},computed:{topology:{get:function(){return this.get("wrapsInX")?this.get("wrapsInY")?"Torus":"Horizontal Cylinder":this.get("wrapsInY")?"Vertical Cylinder":"Box"}}},twoway:!1,components:{coordInput:mt,formCheckbox:Ze,formFontSize:rt,labeledInput:tt,spacer:nt},genProps:function(e){return{"dimensions.maxPxcor":Number.parseInt(e.maxX.value),"dimensions.maxPycor":Number.parseInt(e.maxY.value),"dimensions.minPxcor":Number.parseInt(e.minX.value),"dimensions.minPycor":Number.parseInt(e.minY.value),"dimensions.patchSize":Number.parseInt(e.patchSize.value),"dimensions.wrappingAllowedInX":e.wrapsInX.checked,"dimensions.wrappingAllowedInY":e.wrapsInY.checked,fontSize:Number.parseInt(e.turtleLabelSize.value),frameRate:Number.parseInt(e.framerate.value),showTickCounter:e.isShowingTicks.checked,tickCounterLabel:e.tickLabel.value}},partials:{title:"Model Settings",widgetFields:'{{>worldSet}}\n<spacer height="10px" />\n{{>viewSet}}\n<spacer height="10px" />\n{{>tickCounterSet}}',worldSet:'<fieldset class="widget-edit-fieldset">\n  <legend class="widget-edit-legend">World</legend>\n  <div class="flex-row">\n    {{>coordColumn}}\n    <spacer width="8%" />\n    {{>wrappingColumn}}\n  </div>\n</fieldset>',coordColumn:'<div class="flex-column">\n\n  <coordInput id="{{id}}-min-x" label="min-pxcor:" name="minX" value="{{minX}}"\n              min="-50000" max="0" hint="minimum x coordinate for patches" />\n\n  <coordInput id="{{id}}-max-x" label="max-pxcor:" name="maxX" value="{{maxX}}"\n              min="0" max="50000" hint="maximum x coordinate for patches" />\n\n  <coordInput id="{{id}}-min-y" label="min-pycor:" name="minY" value="{{minY}}"\n              min="-50000" max="0" hint="minimum y coordinate for patches" />\n\n  <coordInput id="{{id}}-max-y" label="max-pycor:" name="maxY" value="{{maxY}}"\n              min="0" max="50000" hint="maximum y coordinate for patches" />\n\n</div>',wrappingColumn:'<div class="flex-column">\n  <formCheckbox id="{{id}}-wraps-in-x" isChecked="{{ wrapsInX }}"\n                labelText="Wraps horizontally" name="wrapsInX" />\n  <spacer height="10px" />\n  <formCheckbox id="{{id}}-wraps-in-y" isChecked="{{ wrapsInY }}"\n                labelText="Wraps vertically" name="wrapsInY" />\n</div>',viewSet:'<fieldset class="widget-edit-fieldset">\n  <legend class="widget-edit-legend">View</legend>\n  <div class="flex-row">\n    <div class="flex-column" style="flex-grow: 1;">\n      <labeledInput id="{{id}}-patch-size" labelStr="Patch size:"\n                    name="patchSize" type="number" value="{{patchSize}}"\n                    attrs="min=-1 step=\'any\' required" />\n      <div class="widget-edit-hint-text">measured in pixels</div>\n    </div>\n    <spacer width="20px" />\n    <div class="flex-column" style="flex-grow: 1;">\n      <formFontSize id="{{id}}-turtle-label-size" name="turtleLabelSize" value="{{turtleLabelSize}}"/>\n      <div class="widget-edit-hint-text">of labels on agents</div>\n    </div>\n  </div>\n\n  <spacer height="10px" />\n\n  <labeledInput id="{{id}}-framerate" labelStr="Frame rate:" name="framerate"\n                style="text-align: right;" type="number" value="{{framerate}}"\n                attrs="min=0 step=\'any\' required" />\n  <div class="widget-edit-hint-text">Frames per second at normal speed</div>\n\n</fieldset>',tickCounterSet:'<fieldset class="widget-edit-fieldset">\n  <legend class="widget-edit-legend">Tick Counter</legend>\n  <formCheckbox id="{{id}}-is-showing-ticks" isChecked="{{ isShowingTicks }}"\n                labelText="Show tick counter" name="isShowingTicks" />\n  <spacer height="10px" />\n  <labeledInput id="{{id}}-tick-label" labelStr="Tick counter label:" name="tickLabel"\n                style="width: 230px;" type="text" value="{{tickLabel}}" />\n</fieldset>'}});var yt,bt,xt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit],resizeDirs:["topLeft","topRight","bottomLeft","bottomRight"],ticks:void 0}},components:{editForm:vt},eventTriggers:function(){return{fontSize:[this._weg.redrawView],"dimensions.maxPxcor":[this._weg.resizeView,this._weg.redrawView],"dimensions.maxPycor":[this._weg.resizeView,this._weg.redrawView],"dimensions.minPxcor":[this._weg.resizeView,this._weg.redrawView],"dimensions.minPycor":[this._weg.resizeView,this._weg.redrawView],"dimensions.patchSize":[this._weg.resizePatches,this._weg.redrawView],"dimensions.wrappingAllowedInX":[this._weg.updateTopology,this._weg.redrawView],"dimensions.wrappingAllowedInY":[this._weg.updateTopology,this._weg.redrawView]}},handleResize:function({left:e,right:t,top:n,bottom:i}){var r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x;e>=0&&n>=0&&(f=this.get("left"),g=this.get("right"),m=this.get("top"),v=g-f,p=(h=this.get("bottom"))-m,u=t-e,c=i-n,y=Math.abs(v-u)>Math.abs(p-c)?c/p:u/v,o=(w=parseFloat((this.get("widget.dimensions.patchSize")*y).toFixed(2)))*(this.get("widget.dimensions.maxPxcor")-this.get("widget.dimensions.minPxcor")+1)-v,a=w*(this.get("widget.dimensions.maxPycor")-this.get("widget.dimensions.minPycor")+1)-p,l=e!==f,d=n!==m,[x,r]=d?[m-a,i]:[n,h+a],[s,b]=l?[f-o,t]:[e,g+o],s>=0&&x>=0&&(this.set("widget.top",Math.round(x)),this.set("widget.bottom",Math.round(r)),this.set("widget.left",Math.round(s)),this.set("widget.right",Math.round(b)),this.findComponent("editForm").set("patchSize",w)))},handleResizeEnd:function(){this.fire("set-patch-size",this.findComponent("editForm").get("patchSize"))},minWidth:10,minHeight:10,template:'{{>editorOverlay}}\n{{>view}}\n<editForm idBasis="view" style="width: 510px;"\n          maxX="{{widget.dimensions.maxPxcor}}" maxY="{{widget.dimensions.maxPycor}}"\n          minX="{{widget.dimensions.minPxcor}}" minY="{{widget.dimensions.minPycor}}"\n          wrapsInX="{{widget.dimensions.wrappingAllowedInX}}" wrapsInY="{{widget.dimensions.wrappingAllowedInY}}"\n          patchSize="{{widget.dimensions.patchSize}}" turtleLabelSize="{{widget.fontSize}}"\n          framerate="{{widget.frameRate}}"\n          isShowingTicks="{{widget.showTickCounter}}" tickLabel="{{widget.tickCounterLabel}}" />',partials:{view:'<div id="{{id}}" class="netlogo-widget netlogo-view-container {{classes}}" style="{{dims}}"></div>'}});yt=Ractive.extend({template:'<div class="flex-column" style="align-items: center; flex-grow: 1; max-width: 140px;">\n  {{ yield }}\n</div>'}),bt=Qe.extend({data:function(){return{bottom:void 0,direction:void 0,left:void 0,maxCode:void 0,minCode:void 0,right:void 0,stepCode:void 0,top:void 0,units:void 0,value:void 0,variable:void 0}},twoway:!1,components:{column:yt,formCheckbox:Ze,formMaxCode:lt,formMinCode:lt,formStepCode:lt,formVariable:pt,labeledInput:tt,spacer:nt},genProps:function(e){var t,n,i,r,o,a,s;return s=Number.parseFloat(e.value.value),o=this.get("top"),r=this.get("right"),n=this.get("bottom"),i=this.get("left"),[a,t]="horizontal"===this.get("direction")&&e.vertical.checked||"vertical"===this.get("direction")&&!e.vertical.checked?[i+(n-o),o+(r-i)]:[r,n],{bottom:t,currentValue:s,default:s,direction:e.vertical.checked?"vertical":"horizontal",display:e.variable.value,max:this.findComponent("formMaxCode").findComponent("codeContainer").get("code"),min:this.findComponent("formMinCode").findComponent("codeContainer").get("code"),right:a,step:this.findComponent("formStepCode").findComponent("codeContainer").get("code"),units:""!==e.units.value?e.units.value:void 0,variable:e.variable.value.toLowerCase()}},partials:{title:"Slider",widgetFields:'<formVariable id="{{id}}-varname" name="variable" value="{{variable}}"/>\n\n<spacer height="15px" />\n\n<div class="flex-row" style="align-items: stretch; justify-content: space-around">\n  <column>\n    <formMinCode id="{{id}}-min-code" label="Minimum" name="minCode" config="{ scrollbarStyle: \'null\' }"\n                 style="width: 100%;" value="{{minCode}}" />\n  </column>\n  <column>\n    <formStepCode id="{{id}}-step-code" label="Increment" name="stepCode" config="{ scrollbarStyle: \'null\' }"\n                  style="width: 100%;" value="{{stepCode}}" />\n  </column>\n  <column>\n    <formMaxCode id="{{id}}-max-code" label="Maximum" name="maxCode" config="{ scrollbarStyle: \'null\' }"\n                 style="width: 100%;" value="{{maxCode}}" />\n  </column>\n</div>\n\n<div class="widget-edit-hint-text" style="margin-left: 4px; margin-right: 4px;">min, increment, and max may be numbers or reporters</div>\n\n<div class="flex-row" style="align-items: center;">\n  <labeledInput id="{{id}}-value" labelStr="Default value:" name="value" type="number" value="{{value}}" attrs="required step=\'any\'"\n                style="flex-grow: 1; text-align: right;" />\n  <labeledInput id="{{id}}-units" labelStr="Units:" labelStyle="margin-left: 10px;" name="units" type="text" value="{{units}}"\n                style="flex-grow: 1; padding: 4px;" />\n</div>\n\n<spacer height="15px" />\n\n<formCheckbox id="{{id}}-vertical" isChecked="{{ direction === \'vertical\' }}" labelText="Vertical?"\n              name="vertical" />'}});var kt,_t=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],errorClass:void 0}},on:{"reset-if-invalid":function(e){return e.node.validity.rangeOverflow?this.set("widget.currentValue",this.get("widget.maxValue")):e.node.validity.rangeUnderflow?this.set("widget.currentValue",this.get("widget.minValue")):void 0}},computed:{resizeDirs:{get:function(){return"vertical"!==this.get("widget.direction")?["left","right"]:["top","bottom"]},set:function(){}},textWidth:function(){var e,t;return(null!=(e=null!=(t=this.get("widget").currentValue)?t.toString().length:void 0)?e:0)+3}},components:{editForm:bt},eventTriggers:function(){return{currentValue:[this._weg.updateEngineValue],max:[this._weg.recompile],min:[this._weg.recompile],step:[this._weg.recompile],variable:[this._weg.recompile,this._weg.rename]}},minWidth:60,minHeight:33,template:'{{>editorOverlay}}\n{{>slider}}\n<editForm direction="{{widget.direction}}" idBasis="{{id}}" maxCode="{{widget.max}}"\n          minCode="{{widget.min}}" stepCode="{{widget.step}}" units="{{widget.units}}"\n          top="{{widget.top}}" right="{{widget.right}}" bottom="{{widget.bottom}}"\n          left="{{widget.left}}" value="{{widget.default}}" variable="{{widget.variable}}" />',partials:{slider:'<label id="{{id}}" class="netlogo-widget netlogo-slider netlogo-input {{errorClass}} {{classes}}"\n       style="{{ #widget.direction !== \'vertical\' }}{{dims}}{{else}}{{>verticalDims}}{{/}}">\n  <input type="range"\n         max="{{widget.maxValue}}" min="{{widget.minValue}}"\n         step="{{widget.stepValue}}" value="{{widget.currentValue}}"\n         {{# isEditing }}disabled{{/}} />\n  <div class="netlogo-slider-label">\n    <span class="netlogo-label" on-click="[\'show-widget-errors\', widget]">{{widget.display}}</span>\n    <span class="netlogo-slider-value">\n      <input type="number" on-change="reset-if-invalid"\n             style="width: {{textWidth}}ch"\n             min="{{widget.minValue}}" max="{{widget.maxValue}}"\n             value="{{widget.currentValue}}" step="{{widget.stepValue}}"\n             {{# isEditing }}disabled{{/}} />\n      {{#widget.units}}{{widget.units}}{{/}}\n    </span>\n  </div>\n</label>',verticalDims:"position: absolute;\nleft: {{ left }}px; top: {{ top }}px;\nwidth: {{ bottom - top }}px; height: {{ right - left }}px;\ntransform: translateY({{ bottom - top }}px) rotate(270deg);\ntransform-origin: top left;"}});kt=Qe.extend({data:function(){return{choices:void 0,display:void 0,setHiddenInput:function(e){var t,n;return(t=this.find(`#${this.get("id")}-choices-hidden`)).value=e,n=function(){try{return Converter.stringToJSValue(`[${e}]`),""}catch(e){return"Invalid format: Must be a space-separated list of NetLogo literal values"}}(),t.setCustomValidity(n)}}},twoway:!1,components:{formCode:st,formVariable:pt},computed:{chooserChoices:{get:function(){return this.get("choices").map((function(e){return workspace.dump(e,!0)})).join("\n")}}},genProps:function(e){var t,n;return n=e.varName.value,t=this.findComponent("formCode").findComponent("codeContainer").get("code"),{choices:Converter.stringToJSValue(`[${t}]`),display:n,variable:n.toLowerCase()}},partials:{title:"Chooser",widgetFields:'<formVariable id="{{id}}-varname" value="{{display}}"        name="varName" />\n<formCode     id="{{id}}-choices" value="{{chooserChoices}}" name="codeChoices"\n              label="Choices" config="{}" style="" onchange="{{setHiddenInput}}" />\n<input id="{{id}}-choices-hidden" name="trueCodeChoices" class="all-but-hidden"\n       style="margin: -5px 0 0 7px;" type="text" />\n<div class="widget-edit-hint-text">Example: "a" "b" "c" 1 2 3</div>'}});var Ct,Et=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],resizeDirs:["left","right"]}},observe:{"widget.currentValue":function(){var e,t;return e=(t=this.get("widget")).choices.findIndex((function(e){return e===t.currentValue})),this.set("widget.currentChoice",e>=0?e:0)}},components:{editForm:kt},eventTriggers:function(){return{choices:[this._weg.refreshChooser],variable:[this._weg.recompile,this._weg.rename]}},minWidth:55,minHeight:45,template:'{{>editorOverlay}}\n<label id="{{id}}" class="netlogo-widget netlogo-chooser netlogo-input {{classes}}" style="{{dims}}">\n  <span class="netlogo-label">{{widget.display}}</span>\n  <select class="netlogo-chooser-select" value="{{widget.currentValue}}"{{# isEditing }} disabled{{/}} >\n  {{#widget.choices}}\n    <option class="netlogo-chooser-option" value="{{.}}">{{>literal}}</option>\n  {{/}}\n  </select>\n</label>\n<editForm idBasis="{{id}}" choices="{{widget.choices}}" display="{{widget.display}}" />',partials:{literal:'{{# typeof . === "string"}}{{.}}{{/}}\n{{# typeof . === "number"}}{{.}}{{/}}\n{{# typeof . === "boolean"}}{{.}}{{/}}\n{{# typeof . === "object"}}\n  [{{#.}}\n    {{>literal}}\n  {{/}}]\n{{/}}'}});Ct=Qe.extend({data:function(){return{display:void 0,fontSize:void 0,precision:void 0,source:void 0}},components:{formCode:st,formFontSize:rt,labeledInput:tt,spacer:nt},twoway:!1,genProps:function(e){var t;return t=parseInt(e.fontSize.value),{display:""!==e.display.value?e.display.value:void 0,fontSize:t,bottom:this.parent.get("widget.top")+2*t+23,precision:parseInt(e.precision.value),source:this.findComponent("formCode").findComponent("codeContainer").get("code")}},partials:{title:"Monitor",widgetFields:'<formCode id="{{id}}-source" name="source" value="{{source}}" label="Reporter" />\n\n<spacer height="15px" />\n\n<div class="flex-row" style="align-items: center;">\n  <labeledInput id="{{id}}-display" labelStr="Display name:" name="display" class="widget-edit-inputbox" type="text" value="{{display}}" />\n</div>\n\n<spacer height="15px" />\n\n<div class="flex-row" style="align-items: center; justify-content: space-between;">\n\n  <label for="{{id}}">Decimal places: </label>\n  <input  id="{{id}}" name="precision" placeholder="(Required)"\n          class="widget-edit-inputbox" style="width: 70px;"\n          type="number" value="{{precision}}" min=-30 max=17 step=1 required />\n  <spacer width="50px" />\n  <formFontSize id="{{id}}-font-size" name="fontSize" value="{{fontSize}}"/>\n\n</div>'}});var St,At=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],errorClass:void 0,resizeDirs:["left","right"]}},components:{editForm:Ct},eventTriggers:function(){return{source:[this._weg.recompile]}},minWidth:20,minHeight:45,template:'{{>editorOverlay}}\n{{>monitor}}\n<editForm idBasis="{{id}}" display="{{widget.display}}" fontSize="{{widget.fontSize}}"\n          precision="{{widget.precision}}" source="{{widget.source}}" />',partials:{monitor:'<div id="{{id}}" class="netlogo-widget netlogo-monitor netlogo-output {{classes}}"\n     style="{{dims}} font-size: {{widget.fontSize}}px;">\n  <label class="netlogo-label {{errorClass}}" on-click="[\'show-widget-errors\', widget]">\n    {{widget.display || widget.source}}\n  </label>\n  <output class="netlogo-value">{{widget.currentValue}}</output>\n</div>'}}),Tt=function(){class e{static findProcedureNames(t,n){var i,r,o;for(i=function(){switch(n){case"upper":return function(e){return e.toUpperCase()};case"lower":return function(e){return e.toLowerCase()};case"as-written":return function(e){return e}}}(),o={},e.procedureNameFinder.lastIndex=0;r=e.procedureNameFinder.exec(t);)o[i(r[1])]=r.index+r[0].length;return o}}return e.procedureNameFinder=/^\s*(?:to|to-report)\s(?:\s*;.*\n)*\s*(\w\S*)/gm,e}.call(this),Pt=Ractive.extend({data:function(){return{code:void 0,isReadOnly:void 0,jumpToProcedure:void 0,jumpToCode:void 0,lastCompiledCode:void 0,lastCompileFailed:!1,procedureNames:{},autoCompleteStatus:!1,codeUsage:[],usageVisibility:!1,selectedCode:void 0,usageLeft:void 0,usageTop:void 0}},components:{codeEditor:at},computed:{isStale:"(code !== lastCompiledCode) || lastCompileFailed"},setCode:function(e){this.findComponent("codeEditor").setCode(e)},setupProceduresDropdown:function(){$("#procedurenames-dropdown").chosen({search_contains:!0}),$("#procedurenames-dropdown").on("change",(()=>{var e,t;return e=this.get("procedureNames")[t=$("#procedurenames-dropdown").val()],this.findComponent("codeEditor").highlightProcedure(t,e)})),$("#procedurenames-dropdown").on("chosen:showing_dropdown",(()=>this.setProcedureNames()))},setProcedureNames:function(){var e;e=Tt.findProcedureNames(this.get("code"),"as-written"),this.set("procedureNames",e),$("#procedurenames-dropdown").trigger("chosen:updated")},setupAutoComplete:function(e){CodeMirror.registerHelper("hintWords","netlogo",e),this.findComponent("codeEditor").getEditor().on("keyup",((e,t)=>{if(!e.state.completionActive&&t.keyCode>64&&t.keyCode<91&&this.get("autoCompleteStatus"))return e.showHint({completeSingle:!1})}))},netLogoHintHelper:function(e,t){var n,i,r,o,a,s;if(n=e.getCursor(),s=e.getTokenAt(n),a=CodeMirror.Pos(n.line,s.end),s.string&&/\S/.test(s.string[s.string.length-1])?(o=s.string,r=CodeMirror.Pos(n.line,s.start)):(o="",r=a),(i=t.words.filter((function(e){return e.slice(0,o.length)===o}))).length>0)return{list:i,from:r,to:a}},autoCompleteWords:function(){var e,t;return e=new Set(P.all),t=Array.from(e).filter((function(e){return!P.unsupported.includes(e)})).map((function(e){return e.replace("\\","")})),Object.keys(Tt.findProcedureNames(this.get("code"),"lower")).concat(t)},toggleLineComments:function(e){var t,n,i,r,o;({start:o,end:i}=e.somethingSelected()?(({head:r,anchor:t}=e.listSelections()[0]),r.line>t.line||r.line===t.line&&r.ch>t.ch?{start:t,end:r}:{start:r,end:t}):{start:n=e.getCursor(),end:n}),e.uncomment(o,i)||e.lineComment(o,i)},setupCodeUsagePopup:function(){var e,t;e={"Ctrl-U":()=>{if(t.somethingSelected())return this.setCodeUsage()},"Cmd-U":()=>{if(t.somethingSelected())return this.setCodeUsage()},"Ctrl-;":()=>{this.toggleLineComments(t)},"Cmd-;":()=>{this.toggleLineComments(t)}},(t=this.findComponent("codeEditor").getEditor()).addKeyMap(e),t.on("cursorActivity",(e=>{if(this.get("usageVisibility"))return this.set("usageVisibility",!1)}))},getCodeUsage:function(){var e,t,n,i,r,o,a,s,l;for(l=(i=this.findComponent("codeEditor").getEditor()).getSelection().trim(),this.set("selectedCode",l),t=this.get("code"),e=new RegExp(l,"gm"),n=[];a=e.exec(t);)o=(s=i.posFromIndex(a.index)).line+1,r=i.getLine(s.line),n.push({pos:s,lineNumber:o,line:r});return n},setCodeUsage:function(){var e,t,n;e=this.getCodeUsage(),t=this.findComponent("codeEditor").getEditor(),this.set("codeUsage",e),n=t.cursorCoords(t.getCursor()),this.set("usageLeft",n.left),this.set("usageTop",n.top),this.set("usageVisibility",!0)},jumpToProcedure:function(){var e,t;null!=(t=this.get("jumpToProcedure"))&&null!=(e=Tt.findProcedureNames(this.get("code"),"upper")[t.toUpperCase()])&&this.findComponent("codeEditor").set("jumpToProcedure",{procName:t,index:e})},jumpToCode:function(){var e;null!=(e=this.get("jumpToCode"))&&(this.set("jumpToCode",null),this.findComponent("codeEditor").set("jumpToCode",e))},on:{complete:function(e){this.setupProceduresDropdown(),CodeMirror.registerHelper("hint","fromList",this.netLogoHintHelper),this.setupAutoComplete(this.autoCompleteWords()),this.setupCodeUsagePopup(),this.jumpToProcedure(),this.jumpToCode()},recompile:function(e){this.setupAutoComplete(this.autoCompleteWords())},"jump-to-usage":function(e,t){var n,i,r,o;n=this.findComponent("codeEditor").getEditor(),r=this.get("selectedCode"),i=t,o=CodeMirror.Pos(i.line,i.ch+r.length),n.setSelection(o,i),this.set("usageVisibility",!1)}},observe:{jumpToProcedure:function(){return this.jumpToProcedure()},jumpToCode:function(){return this.jumpToCode()}},template:'<div id="netlogo-code-tab" class="netlogo-tab-content netlogo-code-container"\n  grow-in=\'{disable:"code-tab-toggle"}\' shrink-out=\'{disable:"code-tab-toggle"}\'>\n  <ul class="netlogo-codetab-widget-list">\n    <li class="netlogo-codetab-widget-listitem">\n      <select class="netlogo-procedurenames-dropdown" id="procedurenames-dropdown" data-placeholder="Jump to Procedure" tabindex="2">\n        {{#each procedureNames:name}}\n          <option value="{{name}}">{{name}}</option>\n        {{/each}}\n      </select>\n    </li>\n    <li class="netlogo-codetab-widget-listitem">\n      {{# !isReadOnly }}\n        <button class="netlogo-widget netlogo-ugly-button netlogo-recompilation-button{{#isEditing}} interface-unlocked{{/}}"\n            on-click="recompile" {{# !isStale }}disabled{{/}} >Recompile Code</button>\n      {{/}}\n    </li>\n    <li class="netlogo-codetab-widget-listitem">\n      <input type=\'checkbox\' class="netlogo-autocomplete-checkbox" checked=\'{{autoCompleteStatus}}\'>\n      <label class="netlogo-autocomplete-label">\n        Auto Complete {{# autoCompleteStatus}}Enabled{{else}}Disabled{{/}}\n      </label>\n    </li>\n  </ul>\n  <codeEditor id="netlogo-code-tab-editor" code="{{code}}"\n              injectedConfig="{ lineNumbers: true, readOnly: {{isReadOnly}} }"\n              extraClasses="[\'netlogo-code-tab\']" />\n</div>\n<div class="netlogo-codeusage-popup" style="left: {{usageLeft}}px; top: {{usageTop}}px;">\n  {{# usageVisibility}}\n    <ul class="netlogo-codeusage-list">\n      {{#each codeUsage}}\n        <li class="netlogo-codeusage-item" on-click="[ \'jump-to-usage\', this.pos ]">{{this.lineNumber}}: {{this.line}}</li>\n      {{/each}}\n    </ul>\n  {{/}}\n</div>'});St=Qe.extend({data:function(){return{display:void 0}},twoway:!1,components:{formVariable:pt},genProps:function(e){var t;return{display:t=e.variable.value,variable:t.toLowerCase()}},partials:{title:"Switch",widgetFields:'<formVariable id="{{id}}-varname" name="variable" value="{{display}}"/>'}});var Lt,It,zt,Bt,Mt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],resizeDirs:["left","right"]}},oninit:function(){return this._super(),Object.defineProperty(this.get("widget"),"on",{get:function(){return this.currentValue},set:function(e){return this.currentValue=e}})},components:{editForm:St},eventTriggers:function(){return{variable:[this._weg.recompile,this._weg.rename]}},minWidth:35,minHeight:33,template:'{{>editorOverlay}}\n{{>switch}}\n<editForm idBasis="{{id}}" display="{{widget.display}}" />',partials:{switch:'<label id="{{id}}" class="netlogo-widget netlogo-switcher netlogo-input {{classes}}" style="{{dims}}">\n  <input type="checkbox" checked="{{ widget.currentValue }}" {{# isEditing }} disabled{{/}} />\n  <span class="netlogo-label">{{ widget.display }}</span>\n</label>'}});Bt=(Lt=window.navigator.platform.startsWith("Mac"))?"&#8984;":"ctrl",It=function(e,t){return`<tr>\n  <td class="help-keys">${e.map((function(e){return"<kbd>"+e+"</kbd>"})).join("")}</td>\n  <td class="help-explanation">${t}</td>\n</tr>`},zt=function(e){return`<table class="help-key-table">\n  ${e.map((function([e,t]){return It(e,t)})).join("\n")}\n</table>`};var Ot,Rt=Ractive.extend({data:function(){return{isOverlayUp:void 0,isVisible:void 0,stateName:void 0,wareaHeight:void 0,wareaWidth:void 0}},observe:{isVisible:function(e,t){this.set("isOverlayUp",e),e?(setTimeout((()=>this.find("#help-dialog").focus()),0),this.fire("dialog-opened",this)):this.fire("dialog-closed",this)}},on:{"close-popup":function(){return this.set("isVisible",!1),!1},"handle-key":function({original:{keyCode:e}}){if(27===e)return this.fire("close-popup"),!1}},template:'<div id="help-dialog" class="help-popup"\n     style="{{# !isVisible }}display: none;{{/}} top: {{(wareaHeight * .1) + 150}}px; left: {{wareaWidth * .1}}px; width: {{wareaWidth * .8}}px; {{style}}"\n     on-keydown="handle-key" tabindex="0">\n  <div id="{{id}}-closer" class="widget-edit-closer" on-click="close-popup">X</div>\n  <div>{{>helpText}}</div>\n</div>',partials:{helpAuthoringEditWidget:zt([[["enter"],"submit form"],[["escape"],"close form and ignore any changes made"]]),helpAuthoringStandard:zt([[[Bt,"shift","l"],"switch to interactive mode"],[[Bt,"shift","h"],"toggle resizer visibility"],[["escape"],"close context menu if it is open, or deselect any selected widget"],[[Bt],'hold to ignore "snap to grid" while moving or resizing the selected widget'],[["&uarr;","&darr;","&larr;","&rarr;"],"move widget, irrespective of the grid"]].concat(Lt?[]:[[["delete"],"delete the selected widget"]])),helpInteractive:zt([[[Bt,"shift","l"],"switch to authoring mode"],[[Bt,"u"],"find all usages of selected text (when in NetLogo Code editor)"],[[Bt,";"],"comment/uncomment a line of code (when in NetLogo Code editor)"]]),helpText:"<table>\n  {{# stateName === 'interactive' }}\n    {{>helpInteractive}}\n  {{elseif stateName === 'authoring - plain' }}\n    {{>helpAuthoringStandard}}\n  {{elseif stateName === 'authoring - editing widget' }}\n    {{>helpAuthoringEditWidget}}\n  {{else}}\n    Invalid help state.\n  {{/}}\n</table>"}}),Nt=Ractive.extend({data:function(){return{fontSize:void 0,id:void 0,output:void 0}},observe:{output:function(){return this.update("output").then((()=>{var e;return null!=(e=this.find("#"+this.get("id")))?e.scrollTop=e.scrollHeight:void 0}))}},template:"<pre id='{{id}}' class='netlogo-output-area'\n     style=\"font-size: {{fontSize}}px;\">{{output}}</pre>"}),Ut=Ractive.extend({data:function(){return{input:"",isEditing:void 0,agentTypes:["observer","turtles","patches","links"],agentTypeIndex:0,checkIsReporter:void 0,history:[],historyIndex:0,workingEntry:{},output:""}},computed:{agentType:{get:function(){return this.get("agentTypes")[this.get("agentTypeIndex")]},set:function(e){var t;if((t=this.get("agentTypes").indexOf(e))>=0)return this.set("agentTypeIndex",t),this.focusCommandCenterEditor()}}},components:{printArea:Nt},onrender:function(){var e,t,n,i;return e=()=>this.set("agentTypeIndex",(this.get("agentTypeIndex")+1)%this.get("agentTypes").length),n=e=>{var t,n;return(n=this.get("historyIndex")+e)<0?n=0:n>this.get("history").length&&(n=this.get("history").length),this.get("historyIndex")===this.get("history").length&&this.set("workingEntry",{agentType:this.get("agentType"),input:this.get("input")}),n===this.get("history").length?this.set(this.get("workingEntry")):(t=this.get("history")[n],this.set(t)),this.set("historyIndex",n)},i=()=>{var e,t,n,i;if((n=this.get("input")).trim().length>0)return e=this.get("agentType"),this.get("checkIsReporter")(n)&&(n=`show ${n}`),this.set("output",`${this.get("output")}${e}> ${n}\n`),(i=(t=this.get("history")).length>0?t[t.length-1]:{agentType:"",input:""}).input===n&&i.agentType===e||t.push({agentType:e,input:n}),this.set("historyIndex",t.length),"observer"!==e&&(n=`ask ${e} [ ${n} ]`),this.fire("run",{},"console",n),this.set("input",""),this.set("workingEntry",{})},this.on("clear-history",(function(){return this.set("output","")})),t=CodeMirror(this.find(".netlogo-command-center-editor"),{value:this.get("input"),mode:"netlogo",theme:"netlogo-default",scrollbarStyle:"null",extraKeys:{Enter:i,Up:()=>n(-1),Down:()=>n(1),Tab:()=>e()}}),this.focusCommandCenterEditor=function(){return t.focus()},t.on("beforeChange",(function(e,t){var n;return n=t.text.join("").replace(/\n/g,""),t.update(t.from,t.to,[n]),!0})),t.on("change",(()=>this.set("input",t.getValue()))),this.observe("input",(function(e){if(e!==t.getValue())return t.setValue(e),t.execCommand("goLineEnd")})),this.observe("isEditing",(function(e){var n;t.setOption("readOnly",!!e&&"nocursor"),n=this.find(".netlogo-command-center-editor").querySelector(".CodeMirror-scroll").classList,e?n.add("cm-disabled"):n.remove("cm-disabled")}))},appendText:function(e){this.set("output",this.get("output")+e)},template:"<div class='netlogo-tab-content netlogo-command-center'\n     grow-in='{disable:\"console-toggle\"}' shrink-out='{disable:\"console-toggle\"}'>\n  <printArea id='command-center-print-area' output='{{output}}'/>\n\n  <div class='netlogo-command-center-input'>\n    <label>\n      <select value=\"{{agentType}}\">\n      {{#agentTypes}}\n        <option value=\"{{.}}\">{{.}}</option>\n      {{/}}\n      </select>\n    </label>\n    <div class=\"netlogo-command-center-editor\"></div>\n    <button on-click='clear-history'>Clear</button>\n  </div>\n</div>"});Ot=Qe.extend({data:function(){return{fontSize:void 0}},twoway:!1,components:{formFontSize:rt},genProps:function(e){return{fontSize:parseInt(e.fontSize.value)}},partials:{title:"Output",widgetFields:'<formFontSize id="{{id}}-font-size" name="fontSize" style="margin-left: 0;" value="{{fontSize}}"/>'}});var Dt,Vt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],text:void 0}},components:{editForm:Ot,printArea:Nt},eventTriggers:function(){return{}},appendText:function(e){this.set("text",this.get("text")+e)},setText:function(e){this.set("text",e)},minWidth:15,minHeight:25,template:'{{>editorOverlay}}\n{{>output}}\n<editForm idBasis="{{id}}" fontSize="{{widget.fontSize}}" style="width: 285px;" />',partials:{output:'<div id="{{id}}" class="netlogo-widget netlogo-output netlogo-output-widget {{classes}}" style="{{dims}}">\n  <printArea id="{{id}}-print-area" fontSize="{{widget.fontSize}}" output="{{text}}" />\n</div>'}});Dt=Ractive.extend({data:function(){return{isEditing:!1}},onrender:function(){var e;return(e=CodeMirror(this.find(".netlogo-info-editor"),{value:this.get("rawText"),tabsize:2,mode:"markdown",theme:"netlogo-default",editing:this.get("isEditing"),lineWrapping:!0})).on("change",(()=>(this.set("rawText",e.getValue()),this.set("info",e.getValue()))))},template:"<div class='netlogo-info-editor'></div>"});var Ft,$t,jt,Wt=Ractive.extend({components:{infoeditor:Dt},computed:{sanitizedText:function(){return this.mdToHTML(this.get("rawText"))}},mdToHTML:function(e){return window.html_sanitize(window.markdown.toHTML(e),(function(e){return/^https?:\/\//.test(e)?e:void 0}),(function(e){return e}))},template:"<div class='netlogo-tab-content netlogo-info'\n     grow-in='{disable:\"info-toggle\"}' shrink-out='{disable:\"info-toggle\"}'>\n  {{# !isEditing }}\n    <div class='netlogo-info-markdown'>{{{sanitizedText}}}</div>\n  {{ else }}\n    <infoeditor rawText='{{rawText}}' />\n  {{ / }}\n</div>"}),Ht=Xe.extend({data:function(){return{contextMenuOptions:[{text:"Edit",isEnabled:!0,action:()=>this.fire("edit-title")}],isEditing:void 0,title:void 0}},on:{"edit-title":function(){var e,t,n,i;e=function(e){return""===e?"Untitled":e},this.get("isEditing")&&(n=this.get("title"),t=prompt("Enter a new name for your model",n),this.set("title",null!=(i=e(t))?i:n))}},template:'<div class="netlogo-model-masthead">\n  <div class="flex-row netlogo-model-title-wrapper">\n    <h2 id="netlogo-title"\n        on-contextmenu="@this.fire(\'show-context-menu\', @event)"\n        class="netlogo-widget netlogo-model-title {{classes}}{{# isEditing }} interface-unlocked initial-color{{/}}"\n        on-dblclick="edit-title">\n      {{ title }}\n    </h2>\n  </div>\n</div>'});jt=function(e){var t,n,i;return[i,n,t]=Ve(e),(-1<<24)+(i<<16)+(n<<8)+t},Ft=Ractive.extend({data:function(){return{color:void 0,display:void 0,index:void 0,interval:void 0,isExpanded:!1,modeIndex:void 0,setupCode:void 0,shouldShowInLegend:void 0,updateCode:void 0}},components:{colorInput:et,formCheckbox:Ke,formCode:st,labeledInput:tt,spacer:nt},computed:{id:function(){return`${this.parent.get("id")}-pen-${this.get("index")}`},mode:{get:function(){return["Line","Bar","Point"][this.get("modeIndex")]},set:function(e){return this.set("modeIndex",["Line","Bar","Point"].indexOf(e))}},nlColor:{get:function(){var e,t,n,i;return n=function(e){return Number(e).toString(16).padStart(2,"0")},i=(65280&(t=this.get("color")))>>8,e=255&t,Ie(`#${n((16711680&t)>>16)}${n(i)}${n(e)}`)},set:function(e){this.set("color",jt(e))}}},on:{"*.code-changed":function({component:e},t){var n;return(n=e.get("id")).endsWith("setup-code")?this.set("setupCode",t):n.endsWith("update-code")?this.set("updateCode",t):console.warn("Unknown plot pen code container!",e),!1},"remove-pen":function(){return this.parent.fire("remove-child-pen",this.get("index")),!1},"validate-name":function({ractive:e}){var t,n,i,r;return n=this.getTitleElem(),t=n.value.toUpperCase(),i=function(n){return n.get("display").toUpperCase()===t&&n!==e},r=e.parent.findAllComponents("formPen").some(i)?`There is already a pen with the name '${n.value}'`:"",n.setCustomValidity(r),!1}},getTitleElem:function(){return this.find(`#${this.get("id")}-name`)},template:'<div class="flex-column plot-pen-row{{#isExpanded}} open{{/}}">\n  <div class="flex-row">\n    <label for="{{id}}-is-expanded" class="expander widget-edit-checkbox-wrapper">\n      <input id="{{id}}-is-expanded" class="widget-edit-checkbox"\n             style="display: none;" type="checkbox"\n             checked="{{isExpanded}}" twoway="true" />\n      <span class="widget-edit-input-label expander-label">&#9654;</span>\n    </label>\n    <colorInput id="{{id}}-color" name="color" value="{{nlColor}}" style="min-height: 33px; min-width: 33px;" />\n    <input id="{{id}}-name" name="name" type="text" placeholder="(Required)"\n           class="widget-edit-text widget-edit-input widget-edit-inputbox"\n           style="border-radius: 4px; margin: auto 10px;" value="{{display}}"\n           on-input="validate-name" required />\n    <input class="plot-pen-delete" type="button" on-click="remove-pen" value="Delete" />\n  </div>\n  {{# isExpanded }}\n    <spacer height="10px" />\n    <div class="flex-row" style="justify-content: space-between;">\n      <select id="{{id}}-mode" name="mode" class="widget-edit-dropdown" style="margin-left: 0; width: 80px;" value="{{mode}}">\n        <option value="Line" >Line </option>\n        <option value="Bar"  >Bar  </option>\n        <option value="Point">Point</option>\n      </select>\n      <div>\n        <label for="{{id}}-interval" class="widget-edit-input-label" style="margin-right: 5px;">Interval:</label>\n        <input id="{{id}}-interval" name="interval" class="widget-edit-text widget-edit-input widget-edit-inputbox"\n               style="margin: 0 10px 0 0; width: 70px;" min="0" max="10000" type="number" value="{{interval}}">\n      </div>\n      <formCheckbox id="{{id}}-in-legend?" isChecked={{shouldShowInLegend}} labelText="In legend?" name="legend" />\n    </div>\n    <spacer height="10px" />\n    <formCode id="{{id}}-setup-code"  name="setupCode"  value="{{setupCode}}"  label="Pen setup commands"   style="width: 100%;" />\n    <spacer height="10px" />\n    <formCode id="{{id}}-update-code" name="updateCode" value="{{updateCode}}" label="Pen update commands"  style="width: 100%;" />\n    <spacer height="10px" />\n  {{/}}\n</div>'}),$t=Qe.extend({data:function(){return{autoPlotOn:void 0,display:void 0,guiPens:void 0,legendOn:void 0,pens:void 0,setupCode:void 0,updateCode:void 0,xLabel:void 0,xMax:void 0,xMin:void 0,yLabel:void 0,yMax:void 0,yMin:void 0}},components:{formCheckbox:Ze,formCode:st,formPen:Ft,labeledInput:tt,spacer:nt},twoway:!1,_oldName:void 0,_trackedPens:void 0,_clonePens:function(e){var t;return(null!=(t=window.structuredClone)?t:function(e){return JSON.parse(JSON.stringify(e))})(e)},getOldName:function(){return this._oldName},getRenamings:function(){var e;return e=function(e,{name:t,pen:{display:n}}){return t!==n&&(e[t]=n),e},this._trackedPens.reduce(e,{})},genProps:function(e){var t,n,i,r,o;return n=function(e){return function(t){return e.findAllComponents("formCode").find((function(e){return e.get("id")===t})).findComponent("codeContainer").get("code")}},r=null!=e.name.length?e.name[0].value:e.name.value,t={recompileForPlot:this.get("amProvingMyself")},i=this.get("guiPens"),o=this._clonePens(i),this.set("guiPens",[]),{autoPlotOn:e.autoPlotOn.checked,display:r,legendOn:e.legendOn.checked,pens:o,setupCode:n(this)(`${this.get("id")}-setup-code`),updateCode:n(this)(`${this.get("id")}-update-code`),xAxis:e.xLabel.value,xmax:e.xMax.valueAsNumber,xmin:e.xMin.valueAsNumber,yAxis:e.yLabel.value,ymax:e.yMax.valueAsNumber,ymin:e.yMin.valueAsNumber,__extras:t}},on:{"add-new":function(){var e,t,n,i,r,o,a,s,l;return e=function(){var e,t;for(t=[],i=e=0;e<=13;i=++e)t.push(5+10*i);return t}(),a=this.findAllComponents("formPen").map((function(e){return e.get("nlColor")})),l=new Set(a),o=null!=(s=e.find((function(e){return!l.has(e)})))?s:0,n={color:jt(o),display:`Pen ${this.get("guiPens").length+1}`,inLegend:!0,interval:1,mode:0,setupCode:"",type:"pen",updateCode:""},this.get("guiPens").push(n),this.update("guiPens"),(r=(t=this.findAllComponents("formPen"))[t.length-1]).set("isExpanded",!0),r.fire("validate-name"),!1},"cancel-edit":function(){return this.set("guiPens",[]),!0},init:function(){return this._oldName="",this._trackedPens=[],null==this.get("pens")&&this.set("pens",[]),this.set("guiPens",[]),this.set("validateTitle",this.validateTitle)},"remove-child-pen":function(e,t){return this.splice("guiPens",t,1),!1},"show-yourself":function(){var e;return this._oldName=this.get("display"),e=this._clonePens(this.get("pens")),this._trackedPens=e.map((function(e){return{name:e.display,pen:e}})),this.set("guiPens",e),!0}},validateTitle:function(e){var t,n,i,r,o;return({node:i,ractive:r}=e),t=i.value.toUpperCase(),n=r.parent.parent.get("widget"),o=Object.values(r.parent.parent.parent.get("widgetObj")).filter((function(e){return"plot"===e.type})).some((function(e){return e.display.toUpperCase()===t&&e!==n}))?`There is already a plot with the name '${i.value}'`:"",i.setCustomValidity(o),!1},partials:{title:"Plot",widgetFields:'<spacer height="15px" />\n<div class="flex-column plot-editor" style="align-items: center;">\n  <labeledInput id="{{id}}-name" labelStr="Name:" name="name" type="text"\n                class="widget-edit-inputbox" placeholder="(Required)"\n                value="{{display}}" onInput="{{validateTitle}}"\n                attrs="required" />\n  <spacer height="10px" />\n  <div class="flex-row" style="justify-content: space-evenly;">\n    <div class="flex-column">\n      <div class="flex-row">\n        <label for="{{id}}-x-label" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">X label:</label>\n        <input id="{{id}}-x-label" name="xLabel" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="text" value="{{xLabel}}">\n      </div>\n      <spacer height="5px" />\n      <div class="flex-row">\n        <label for="{{id}}-x-min" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">X min:</label>\n        <input id="{{id}}-x-min" name="xMin" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="number" value="{{xMin}}">\n      </div>\n      <spacer height="5px" />\n      <div class="flex-row">\n        <label for="{{id}}-x-max" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">X max:</label>\n        <input id="{{id}}-x-max" name="xMax" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="number" value="{{xMax}}">\n      </div>\n    </div>\n    <spacer width="20px" />\n    <div class="flex-column">\n      <div class="flex-row">\n        <label for="{{id}}-y-label" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">Y label:</label>\n        <input id="{{id}}-y-label" name="yLabel" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="text" value="{{yLabel}}">\n      </div>\n      <spacer height="5px" />\n      <div class="flex-row">\n        <label for="{{id}}-y-min" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">Y min:</label>\n        <input id="{{id}}-y-min" name="yMin" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="number" value="{{yMin}}">\n      </div>\n      <spacer height="5px" />\n      <div class="flex-row">\n        <label for="{{id}}-y-max" class="widget-edit-input-label" style="margin-right: 0px; min-width: 70px;">Y max:</label>\n        <input id="{{id}}-y-max" name="yMax" class="widget-edit-text widget-edit-input widget-edit-inputbox" type="number" value="{{yMax}}">\n      </div>\n    </div>\n  </div>\n  <spacer height="10px" />\n  <div class="flex-row" style="justify-content: space-evenly; width: 100%;">\n    <formCheckbox id="{{id}}-auto-scale"  isChecked={{autoPlotOn}} labelText="Auto scale?"     name="autoPlotOn" />\n    <formCheckbox id="{{id}}-show-legend" isChecked={{legendOn}}   labelText="Display legend?" name="legendOn"   />\n  </div>\n  <spacer height="10px" />\n  <div class="flex-column" style="justify-content: left; width: 100%;">\n    <formCode id="{{id}}-setup-code" isCollapsible="true" isExpanded="false"\n              value="{{setupCode}}" label="Plot setup commands"\n              style="width: 100%;" />\n  </div>\n  <spacer height="10px" />\n  <div class="flex-column" style="justify-content: left; width: 100%;">\n    <formCode id="{{id}}-update-code" isCollapsible="true" isExpanded="false"\n              value="{{updateCode}}" label="Plot update commands"\n              style="width: 100%;" />\n  </div>\n  <spacer height="10px" />\n  <div class="flex-column" style="justify-content: left; margin-left: 18px; width: 100%;">Plot pens</div>\n  <div style="border: 2px solid black; overflow-y: auto; width: 95%;">\n    {{#each guiPens: index}}\n      <formPen color="{{color}}" display="{{display}}" index="{{index}}"\n               interval="{{interval}}" modeIndex="{{mode}}" setupCode="{{setupCode}}"\n               shouldShowInLegend="{{inLegend}}" updateCode="{{updateCode}}" />\n    {{/each}}\n    <input type="button" on-click="@this.fire(\'add-new\')" style="height: 26px; margin: 8px 0 8px 6px;" value="Add Pen" />\n  </div>\n</div>\n<spacer height="10px" />'}});var Yt,Xt,qt=Je.extend({data:function(){return{contextMenuOptions:[this.standardOptions(this).edit,this.standardOptions(this).delete],menuIsOpen:!1,resizeCallback:function(e,t){}}},components:{editForm:$t},eventTriggers:function(){return{autoPlotOn:[this._weg.recompileForPlot],display:[this._weg.recompileForPlot],legendOn:[this._weg.recompileForPlot],pens:[this._weg.recompileForPlot],setupCode:[this._weg.recompileForPlot],updateCode:[this._weg.recompileForPlot],xAxis:[this._weg.recompileForPlot],xmax:[this._weg.recompileForPlot],xmin:[this._weg.recompileForPlot],yAxis:[this._weg.recompileForPlot],ymax:[this._weg.recompileForPlot],ymin:[this._weg.recompileForPlot]}},observe:{"left right top bottom":function(){this.get("resizeCallback")(this.get("right")-this.get("left"),this.get("bottom")-this.get("top"))}},on:{render:function(){var e,t,n;return e=this,t=document.querySelector(`#${this.get("id")}`),(n=new MutationObserver((function(t){return t.forEach((function({addedNodes:t}){var i,r;if(null!=(i=Array.from(t).find((function(e){return e.classList.contains("highcharts-container")}))))return n.disconnect(),(r=new MutationObserver((function(t){return t.forEach((function({addedNodes:t}){var n;if(null!=(n=Array.from(t).find((function(e){return e.classList.contains("highcharts-contextmenu")}))))return e.set("menuIsOpen",!0),r.disconnect(),new MutationObserver((function(){return e.set("menuIsOpen","none"!==n.style.display)})).observe(n,{attributes:!0})}))}))).observe(i,{childList:!0})}))}))).observe(t,{childList:!0})}},minWidth:100,minHeight:85,template:'{{>editorOverlay}}\n<div id="{{id}}" class="netlogo-widget netlogo-plot {{classes}}"\n     style="{{dims}}{{#menuIsOpen}}z-index: 10;{{/}}"></div>\n<editForm autoPlotOn={{widget.autoPlotOn}} display="{{widget.display}}" idBasis="{{id}}"\n          legendOn={{widget.legendOn}} pens="{{widget.pens}}"\n          setupCode="{{widget.setupCode}}" updateCode="{{widget.updateCode}}"\n          xLabel="{{widget.xAxis}}" xMin="{{widget.xmin}}" xMax="{{widget.xmax}}"\n          yLabel="{{widget.yAxis}}" yMin="{{widget.ymin}}" yMax="{{widget.ymax}}" />'}),Gt=Ractive.extend({_isLocked:!1,_xAdjustment:void 0,_yAdjustment:void 0,data:function(){return{isEnabled:!1,isVisible:!0,target:null}},computed:{dims:function(){return`position: absolute;\nleft: ${this.get("left")}px; top: ${this.get("top")}px;\nwidth: ${this.get("width")}px; height: ${this.get("height")}px;`},midX:function(){return this.get("width")/2-5},midY:function(){return this.get("height")/2-5},left:function(){return this.get("target").get("left")-5},right:function(){return this.get("target").get("right")+5},top:function(){return this.get("target").get("top")-5},bottom:function(){return this.get("target").get("bottom")+5},height:function(){return this.get("bottom")-this.get("top")},width:function(){return this.get("right")-this.get("left")}},clearTarget:function(){var e;e=this.get("target"),this._isLocked||null==e||(e.destroyed||e.set("isSelected",!1),this.set("target",null))},setTarget:function(e){this._isLocked||setTimeout((()=>(this.clearTarget(),this.set("target",e),e.set("isSelected",!0))),0)},lockTarget:function(e){this._isLocked||null==e||(this.setTarget(e),this._isLocked=!0)},unlockTarget:function(){this._isLocked=!1},on:{"start-handle-drag":function(e){return He.dragstart(this,e,(function(){return!0}),((e,t)=>{var n,i;return({left:n,top:i}=this.find(".widget-resizer").getBoundingClientRect()),this._xAdjustment=n-this.get("left"),this._yAdjustment=i-this.get("top")}))},"drag-handle":function(e){return He.drag(this,e,((t,n)=>{var i,r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E;return y=function(e){return e-(e-10*Math.round(e/10))},d=!(l=window.navigator.platform.startsWith("Mac"))&&!e.original.ctrlKey||l&&!e.original.metaKey,[b,x]=d?[t,n].map(y):[t,n],C=b-this._xAdjustment,E=x-this._yAdjustment,g=(k=this.get("target")).get("left"),m=k.get("right"),v=k.get("top"),p=k.get("bottom"),c=["left",C],w=["right",C],_=["top",E],r=["bottom",E],s=e.original.target.dataset.direction,i=function(){switch(s){case"Bottom":return[r];case"BottomLeft":return[r,c];case"BottomRight":return[r,w];case"Left":return[c];case"Right":return[w];case"Top":return[_];case"TopLeft":return[_,c];case"TopRight":return[_,w];default:throw new Error(`What the heck resize direction is '${s}'?`)}}(),o=(e,t)=>{var n,i,r;return i=function(){switch(e){case"left":return"right";case"right":return"left";case"top":return"bottom";case"bottom":return"top";default:throw new Error(`What the heck opposite direction is '${e}'?`)}}(),r=k.get(i),n=function(){switch(i){case"left":return Math.max(t,r+k.minWidth);case"top":return Math.max(t,r+k.minHeight);case"right":return Math.min(t,r-k.minWidth);case"bottom":return Math.min(t,r-k.minHeight);default:throw new Error(`No, really, what the heck opposite direction is '${i}'?`)}}(),Math.round(n)},u=(a=i.map((function([e,t]){return[e,o(e,t)]}))).every((function([e,t]){return!(("left"===e||"top"===e)&&t<0)}))?a.reduce((function(e,[t,n]){return e[t]=n,e}),{}):{},f={left:g,top:v,bottom:p,right:m},h=Object.assign(f,u),this.get("target").handleResize(h)}))},"stop-handle-drag":function(){return He.dragend(this,(()=>(this._xAdjustment=void 0,this._yAdjustment=void 0,this.get("target").handleResizeEnd())))}},template:'{{# isEnabled && isVisible && target !== null }}\n<div class="widget-resizer" style="{{dims}}">\n  {{ #target.get("resizeDirs").includes("bottom")      }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="Bottom"      style="cursor:  s-resize; bottom:          0; left:   {{midX}};"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("bottomLeft")  }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="BottomLeft"  style="cursor: sw-resize; bottom:          0; left:          0;"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("bottomRight") }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="BottomRight" style="cursor: se-resize; bottom:          0; right:         0;"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("left")        }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="Left"        style="cursor:  w-resize; bottom:   {{midY}}; left:          0;"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("right")       }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="Right"       style="cursor:  e-resize; bottom:   {{midY}}; right:         0;"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("top")         }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="Top"         style="cursor:  n-resize; top:             0; left:   {{midX}};"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("topLeft")     }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="TopLeft"     style="cursor: nw-resize; top:             0; left:          0;"></div>{{/}}\n  {{ #target.get("resizeDirs").includes("topRight")    }}<div draggable="true" on-drag="drag-handle" on-dragstart="start-handle-drag" on-dragend="stop-handle-drag" class="widget-resize-handle" data-direction="TopRight"    style="cursor: ne-resize; top:             0; right:         0;"></div>{{/}}\n</div>\n{{/}}'});({maybe:Xt,None:Yt}=tortoise_require("brazier/maybe"));var Zt,Kt,Jt,Qt=Ractive.extend({lastUpdateMs:void 0,startX:void 0,startY:void 0,view:void 0,data:function(){return{isVisible:void 0,state:void 0,wareaHeight:void 0,wareaWidth:void 0,xLoc:0,yLoc:0}},observe:{isVisible:function(e,t){e?(this.set("xLoc",.1*this.get("wareaWidth")),this.set("yLoc",.1*this.get("wareaHeight")+150),setTimeout((()=>this.find("#async-user-dialog").focus()),0),this.fire("dialog-opened",this)):this.fire("dialog-closed",this)}},on:{"close-popup":function(){return this.set("isVisible",!1),!1},"handle-key":function({original:{keyCode:e}}){var t;return 13===e?(t=function(){switch(this.get("state").type){case"chooser":return"async-dialog-chooser-ok";case"message":return"async-dialog-message-ok";case"text-input":return"async-dialog-input-ok";case"yes-or-no":return"async-dialog-yon-yes";default:throw new Error(`Unknown async dialog type: ${this.get("state").type}`)}}.call(this),document.getElementById(t).click(),!1):27===e?this.fire("close-popup"):void 0},"perform-halt":function(){return this.fire("close-popup"),this.get("state").callback(Yt),!1},"perform-chooser-ok":function(){var e,t;return this.fire("close-popup"),t=(e=document.getElementById("async-dialog-chooser")).selectedIndex,e.selectedIndex=0,this.get("state").callback(Xt(t)),!1},"perform-input-ok":function(){var e,t;return this.fire("close-popup"),t=(e=document.getElementById("async-dialog-text-input")).value,e.value="",this.get("state").callback(Xt(t)),!1},"perform-message-ok":function(){return this.fire("close-popup"),this.get("state").callback(Xt(0)),!1},"perform-no":function(){return this.fire("close-popup"),this.get("state").callback(Xt(!1)),!1},"perform-yes":function(){return this.fire("close-popup"),this.get("state").callback(Xt(!0)),!1},"show-state":function(e,t){return this.set("state",t),this.set("isVisible",!0),!1},"show-chooser":function(e,t,n,i){return this.fire("show-state",{},{type:"chooser",message:t,choices:n,callback:i}),!1},"show-text-input":function(e,t,n){return this.fire("show-state",{},{type:"text-input",message:t,callback:n}),!1},"show-yes-or-no":function(e,t,n){return this.fire("show-state",{},{type:"yes-or-no",message:t,callback:n}),!1},"show-message":function(e,t,n){return this.fire("show-state",{},{type:"message",message:t,callback:n}),!1},"start-drag":function(e){return He.dragstart(this,e,(function(e,t){var n;switch((n=document.elementFromPoint(e,t)).tagName.toLowerCase()){case"input":return"number"!==n.type.toLowerCase()&&"text"!==n.type.toLowerCase();case"textarea":return!1;default:return!0}}),((e,t)=>(this.startX=this.get("xLoc")-e,this.startY=this.get("yLoc")-t)))},"drag-dialog":function(e){return He.drag(this,e,((e,t)=>(this.set("xLoc",this.startX+e),this.set("yLoc",this.startY+t))))},"stop-drag":function(){return He.dragend(this,(function(){}))}},template:'<div id="async-user-dialog" class="async-popup"\n     style="{{# !isVisible }}display: none;{{/}} top: {{yLoc}}px; left: {{xLoc}}px; max-width: {{wareaWidth * .4}}px; {{style}}"\n     draggable="true" on-drag="drag-dialog" on-dragstart="start-drag" on-dragend="stop-drag"\n     on-keydown="handle-key" tabindex="0">\n  <div id="{{id}}-closer" class="widget-edit-closer" on-click="perform-halt">X</div>\n  <div class="async-dialog-message">{{state.message}}</div>\n  <div id="async-dialog-controls" class="async-dialog-controls">{{>controls}}</div>\n</div>',partials:{controls:'{{# state.type === \'message\' }}\n  <div class="async-dialog-button-row">\n    <input id="async-dialog-message-ok" type="button" on-click="perform-message-ok" value="OK"/>\n  </div>\n\n{{ elseif state.type === \'text-input\' }}\n  <input id="async-dialog-text-input" class="async-dialog-text-input" type="text" />\n  <div class="async-dialog-button-row">\n    <input id="async-dialog-input-ok" type="button" on-click="perform-input-ok" value="OK"/>\n  </div>\n\n{{ elseif state.type === \'chooser\' }}\n  <div class="h-center-flexbox">\n    <select id="async-dialog-chooser" class="async-dialog-chooser" style="max-width: {{wareaWidth * .3}}px">\n    {{#state.choices:i}}\n      <option {{# i === 0}} selected{{/}}>{{state.choices[i]}}</option>\n    {{/}}\n    </select>\n  </div>\n  <div class="async-dialog-button-row">\n    <input id="async-dialog-chooser-ok" type="button" on-click="perform-chooser-ok" value="OK"/>\n  </div>\n\n{{ elseif state.type === \'yes-or-no\' }}\n  <div class="async-dialog-button-row">\n    <input id="async-dialog-yon-no"  type="button"                           on-click="perform-no"  value="No" />\n    <input id="async-dialog-yon-yes" type="button" style="margin-left: 5px;" on-click="perform-yes" value="Yes"/>\n  </div>\n\n{{else}}\n  Invalid dialog state.\n\n{{/}}'}});Jt=function(e,t,n=!0,i=function(){return!1}){return{text:`Create ${e}`,enabler:i,isEnabled:n,action:function(e,n,i){return e.fire("create-widget",t,n,i)}}},Kt=[["Button","button"],["Chooser","chooser"],["Input","inputBox"],["Note","textBox"],["Monitor","monitor"],["Output","output",!1,(Zt=function(e){return function(t){return null!=t.parent?Zt(e)(t.parent):null==t.findComponent(e)}})("outputWidget")],["Plot","plot"],["Slider","slider"],["Switch","switch"]].map((function(e){return Jt(...e)}));var en,tn,nn,rn,on=Ractive.extend({data:function(){return{options:void 0,mouseX:0,mouseY:0,target:void 0,visible:!1}},on:{"ignore-click":function(){return!1},"cover-thineself":function(){this.set("visible",!1),this.fire("unlock-selection")},"reveal-thineself":function(e,t,n,i){var r;this.set("target",t),this.set("options",null!=(r=null!=t?t.get("contextMenuOptions"):void 0)?r:Kt),this.set("visible",this.get("options").length>0),this.set("mouseX",n),this.set("mouseY",i),t instanceof Je&&this.fire("lock-selection",t)}},template:'{{# visible }}\n<div id="netlogo-widget-context-menu" class="widget-context-menu" style="top: {{mouseY}}px; left: {{mouseX}}px;">\n  <div id="{{id}}-context-menu" class="netlogo-widget-editor-menu-items">\n    <ul class="context-menu-list">\n      {{# options }}\n        {{# (..enabler !== undefined && ..enabler(target)) || ..isEnabled }}\n          <li class="context-menu-item" on-mouseup="..action(target, mouseX, mouseY)">{{..text}}</li>\n        {{ else }}\n          <li class="context-menu-item disabled" on-mouseup="ignore-click">{{..text}}</li>\n        {{/}}\n      {{/}}\n    </ul>\n  </div>\n</div>\n{{/}}'}),an=Ractive.extend({data:function(){return{isVisible:void 0,label:void 0,value:void 0}},twoway:!1,template:'<span class="netlogo-label">\n  {{ # isVisible }}\n    {{label}}: {{value}}\n  {{else}}\n    &nbsp;\n  {{/}}\n</span>'});en=function(e){return null!=e.match(/.*\.nlogo/)?e.slice(0,-6):e},tn=function(e,t,n,i,r,o,a){var s,l;return l={checkIsReporter:a,code:n,consoleOutput:"",exportForm:!1,hasFocus:!1,height:0,info:i,isEditing:!1,isHelpVisible:!1,isOverlayUp:!1,isReadOnly:r,isResizerVisible:!0,isStale:!1,isVertical:!0,lastCompiledCode:n,lastCompileFailed:!1,lastDragX:void 0,lastDragY:void 0,modelTitle:en(o),outputWidgetOutput:"",primaryView:void 0,someDialogIsOpen:!1,someEditFormIsOpen:!1,speed:0,ticks:"",ticksStarted:!1,widgetObj:t.reduce((function(e,t,n){return e[n]=t,e}),{}),width:0},s=function(e){return function(t,n){var i,r,o,a,s;for(n=t.processParams(n),s=function(n){return function(i){var o,a,s;for(i.target.classList.remove(e),a=0,s=r.length;a<s;a++)o=r[a],i.target.removeEventListener(o,n);return t.complete()}},o=0,a=(r=["animationend","webkitAnimationEnd","oAnimationEnd","msAnimationEnd"]).length;o<a;o++)i=r[o],t.node.addEventListener(i,s(s));return t.node.classList.add(e)}},Ractive.transitions.grow=s("growing"),Ractive.transitions.shrink=s("shrinking"),new Ractive({el:e,template:rn,partials:nn,components:{asyncDialog:Qt,console:Ut,contextMenu:on,editableTitle:Ht,codePane:Pt,helpDialog:Rt,infotab:Wt,resizer:Gt,tickCounter:an,labelWidget:ct,switchWidget:Mt,buttonWidget:wt,sliderWidget:_t,chooserWidget:Et,monitorWidget:At,inputWidget:gt,outputWidget:Vt,plotWidget:qt,viewWidget:xt,spacer:nt},computed:{stateName:function(){return this.get("isEditing")?this.get("someEditFormIsOpen")?"authoring - editing widget":"authoring - plain":"interactive"}},data:function(){return l}})},rn='<div class="netlogo-model netlogo-display-{{# isVertical }}vertical{{ else }}horizontal{{/}}" style="min-width: {{width}}px;"\n     tabindex="1" on-keydown="@this.fire(\'check-action-keys\', @event)"\n     on-focus="@this.fire(\'track-focus\', @node)"\n     on-blur="@this.fire(\'track-focus\', @node)">\n  <div id="modal-overlay" class="modal-overlay" style="{{# !isOverlayUp }}display: none;{{/}}" on-click="drop-overlay"></div>\n\n  <div class="netlogo-display-vertical">\n\n    <div class="netlogo-header">\n      <div class="netlogo-subheader">\n        <div class="netlogo-powered-by">\n          <a href="http://ccl.northwestern.edu/netlogo/">\n            <img style="vertical-align: middle;" alt="NetLogo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANcSURBVHjarJRdaFxFFMd/M/dj7252uxubKms+bGprVyIVbNMWWqkQqtLUSpQWfSiV+oVFTcE3DeiDgvoiUSiCYLH2oVoLtQ+iaaIWWtE2FKGkkSrkq5svN+sm7ma/7p3x4W42lEbjQw8MM8yc87/nzPnNFVprbqWJXyMyXuMqx1Ni6N3ny3cX8tOHNLoBUMvESoFI2Xbs4zeO1lzREpSrMSNS1zkBDv6uo1/noz1H7mpvS4SjprAl2AZYEqzKbEowBAgBAkjPKX2599JjT7R0bj412D0JYNplPSBD1G2SmR/e6u1ikEHG2vYiGxoJmxAyIGSCI8GpCItKimtvl2JtfGujDNkX6epuAhCjNeAZxM1ocPy2Qh4toGQ5DLU+ysiuA2S3P0KgJkjAgEAlQylAA64CG/jlUk6//ng4cNWmLK0yOPNMnG99Rs9LQINVKrD+wmke7upg55PrWP3eYcwrlykpKCkoelDy/HVegQhoABNAepbACwjOt72gZkJhypX70YDWEEklue+rbnYc2MiGp1upPfYReiJJUUG58gFXu4udch1wHcjFIgy0HyIjb2yvBpT2F6t+6+f+D15lW8c9JDo7iPSdgVIRLUqL2AyHDQAOf9hfbqxvMF98eT3RuTS1avHyl+Stcphe2chP9+4k/t3RbXVl3W+Ws17FY56/w3VcbO/koS/eZLoAqrQMxADZMTYOfwpwoWjL4+bCYcgssMqGOzPD6CIkZ/3SxTJ0ayFIN6/BnBrZb2XdE1JUgkJWkfrUNRJnPyc16zsbgPyXIUJBpvc+y89nk/S8/4nek3NPGeBWMwzGvhUPnP6RubRLwfODlqqx3LSCyee2MnlwMwA2RwgO5qouVcHmksUdJweYyi8hZkrUjgT5t/ejNq0jBsSqNWsKyT9uFtxw7Bs585d3g46KOeT2bWHmtd14KyP+5mzqpsYU3OyioACMhGiqPTMocsrHId9cy9BLDzKxq8X3ctMwlV6yKSHL4fr4dd0DeQBTBUgUkvpE1kVPbqkX117ZzuSaFf4zyfz5n9A4lk0yNU7vyb7jTy1kmFGipejKvh6h9n0W995ZPTu227hqmCz33xXgFV1v9NzI96NfjndWt7XWCB/7BSICFWL+j3lAofpCtfYFb6X9MwCJZ07mUsXRGwAAAABJRU5ErkJggg=="/>\n            <span style="font-size: 16px;">powered by NetLogo</span>\n          </a>\n        </div>\n      </div>\n      <editableTitle title="{{modelTitle}}" isEditing="{{isEditing}}"/>\n      {{# !isReadOnly }}\n        <div class="flex-column" style="align-items: flex-end; user-select: none;">\n          <div class="netlogo-export-wrapper">\n            <span style="margin-right: 4px;">File:</span>\n            <button class="netlogo-ugly-button" on-click="open-new-file"{{#isEditing}} disabled{{/}}>New</button>\n          </div>\n          <div class="netlogo-export-wrapper">\n            <span style="margin-right: 4px;">Export:</span>\n            <button class="netlogo-ugly-button" on-click="export-nlogo"{{#isEditing}} disabled{{/}}>NetLogo</button>\n            <button class="netlogo-ugly-button" on-click="export-html"{{#isEditing}} disabled{{/}}>HTML</button>\n          </div>\n        </div>\n      {{/}}\n    </div>\n\n    <div class="netlogo-display-horizontal">\n\n      <div id="authoring-lock" class="netlogo-toggle-container{{#!someDialogIsOpen}} enabled{{/}}" on-click="toggle-interface-lock">\n        <div class="netlogo-interface-unlocker {{#isEditing}}interface-unlocked{{/}}"></div>\n        <spacer width="5px" />\n        <span class="netlogo-toggle-text">Mode: {{#isEditing}}Authoring{{else}}Interactive{{/}}</span>\n      </div>\n\n      <div id="tabs-position" class="netlogo-toggle-container{{#!someDialogIsOpen}} enabled{{/}}" on-click="toggle-orientation">\n        <div class="netlogo-model-orientation {{#isVertical}}vertical-display{{/}}"></div>\n        <spacer width="5px" />\n        <span class="netlogo-toggle-text">Commands and Code: {{#isVertical}}Bottom{{else}}Right Side{{/}}</span>\n      </div>\n\n    </div>\n\n    <asyncDialog wareaHeight="{{height}}" wareaWidth="{{width}}"></asyncDialog>\n    <helpDialog isOverlayUp="{{isOverlayUp}}" isVisible="{{isHelpVisible}}" stateName="{{stateName}}" wareaHeight="{{height}}" wareaWidth="{{width}}"></helpDialog>\n    <contextMenu></contextMenu>\n\n    <label class="netlogo-speed-slider{{#isEditing}} interface-unlocked{{/}}">\n      <span class="netlogo-label">model speed</span>\n      <input type="range" min=-1 max=1 step=0.01 value="{{speed}}"{{#isEditing}} disabled{{/}} />\n      <tickCounter isVisible="{{primaryView.showTickCounter}}"\n                   label="{{primaryView.tickCounterLabel}}" value="{{ticks}}" />\n    </label>\n\n    <div style="position: relative; width: {{width}}px; height: {{height}}px"\n         class="netlogo-widget-container{{#isEditing}} interface-unlocked{{/}}"\n         on-contextmenu="@this.fire(\'show-context-menu\', { component: @this }, @event)"\n         on-click="@this.fire(\'deselect-widgets\', @event)" on-dragover="mosaic-killer-killer">\n      <resizer isEnabled="{{isEditing}}" isVisible="{{isResizerVisible}}" />\n      {{#widgetObj:key}}\n        {{# type === \'view\'     }} <viewWidget    id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} ticks="{{ticks}}" /> {{/}}\n        {{# type === \'textBox\'  }} <labelWidget   id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} /> {{/}}\n        {{# type === \'switch\'   }} <switchWidget  id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} /> {{/}}\n        {{# type === \'button\'   }} <buttonWidget  id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} errorClass="{{>errorClass}}" ticksStarted="{{ticksStarted}}"/> {{/}}\n        {{# type === \'slider\'   }} <sliderWidget  id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} errorClass="{{>errorClass}}" /> {{/}}\n        {{# type === \'chooser\'  }} <chooserWidget id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} /> {{/}}\n        {{# type === \'monitor\'  }} <monitorWidget id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} errorClass="{{>errorClass}}" /> {{/}}\n        {{# type === \'inputBox\' }} <inputWidget   id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} /> {{/}}\n        {{# type === \'plot\'     }} <plotWidget    id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} /> {{/}}\n        {{# type === \'output\'   }} <outputWidget  id="{{>widgetID}}" isEditing="{{isEditing}}" left="{{left}}" right="{{right}}" top="{{top}}" bottom="{{bottom}}" widget={{this}} text="{{outputWidgetOutput}}" /> {{/}}\n      {{/}}\n    </div>\n\n  </div>\n\n  <div class="netlogo-tab-area" style="min-width: {{Math.min(width, 500)}}px; max-width: {{Math.max(width, 500)}}px">\n    {{# !isReadOnly }}\n    <label class="netlogo-tab{{#showConsole}} netlogo-active{{/}}">\n      <input id="console-toggle" type="checkbox" checked="{{showConsole}}" />\n      <span class="netlogo-tab-text">Command Center</span>\n    </label>\n    {{#showConsole}}\n      <console output="{{consoleOutput}}" isEditing="{{isEditing}}" checkIsReporter="{{checkIsReporter}}" />\n    {{/}}\n    {{/}}\n    <label class="netlogo-tab{{#showCode}} netlogo-active{{/}}">\n      <input id="code-tab-toggle" type="checkbox" checked="{{ showCode }}" />\n      <span class="netlogo-tab-text{{#lastCompileFailed}} netlogo-widget-error{{/}}">NetLogo Code</span>\n    </label>\n    {{#showCode}}\n      <codePane code=\'{{code}}\' lastCompiledCode=\'{{lastCompiledCode}}\' lastCompileFailed=\'{{lastCompileFailed}}\' isReadOnly=\'{{isReadOnly}}\' />\n    {{/}}\n    <label class="netlogo-tab{{#showInfo}} netlogo-active{{/}}">\n      <input id="info-toggle" type="checkbox" checked="{{ showInfo }}" />\n      <span class="netlogo-tab-text">Model Info</span>\n    </label>\n    {{#showInfo}}\n      <infotab rawText=\'{{info}}\' isEditing=\'{{isEditing}}\' />\n    {{/}}\n  </div>\n\n  <input id="general-file-input" type="file" name="general-file" style="display: none;" />\n\n</div>',nn={errorClass:"{{# !compilation.success}}netlogo-widget-error{{/}}",widgetID:"netlogo-{{type}}-{{key}}"};var sn,ln=tn,dn=function(e){var t,n,i,r,o,a,s,l,d;return s=function(){return e.findComponent("resizer")},o=function(e,t){s().lockTarget(t)},d=function(){s().unlockTarget()},t=function(){var t,i,r;i=s().get("target"),e.get("isEditing")&&null!=i&&(r=i.get("widget"),t=null==document.querySelector(".widget-edit-popup"),null!=r&&"view"!==r.type&&t&&(d(),n(),e.fire("unregister-widget",r.id)))},r=function(e){s().setTarget(e.component)},l=function(t,n){e.get("isEditing")&&(n.preventDefault(),n.stopPropagation(),r(t))},n=function(){s().clearTarget()},e.observe("isEditing",(function(e){n()})),i=function(){return!e.get("isEditing")||(e.set("isResizerVisible",!e.get("isResizerVisible")),!1)},a=function(t,n){var i;return!(null!=(i=s().get("target"))&&!e.get("someDialogIsOpen"))||(i.nudge(n),!1)},e.on("*.select-component",r),e.on("*.select-widget",l),e.on("deselect-widgets",n),e.on("delete-selected",t),e.on("hide-resizer",i),e.on("nudge-widget",a),e.on("*.lock-selection",o),e.on("*.unlock-selection",d)},cn=sn=function(e){var t;t=function(t){var n;2!==(null!=t?t.button:void 0)&&(n=e.findComponent("contextMenu")).get("visible")&&n.fire("cover-thineself")},window.addEventListener("keyup",(function(e){if(27===e.keyCode)return t(e)})),document.addEventListener("click",t),document.addEventListener("contextmenu",(function(e){var n,i,r,o,a,s,l;for(s=e.target,o=[];null!=s;)o.push(s),s=s.parentElement;if(l=function(){var e,t,i;for(i=[],e=0,t=o.length;e<t;e++)r=o[e],i.push(function(){var e,t,i,o;for(o=[],e=0,t=(i=r.classList).length;e<t;e++)n=i[e],o.push(n);return o}());return i}(),i=l.reduce((function(e,t){return e.concat(t)})),!(a=function(e){return-1!==i.indexOf(e)})("netlogo-widget")&&!a("netlogo-widget-container"))return t(e)})),sn=function(t,n,i){var r,o,a;return!(this.get("isEditing")&&!this.findAllComponents("editForm").some((function(e){return e.get("visible")})))||([{component:r},{pageX:o,pageY:a}]=null==i?[t,n]:[n,i],e.fire("deselect-widgets"),this.findComponent("contextMenu").fire("reveal-thineself",r,o,a),!1)},e.on("show-context-menu",sn),e.on("*.show-context-menu",sn),e.on("*.hide-context-menu",t)},un={}.hasOwnProperty,hn=function(e){var t,n,i,r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E,S,A,T,P;({ractive:g,viewController:T}=e),f=new Set([]),t=function(e){var t,n,i,r;if(g.get("hasFocus"))for(t in n=String.fromCharCode(null!=e.which?e.which:e.keyCode),i=g.get("widgetObj"))"button"===(r=i[t]).type&&r.actionKey===n&&g.findAllComponents("buttonWidget").find((function(e){return e.get("widget")===r})).get("isEnabled")&&(r.forever?r.running=!r.running:r.run())},n=function(t,n,i){e.createWidget(t,n,i)},i=function(){g.set("isHelpVisible",!1),g.set("isOverlayUp",!1)},r=function({event:{clientX:e,clientY:t}}){g.set("lastDragX",e),g.set("lastDragY",t)},a=function(e){var t;f.delete(e),g.set("someDialogIsOpen",f.size>0),t=document.scrollTop,document.querySelector(".netlogo-model").focus({preventScroll:!0}),document.scrollTop=t},s=function(e){g.set("someEditFormIsOpen",!1),a(e)},P=void 0,c=function({target:e}){var t,n;("input"===(n=e.tagName.toLowerCase())||"textarea"===n)&&!e.readOnly||"true"===e.contentEditable||(t=!g.get("isHelpVisible"),g.set("isHelpVisible",t),(t?(P=document.activeElement,g.find("#help-dialog")):P).focus())},l=function(e){f.add(e),g.set("someDialogIsOpen",!0)},d=function(e){g.set("someEditFormIsOpen",!0),l(e)},u=function(){var e,t,n;e=function(e){return"plot"===e.type?e.bottom+3:e.bottom},g.set("height",Math.max.apply(Math,function(){var i,r;for(t in r=[],i=g.get("widgetObj"))un.call(i,t)&&null!=(n=i[t]).bottom&&r.push(e(n));return r}()))},h=function(){var e,t,n;e=function(e){return"plot"===e.type?e.right+3:e.right},g.set("width",Math.max.apply(Math,function(){var i,r;for(t in r=[],i=g.get("widgetObj"))un.call(i,t)&&null!=(n=i[t]).right&&r.push(e(n));return r}()))},p=function(e,t,n,i){var r,o;o=function(e,t){return null!=t&&function(){switch(e.type){case"slider":return!isNaN(t);case"inputBox":return!("Number"===e.boxedValue.type&&isNaN(t));default:return!0}}()},null!=(r=g.get("widgetObj")[i]).variable&&"undefined"!=typeof world&&null!==world&&e!==t&&o(r,e)&&world.observer.setGlobal(r.variable,e)},m=function(){e.redraw(),T.repaint()},v=function(e){var t;return({eq:t}=tortoise_require("brazier/equals")),e.currentChoice=Math.max(0,e.choices.findIndex(t(e.currentValue))),e.currentValue=e.choices[e.currentChoice],world.observer.setGlobal(e.variable,e.currentValue),!1},w=function(){h(),u()},y=function(t){e.reportError("compiler","update-widget-value",[`There is already a widget of a different type with a variable named '${t}'`])},_=function(t){if(!t.compilation.success)return e.reportError("compiler",t.type,t.compilation.messages)},b=function(e,t,n){return function(e){return function(t){var n,i;for(n in t)if(i=t[n],e(i))return!0;return!1}}((function({variable:t}){return t===e}))(g.get("widgetObj"))||world.observer.setGlobal(e,void 0),world.observer.setGlobal(t,n),!1},x=function(){var e,t,n,i,r;({minpxcor:n,maxpxcor:e,minpycor:i,maxpycor:t,patchsize:r}=T.model.world),k(r),world.resize(n,e,i,t),w()},k=function(e){world.setPatchSize(e),w()},C=function(e){var t;g.get("someDialogIsOpen")||(t=!g.get(e),g.set(e,t))},E=function(e){g.set("hasFocus",document.activeElement===e)},S=function(t,n,i){e.removeWidgetById(n,i),w()},A=function(){var e,t;({wrappingallowedinx:e,wrappingallowediny:t}=T.model.world),world.changeTopology(e,t)},(o=Mousetrap(g.find(".netlogo-model"))).bind(["up","down","left","right"],(function(e,t){return g.fire("nudge-widget",t)})),o.bind(["ctrl+shift+l","command+shift+l"],(function(){return g.fire("toggle-interface-lock")})),o.bind(["ctrl+shift+h","command+shift+h"],(function(){return g.fire("hide-resizer")})),o.bind("del",(function(){return g.fire("delete-selected")})),o.bind("escape",(function(){return g.fire("deselect-widgets")})),o.bind("?",c),g.observe("widgetObj.*.currentValue",p),g.observe("widgetObj.*.right",h),g.observe("widgetObj.*.bottom",u),g.on("mosaic-killer-killer",r),g.on("toggle-interface-lock",(function(){return C("isEditing")})),g.on("toggle-orientation",(function(){return C("isVertical")})),g.on("*.redraw-view",m),g.on("*.resize-view",x),g.on("*.unregister-widget",S),g.on("*.update-topology",A),g.on("check-action-keys",(function(e,n){return t(n)})),g.on("create-widget",(function(e,t,i,r){return n(t,i,r)})),g.on("drop-overlay",(function(e,t){return i()})),g.on("*.show-widget-errors",(function(e,t){return _(t)})),g.on("track-focus",(function(e,t){return E(t)})),g.on("*.refresh-chooser",(function(e,t,n){return v(n)})),g.on("*.reject-duplicate-var",(function(e,t){return y(t)})),g.on("*.rename-interface-global",(function(e,t,n,i){return b(t,n,i)})),g.on("*.set-patch-size",(function(e,t){return k(t)})),g.on("*.update-widgets",(function(){return e.updateWidgets()})),g.on("*.dialog-closed",(function(e,t){return a(t)})),g.on("*.dialog-opened",(function(e,t){return l(t)})),g.on("*.edit-form-closed",(function(e,t){return s(t)})),g.on("*.edit-form-opened",(function(e,t){return d(t)}))};for(var pn={},fn={byteLength:function(e){var t=xn(e),n=t[0],i=t[1];return 3*(n+i)/4-i},toByteArray:function(e){var t,n,i=xn(e),r=i[0],o=i[1],a=new vn(function(e,t,n){return 3*(t+n)/4-n}(0,r,o)),s=0,l=o>0?r-4:r;for(n=0;n<l;n+=4)t=mn[e.charCodeAt(n)]<<18|mn[e.charCodeAt(n+1)]<<12|mn[e.charCodeAt(n+2)]<<6|mn[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;return 2===o&&(t=mn[e.charCodeAt(n)]<<2|mn[e.charCodeAt(n+1)]>>4,a[s++]=255&t),1===o&&(t=mn[e.charCodeAt(n)]<<10|mn[e.charCodeAt(n+1)]<<4|mn[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t),a},fromByteArray:function(e){for(var t,n=e.length,i=n%3,r=[],o=16383,a=0,s=n-i;a<s;a+=o)r.push(_n(e,a,a+o>s?s:a+o));return 1===i?(t=e[n-1],r.push(gn[t>>2]+gn[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],r.push(gn[t>>10]+gn[t>>4&63]+gn[t<<2&63]+"=")),r.join("")}},gn=[],mn=[],vn="undefined"!=typeof Uint8Array?Uint8Array:Array,wn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yn=0,bn=wn.length;yn<bn;++yn)gn[yn]=wn[yn],mn[wn.charCodeAt(yn)]=yn;function xn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function kn(e){return gn[e>>18&63]+gn[e>>12&63]+gn[e>>6&63]+gn[63&e]}function _n(e,t,n){for(var i,r=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(kn(i));return r.join("")}mn["-".charCodeAt(0)]=62,mn["_".charCodeAt(0)]=63;var Cn={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,d=l>>1,c=-7,u=n?r-1:0,h=n?-1:1,p=e[t+u];for(u+=h,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+u],u+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+u],u+=h,c-=8);if(0===o)o=1-d;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=d}return(p?-1:1)*a*Math.pow(2,o-i)},write:function(e,t,n,i,r,o){var a,s,l,d=8*o-r-1,c=(1<<d)-1,u=c>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+u>=1?h/l:h*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=c?(s=0,a=c):a+u>=1?(s=(t*l-1)*Math.pow(2,r),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,d+=r;d>0;e[n+p]=255&a,p+=f,a/=256,d-=8);e[n+p-f]|=128*g}};
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */!function(e){const t=fn,n=Cn,i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},e.INSPECT_MAX_BYTES=50;const r=2147483647;function o(e){if(e>r)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return s(e,t,n)}function s(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|p(e,t);let i=o(n);const r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(X(e,Uint8Array)){const t=new Uint8Array(e);return u(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(X(e,ArrayBuffer)||e&&X(e.buffer,ArrayBuffer))return u(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(X(e,SharedArrayBuffer)||e&&X(e.buffer,SharedArrayBuffer)))return u(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return a.from(i,t,n);const r=function(e){if(a.isBuffer(e)){const t=0|h(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||q(e.length)?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),o(e<0?0:0|h(e))}function c(e){const t=e.length<0?0:0|h(e.length),n=o(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function u(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,a.prototype),i}function h(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function p(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||X(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return i?-1:W(e).length;t=(""+t).toLowerCase(),r=!0}}function f(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),q(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:v(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,i,r){let o,a=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function d(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){let i=-1;for(o=n;o<s;o++)if(d(e,o)===d(t,-1===i?0:o-i)){if(-1===i&&(i=o),o-i+1===l)return i*a}else-1!==i&&(o-=o-i),i=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){let n=!0;for(let i=0;i<l;i++)if(d(e,o+i)!==d(t,i)){n=!1;break}if(n)return o}return-1}function w(e,t,n,i){n=Number(n)||0;const r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;const o=t.length;let a;for(i>o/2&&(i=o/2),a=0;a<i;++a){const i=parseInt(t.substr(2*a,2),16);if(q(i))return a;e[n+a]=i}return a}function y(e,t,n,i){return Y(W(t,e.length-n),e,n,i)}function b(e,t,n,i){return Y(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function x(e,t,n,i){return Y(H(t),e,n,i)}function k(e,t,n,i){return Y(function(e,t){let n,i,r;const o=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function _(e,n,i){return 0===n&&i===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,i))}function C(e,t,n){n=Math.min(e.length,n);const i=[];let r=t;for(;r<n;){const t=e[r];let o=null,a=t>239?4:t>223?3:t>191?2:1;if(r+a<=n){let n,i,s,l;switch(a){case 1:t<128&&(o=t);break;case 2:n=e[r+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(o=l));break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(l=(15&t)<<12|(63&n)<<6|63&i,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:n=e[r+1],i=e[r+2],s=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&s)&&(l=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&s,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|1023&o),i.push(o),r+=a}return function(e){const t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=E));return n}(i)}e.kMaxLength=r,a.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return s(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},a.allocUnsafe=function(e){return d(e)},a.allocUnsafeSlow=function(e){return d(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(X(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),X(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const i=a.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if(X(t,Uint8Array))r+t.length>i.length?(a.isBuffer(t)||(t=a.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else{if(!a.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,r)}r+=t.length}return i},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):f.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},i&&(a.prototype[i]=a.prototype.inspect),a.prototype.compare=function(e,t,n,i,r){if(X(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0);const l=Math.min(o,s),d=this.slice(i,r),c=e.slice(t,n);for(let e=0;e<l;++e)if(d[e]!==c[e]){o=d[e],s=c[e];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":case"latin1":case"binary":return b(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const E=4096;function S(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function A(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function T(e,t,n){const i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=G[e[i]];return r}function P(e,t,n){const i=e.slice(t,n);let r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,i,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function z(e,t,n,i,r){V(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,n}function B(e,t,n,i,r){V(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=a,a>>=8,e[n+2]=a,a>>=8,e[n+1]=a,a>>=8,e[n]=a,n+8}function M(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,i,r,o){return t=+t,i>>>=0,o||M(e,0,i,4),n.write(e,t,i,r,23,4),i+4}function R(e,t,i,r,o){return t=+t,i>>>=0,o||M(e,0,i,8),n.write(e,t,i,r,52,8),i+8}a.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,a.prototype),i},a.prototype.readUintLE=a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return i},a.prototype.readUintBE=a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUint8=a.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readBigUInt64LE=Z((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),a.prototype.readBigUInt64BE=Z((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let i=t,r=1,o=this[e+--i];for(;i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readBigInt64LE=Z((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),a.prototype.readBigInt64BE=Z((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),a.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||I(this,e,t,n,Math.pow(2,8*n)-1,0);let r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||I(this,e,t,n,Math.pow(2,8*n)-1,0);let r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeBigUInt64LE=Z((function(e,t=0){return z(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeBigUInt64BE=Z((function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=0,o=1,a=0;for(this[t]=255&e;++r<n&&(o*=256);)e<0&&0===a&&0!==this[t+r-1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=n-1,o=1,a=0;for(this[t+r]=255&e;--r>=0&&(o*=256);)e<0&&0===a&&0!==this[t+r+1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeBigInt64LE=Z((function(e,t=0){return z(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeBigInt64BE=Z((function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);const r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const o=a.isBuffer(e)?e:a.from(e,i),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=o[r%s]}return this};const N={};function U(e,t,n){N[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function D(e){let t="",n=e.length;const i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function V(e,t,n,i,r,o){if(e>n||e<t){const i="bigint"==typeof t?"n":"";let r;throw r=o>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(o+1)}${i}`:`>= -(2${i} ** ${8*(o+1)-1}${i}) and < 2 ** ${8*(o+1)-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new N.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){F(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||$(t,e.length-(n+1))}(i,r,o)}function F(e,t){if("number"!=typeof e)throw new N.ERR_INVALID_ARG_TYPE(t,"number",e)}function $(e,t,n){if(Math.floor(e)!==e)throw F(e,n),new N.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new N.ERR_BUFFER_OUT_OF_BOUNDS;throw new N.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=D(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=D(r)),r+="n"),i+=` It must be ${t}. Received ${r}`,i}),RangeError);const j=/[^+/0-9A-Za-z-_]/g;function W(e,t){let n;t=t||1/0;const i=e.length;let r=null;const o=[];for(let a=0;a<i;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function H(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function X(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function q(e){return e!=e}const G=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function Z(e){return"undefined"==typeof BigInt?K:e}function K(){throw new Error("BigInt not supported")}}(pn);var En={exports:{}},Sn={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)n(i,r)&&(e[r]=i[r])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},r={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}(Sn);var An={},Tn={},Pn={},Ln=Sn;function In(e){for(var t=e.length;--t>=0;)e[t]=0}var zn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Bn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Mn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],On=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Rn=new Array(576);In(Rn);var Nn=new Array(60);In(Nn);var Un=new Array(512);In(Un);var Dn=new Array(256);In(Dn);var Vn=new Array(29);In(Vn);var Fn,$n,jn,Wn=new Array(30);function Hn(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function Yn(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Xn(e){return e<256?Un[e]:Un[256+(e>>>7)]}function qn(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function Gn(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,qn(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Zn(e,t,n){Gn(e,n[2*t],n[2*t+1])}function Kn(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Jn(e,t,n){var i,r,o=new Array(16),a=0;for(i=1;i<=15;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=Kn(o[s]++,s))}}function Qn(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function ei(e){e.bi_valid>8?qn(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ti(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function ni(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&ti(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!ti(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function ii(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?Zn(e,r,t):(Zn(e,(o=Dn[r])+256+1,t),0!==(a=zn[o])&&Gn(e,r-=Vn[o],a),Zn(e,o=Xn(--i),n),0!==(a=Bn[o])&&Gn(e,i-=Wn[o],a))}while(s<e.last_lit);Zn(e,256,t)}function ri(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)ni(e,o,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ni(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,ni(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,l=t.dyn_tree,d=t.max_code,c=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(i=e.heap[n])+1]+1]+1)>f&&(o=f,g++),l[2*i+1]=o,i>d||(e.bl_count[o]++,a=0,i>=p&&(a=h[i-p]),s=l[2*i],e.opt_len+=s*(o+a),u&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>d||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}(e,t),Jn(o,d,e.bl_count)}function oi(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,d=4;for(0===a&&(l=138,d=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<d?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=r,0===a?(l=138,d=3):r===a?(l=6,d=3):(l=7,d=4))}function ai(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,d=4;for(0===a&&(l=138,d=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<l&&r===a)){if(s<d)do{Zn(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(Zn(e,r,e.bl_tree),s--),Zn(e,16,e.bl_tree),Gn(e,s-3,2)):s<=10?(Zn(e,17,e.bl_tree),Gn(e,s-3,3)):(Zn(e,18,e.bl_tree),Gn(e,s-11,7));s=0,o=r,0===a?(l=138,d=3):r===a?(l=6,d=3):(l=7,d=4)}}In(Wn);var si=!1;function li(e,t,n,i){Gn(e,0+(i?1:0),3),function(e,t,n,i){ei(e),i&&(qn(e,n),qn(e,~n)),Ln.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}Pn._tr_init=function(e){si||(function(){var e,t,n,i,r,o=new Array(16);for(n=0,i=0;i<28;i++)for(Vn[i]=n,e=0;e<1<<zn[i];e++)Dn[n++]=i;for(Dn[n-1]=i,r=0,i=0;i<16;i++)for(Wn[i]=r,e=0;e<1<<Bn[i];e++)Un[r++]=i;for(r>>=7;i<30;i++)for(Wn[i]=r<<7,e=0;e<1<<Bn[i]-7;e++)Un[256+r++]=i;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)Rn[2*e+1]=8,e++,o[8]++;for(;e<=255;)Rn[2*e+1]=9,e++,o[9]++;for(;e<=279;)Rn[2*e+1]=7,e++,o[7]++;for(;e<=287;)Rn[2*e+1]=8,e++,o[8]++;for(Jn(Rn,287,o),e=0;e<30;e++)Nn[2*e+1]=5,Nn[2*e]=Kn(e,5);Fn=new Hn(Rn,zn,257,286,15),$n=new Hn(Nn,Bn,0,30,15),jn=new Hn(new Array(0),Mn,0,19,7)}(),si=!0),e.l_desc=new Yn(e.dyn_ltree,Fn),e.d_desc=new Yn(e.dyn_dtree,$n),e.bl_desc=new Yn(e.bl_tree,jn),e.bi_buf=0,e.bi_valid=0,Qn(e)},Pn._tr_stored_block=li,Pn._tr_flush_block=function(e,t,n,i){var r,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),ri(e,e.l_desc),ri(e,e.d_desc),a=function(e){var t;for(oi(e,e.dyn_ltree,e.l_desc.max_code),oi(e,e.dyn_dtree,e.d_desc.max_code),ri(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*On[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?li(e,t,n,i):4===e.strategy||o===r?(Gn(e,2+(i?1:0),3),ii(e,Rn,Nn)):(Gn(e,4+(i?1:0),3),function(e,t,n,i){var r;for(Gn(e,t-257,5),Gn(e,n-1,5),Gn(e,i-4,4),r=0;r<i;r++)Gn(e,e.bl_tree[2*On[r]+1],3);ai(e,e.dyn_ltree,t-1),ai(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),ii(e,e.dyn_ltree,e.dyn_dtree)),Qn(e),i&&ei(e)},Pn._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Dn[n]+256+1)]++,e.dyn_dtree[2*Xn(t)]++),e.last_lit===e.lit_bufsize-1},Pn._tr_align=function(e){Gn(e,2,3),Zn(e,256,Rn),function(e){16===e.bi_valid?(qn(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var di=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0};var ci=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();var ui,hi=function(e,t,n,i){var r=ci,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e},pi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},fi=Sn,gi=Pn,mi=di,vi=hi,wi=pi;function yi(e,t){return e.msg=wi[t],t}function bi(e){return(e<<1)-(e>4?9:0)}function xi(e){for(var t=e.length;--t>=0;)e[t]=0}function ki(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(fi.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function _i(e,t){gi._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ki(e.strm)}function Ci(e,t){e.pending_buf[e.pending++]=t}function Ei(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Si(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,fi.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=mi(e.adler,t,r,n):2===e.state.wrap&&(e.adler=vi(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function Ai(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,d=e.window,c=e.w_mask,u=e.prev,h=e.strstart+258,p=d[o+a-1],f=d[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(n=t)+a]===f&&d[n+a-1]===p&&d[n]===d[o]&&d[++n]===d[o+1]){o+=2,n++;do{}while(d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&o<h);if(i=258-(h-o),o=h-258,i>a){if(e.match_start=t,a=i,i>=s)break;p=d[o+a-1],f=d[o+a]}}}while((t=u[t&c])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function Ti(e){var t,n,i,r,o,a=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-262)){fi.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=a?i-a:0}while(--n);t=n=a;do{i=e.prev[--t],e.prev[t]=i>=a?i-a:0}while(--n);r+=a}if(0===e.strm.avail_in)break;if(n=Si(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function Pi(e,t){for(var n,i;;){if(e.lookahead<262){if(Ti(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=Ai(e,n)),e.match_length>=3)if(i=gi._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=gi._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(_i(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_i(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_i(e,!1),0===e.strm.avail_out)?1:2}function Li(e,t){for(var n,i,r;;){if(e.lookahead<262){if(Ti(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=Ai(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=gi._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(_i(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=gi._tr_tally(e,0,e.window[e.strstart-1]))&&_i(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=gi._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_i(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_i(e,!1),0===e.strm.avail_out)?1:2}function Ii(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function zi(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new fi.Buf16(1146),this.dyn_dtree=new fi.Buf16(122),this.bl_tree=new fi.Buf16(78),xi(this.dyn_ltree),xi(this.dyn_dtree),xi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new fi.Buf16(16),this.heap=new fi.Buf16(573),xi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new fi.Buf16(573),xi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Bi(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,gi._tr_init(t),0):yi(e,-2)}function Mi(e){var t=Bi(e);return 0===t&&function(e){e.window_size=2*e.w_size,xi(e.head),e.max_lazy_match=ui[e.level].max_lazy,e.good_match=ui[e.level].good_length,e.nice_match=ui[e.level].nice_length,e.max_chain_length=ui[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t}function Oi(e,t,n,i,r,o){if(!e)return-2;var a=1;if(-1===t&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>9||8!==n||i<8||i>15||t<0||t>9||o<0||o>4)return yi(e,-2);8===i&&(i=9);var s=new zi;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new fi.Buf8(2*s.w_size),s.head=new fi.Buf16(s.hash_size),s.prev=new fi.Buf16(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new fi.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,Mi(e)}ui=[new Ii(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ti(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,_i(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(_i(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_i(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_i(e,!1),e.strm.avail_out),1)})),new Ii(4,4,8,4,Pi),new Ii(4,5,16,8,Pi),new Ii(4,6,32,32,Pi),new Ii(4,4,16,16,Li),new Ii(8,16,32,32,Li),new Ii(8,16,128,128,Li),new Ii(8,32,128,256,Li),new Ii(32,128,258,1024,Li),new Ii(32,258,258,4096,Li)],Tn.deflateInit=function(e,t){return Oi(e,t,8,15,8,0)},Tn.deflateInit2=Oi,Tn.deflateReset=Mi,Tn.deflateResetKeep=Bi,Tn.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},Tn.deflate=function(e,t){var n,i,r,o;if(!e||!e.state||t>5||t<0)return e?yi(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return yi(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,Ci(i,31),Ci(i,139),Ci(i,8),i.gzhead?(Ci(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Ci(i,255&i.gzhead.time),Ci(i,i.gzhead.time>>8&255),Ci(i,i.gzhead.time>>16&255),Ci(i,i.gzhead.time>>24&255),Ci(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),Ci(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Ci(i,255&i.gzhead.extra.length),Ci(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=vi(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(Ci(i,0),Ci(i,0),Ci(i,0),Ci(i,0),Ci(i,0),Ci(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),Ci(i,3),i.status=113);else{var a=8+(i.w_bits-8<<4)<<8;a|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=113,Ei(i,a),0!==i.strstart&&(Ei(i,e.adler>>>16),Ei(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),ki(e),r=i.pending,i.pending!==i.pending_buf_size));)Ci(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),ki(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Ci(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),ki(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Ci(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=vi(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ki(e),i.pending+2<=i.pending_buf_size&&(Ci(i,255&e.adler),Ci(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(ki(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&bi(t)<=bi(n)&&4!==t)return yi(e,-5);if(666===i.status&&0!==e.avail_in)return yi(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var s=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(Ti(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=gi._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(_i(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_i(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_i(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=258){if(Ti(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=a[r=e.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){o=e.strstart+258;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=258-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=gi._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=gi._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(_i(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_i(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_i(e,!1),0===e.strm.avail_out)?1:2}(i,t):ui[i.level].func(i,t);if(3!==s&&4!==s||(i.status=666),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===s&&(1===t?gi._tr_align(i):5!==t&&(gi._tr_stored_block(i,0,0,!1),3===t&&(xi(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ki(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(Ci(i,255&e.adler),Ci(i,e.adler>>8&255),Ci(i,e.adler>>16&255),Ci(i,e.adler>>24&255),Ci(i,255&e.total_in),Ci(i,e.total_in>>8&255),Ci(i,e.total_in>>16&255),Ci(i,e.total_in>>24&255)):(Ei(i,e.adler>>>16),Ei(i,65535&e.adler)),ki(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},Tn.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?yi(e,-2):(e.state=null,113===t?yi(e,-3):0):-2},Tn.deflateSetDictionary=function(e,t){var n,i,r,o,a,s,l,d,c=t.length;if(!e||!e.state)return-2;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return-2;for(1===o&&(e.adler=mi(e.adler,t,c,0)),n.wrap=0,c>=n.w_size&&(0===o&&(xi(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new fi.Buf8(n.w_size),fi.arraySet(d,t,c-n.w_size,n.w_size,0),t=d,c=n.w_size),a=e.avail_in,s=e.next_in,l=e.input,e.avail_in=c,e.next_in=0,e.input=t,Ti(n);n.lookahead>=3;){i=n.strstart,r=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--r);n.strstart=i,n.lookahead=2,Ti(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=a,n.wrap=o,0},Tn.deflateInfo="pako deflate (from Nodeca project)";var Ri={},Ni=Sn,Ui=!0,Di=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Ui=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Di=!1}for(var Vi=new Ni.Buf8(256),Fi=0;Fi<256;Fi++)Vi[Fi]=Fi>=252?6:Fi>=248?5:Fi>=240?4:Fi>=224?3:Fi>=192?2:1;function $i(e,t){if(t<65537&&(e.subarray&&Di||!e.subarray&&Ui))return String.fromCharCode.apply(null,Ni.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}Vi[254]=Vi[254]=1,Ri.string2buf=function(e){var t,n,i,r,o,a=e.length,s=0;for(r=0;r<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Ni.Buf8(s),o=0,r=0;o<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},Ri.buf2binstring=function(e){return $i(e,e.length)},Ri.binstring2buf=function(e){for(var t=new Ni.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},Ri.buf2string=function(e,t){var n,i,r,o,a=t||e.length,s=new Array(2*a);for(i=0,n=0;n<a;)if((r=e[n++])<128)s[i++]=r;else if((o=Vi[r])>4)s[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<a;)r=r<<6|63&e[n++],o--;o>1?s[i++]=65533:r<65536?s[i++]=r:(r-=65536,s[i++]=55296|r>>10&1023,s[i++]=56320|1023&r)}return $i(s,i)},Ri.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Vi[e[n]]>t?n:t};var ji=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Wi=Tn,Hi=Sn,Yi=Ri,Xi=pi,qi=ji,Gi=Object.prototype.toString;function Zi(e){if(!(this instanceof Zi))return new Zi(e);this.options=Hi.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qi,this.strm.avail_out=0;var n=Wi.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(Xi[n]);if(t.header&&Wi.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?Yi.string2buf(t.dictionary):"[object ArrayBuffer]"===Gi.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=Wi.deflateSetDictionary(this.strm,i)))throw new Error(Xi[n]);this._dict_set=!0}}function Ki(e,t){var n=new Zi(t);if(n.push(e,!0),n.err)throw n.msg||Xi[n.err];return n.result}Zi.prototype.push=function(e,t){var n,i,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?r.input=Yi.string2buf(e):"[object ArrayBuffer]"===Gi.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new Hi.Buf8(o),r.next_out=0,r.avail_out=o),1!==(n=Wi.deflate(r,i))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(Yi.buf2binstring(Hi.shrinkBuf(r.output,r.next_out))):this.onData(Hi.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&1!==n);return 4===i?(n=Wi.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),r.avail_out=0,!0)},Zi.prototype.onData=function(e){this.chunks.push(e)},Zi.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Hi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},An.Deflate=Zi,An.deflate=Ki,An.deflateRaw=function(e,t){return(t=t||{}).raw=!0,Ki(e,t)},An.gzip=function(e,t){return(t=t||{}).gzip=!0,Ki(e,t)};var Ji={},Qi={},er=Sn,tr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],nr=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ir=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],rr=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],or=Sn,ar=di,sr=hi,lr=function(e,t){var n,i,r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E,S;n=e.state,i=e.next_in,E=e.input,r=i+(e.avail_in-5),o=e.next_out,S=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=n.dmax,d=n.wsize,c=n.whave,u=n.wnext,h=n.window,p=n.hold,f=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,w=(1<<n.distbits)-1;e:do{f<15&&(p+=E[i++]<<f,f+=8,p+=E[i++]<<f,f+=8),y=g[p&v];t:for(;;){if(p>>>=b=y>>>24,f-=b,0==(b=y>>>16&255))S[o++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=g[(65535&y)+(p&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&y,(b&=15)&&(f<b&&(p+=E[i++]<<f,f+=8),x+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=E[i++]<<f,f+=8,p+=E[i++]<<f,f+=8),y=m[p&w];n:for(;;){if(p>>>=b=y>>>24,f-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=m[(65535&y)+(p&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&y,f<(b&=15)&&(p+=E[i++]<<f,(f+=8)<b&&(p+=E[i++]<<f,f+=8)),(k+=p&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=b,f-=b,k>(b=o-a)){if((b=k-b)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(_=0,C=h,0===u){if(_+=d-b,b<x){x-=b;do{S[o++]=h[_++]}while(--b);_=o-k,C=S}}else if(u<b){if(_+=d+u-b,(b-=u)<x){x-=b;do{S[o++]=h[_++]}while(--b);if(_=0,u<x){x-=b=u;do{S[o++]=h[_++]}while(--b);_=o-k,C=S}}}else if(_+=u-b,b<x){x-=b;do{S[o++]=h[_++]}while(--b);_=o-k,C=S}for(;x>2;)S[o++]=C[_++],S[o++]=C[_++],S[o++]=C[_++],x-=3;x&&(S[o++]=C[_++],x>1&&(S[o++]=C[_++]))}else{_=o-k;do{S[o++]=S[_++],S[o++]=S[_++],S[o++]=S[_++],x-=3}while(x>2);x&&(S[o++]=S[_++],x>1&&(S[o++]=S[_++]))}break}}break}}while(i<r&&o<s);i-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=f},dr=function(e,t,n,i,r,o,a,s){var l,d,c,u,h,p,f,g,m,v=s.bits,w=0,y=0,b=0,x=0,k=0,_=0,C=0,E=0,S=0,A=0,T=null,P=0,L=new er.Buf16(16),I=new er.Buf16(16),z=null,B=0;for(w=0;w<=15;w++)L[w]=0;for(y=0;y<i;y++)L[t[n+y]]++;for(k=v,x=15;x>=1&&0===L[x];x--);if(k>x&&(k=x),0===x)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(b=1;b<x&&0===L[b];b++);for(k<b&&(k=b),E=1,w=1;w<=15;w++)if(E<<=1,(E-=L[w])<0)return-1;if(E>0&&(0===e||1!==x))return-1;for(I[1]=0,w=1;w<15;w++)I[w+1]=I[w]+L[w];for(y=0;y<i;y++)0!==t[n+y]&&(a[I[t[n+y]]++]=y);if(0===e?(T=z=a,p=19):1===e?(T=tr,P-=257,z=nr,B-=257,p=256):(T=ir,z=rr,p=-1),A=0,y=0,w=b,h=o,_=k,C=0,c=-1,u=(S=1<<k)-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){f=w-C,a[y]<p?(g=0,m=a[y]):a[y]>p?(g=z[B+a[y]],m=T[P+a[y]]):(g=96,m=0),l=1<<w-C,b=d=1<<_;do{r[h+(A>>C)+(d-=l)]=f<<24|g<<16|m|0}while(0!==d);for(l=1<<w-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,y++,0==--L[w]){if(w===x)break;w=t[n+a[y]]}if(w>k&&(A&u)!==c){for(0===C&&(C=k),h+=b,E=1<<(_=w-C);_+C<x&&!((E-=L[_+C])<=0);)_++,E<<=1;if(S+=1<<_,1===e&&S>852||2===e&&S>592)return 1;r[c=A&u]=k<<24|_<<16|h-o|0}}return 0!==A&&(r[h+A]=w-C<<24|64<<16|0),s.bits=k,0};function cr(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ur(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new or.Buf16(320),this.work=new or.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function hr(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new or.Buf32(852),t.distcode=t.distdyn=new or.Buf32(592),t.sane=1,t.back=-1,0):-2}function pr(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,hr(e)):-2}function fr(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,pr(e))):-2}function gr(e,t){var n,i;return e?(i=new ur,e.state=i,i.window=null,0!==(n=fr(e,t))&&(e.state=null),n):-2}var mr,vr,wr=!0;function yr(e){if(wr){var t;for(mr=new or.Buf32(512),vr=new or.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(dr(1,e.lens,0,288,mr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;dr(2,e.lens,0,32,vr,0,e.work,{bits:5}),wr=!1}e.lencode=mr,e.lenbits=9,e.distcode=vr,e.distbits=5}function br(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new or.Buf8(o.wsize)),i>=o.wsize?(or.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),or.arraySet(o.window,t,n-i,r,o.wnext),(i-=r)?(or.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}Qi.inflateReset=pr,Qi.inflateReset2=fr,Qi.inflateResetKeep=hr,Qi.inflateInit=function(e){return gr(e,15)},Qi.inflateInit2=gr,Qi.inflate=function(e,t){var n,i,r,o,a,s,l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E,S=0,A=new or.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),a=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,d=n.hold,c=n.bits,u=s,h=l,_=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(2&n.wrap&&35615===d){n.check=0,A[0]=255&d,A[1]=d>>>8&255,n.check=sr(n.check,A,2,0),d=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&d)){e.msg="unknown compression method",n.mode=30;break}if(c-=4,k=8+(15&(d>>>=4)),0===n.wbits)n.wbits=k;else if(k>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<k,e.adler=n.check=1,n.mode=512&d?10:12,d=0,c=0;break;case 2:for(;c<16;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(n.flags=d,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=sr(n.check,A,2,0)),d=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.head&&(n.head.time=d),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,A[2]=d>>>16&255,A[3]=d>>>24&255,n.check=sr(n.check,A,4,0)),d=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=sr(n.check,A,2,0)),d=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=sr(n.check,A,2,0)),d=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),or.arraySet(n.head.extra,i,o,p,k)),512&n.flags&&(n.check=sr(n.check,i,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;p=0;do{k=i[o+p++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&p<s);if(512&n.flags&&(n.check=sr(n.check,i,p,o)),s-=p,o+=p,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;p=0;do{k=i[o+p++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&p<s);if(512&n.flags&&(n.check=sr(n.check,i,p,o)),s-=p,o+=p,k)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}d=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;c<32;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}e.adler=n.check=cr(d),d=0,c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=c,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){d>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}switch(n.last=1&d,c-=1,3&(d>>>=1)){case 0:n.mode=14;break;case 1:if(yr(n),n.mode=20,6===t){d>>>=2,c-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}d>>>=2,c-=2;break;case 14:for(d>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&d,d=0,c=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>s&&(p=s),p>l&&(p=l),0===p)break e;or.arraySet(r,i,o,p,a),s-=p,o+=p,l-=p,a+=p,n.length-=p;break}n.mode=12;break;case 17:for(;c<14;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(n.nlen=257+(31&d),d>>>=5,c-=5,n.ndist=1+(31&d),d>>>=5,c-=5,n.ncode=4+(15&d),d>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.lens[T[n.have++]]=7&d,d>>>=3,c-=3}for(;n.have<19;)n.lens[T[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},_=dr(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,_){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(S=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=c);){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(w<16)d>>>=m,c-=m,n.lens[n.have++]=w;else{if(16===w){for(E=m+2;c<E;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(d>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}k=n.lens[n.have-1],p=3+(3&d),d>>>=2,c-=2}else if(17===w){for(E=m+3;c<E;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}c-=m,k=0,p=3+(7&(d>>>=m)),d>>>=3,c-=3}else{for(E=m+7;c<E;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}c-=m,k=0,p=11+(127&(d>>>=m)),d>>>=7,c-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;p--;)n.lens[n.have++]=k}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,C={bits:n.lenbits},_=dr(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,_){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},_=dr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,_){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=c,lr(e,h),a=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,d=n.hold,c=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;v=(S=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=c);){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(v&&0==(240&v)){for(y=m,b=v,x=w;v=(S=n.lencode[x+((d&(1<<y+b)-1)>>y)])>>>16&255,w=65535&S,!(y+(m=S>>>24)<=c);){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}d>>>=y,c-=y,n.back+=y}if(d>>>=m,c-=m,n.back+=m,n.length=w,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(E=n.extra;c<E;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(S=n.distcode[d&(1<<n.distbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=c);){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(0==(240&v)){for(y=m,b=v,x=w;v=(S=n.distcode[x+((d&(1<<y+b)-1)>>y)])>>>16&255,w=65535&S,!(y+(m=S>>>24)<=c);){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}d>>>=y,c-=y,n.back+=y}if(d>>>=m,c-=m,n.back+=m,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=w,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(E=n.extra;c<E;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(p=h-l,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),g=n.window}else g=r,f=a-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[a++]=g[f++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;r[a++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break e;s--,d|=i[o++]<<c,c+=8}if(h-=l,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?sr(n.check,r,h,a-h):ar(n.check,r,h,a-h)),h=l,(n.flags?d:cr(d))!==n.check){e.msg="incorrect data check",n.mode=30;break}d=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break e;s--,d+=i[o++]<<c,c+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}d=0,c=0}n.mode=29;case 29:_=1;break e;case 30:_=-3;break e;case 31:return-4;default:return-2}return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=c,(n.wsize||h!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&br(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?sr(n.check,r,h,e.next_out-h):ar(n.check,r,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===u&&0===h||4===t)&&0===_&&(_=-5),_},Qi.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},Qi.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},Qi.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&ar(1,t,i,0)!==n.check?-3:br(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},Qi.inflateInfo="pako inflate (from Nodeca project)";var xr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var kr=Qi,_r=Sn,Cr=Ri,Er=xr,Sr=pi,Ar=ji,Tr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Pr=Object.prototype.toString;function Lr(e){if(!(this instanceof Lr))return new Lr(e);this.options=_r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ar,this.strm.avail_out=0;var n=kr.inflateInit2(this.strm,t.windowBits);if(n!==Er.Z_OK)throw new Error(Sr[n]);this.header=new Tr,kr.inflateGetHeader(this.strm,this.header)}function Ir(e,t){var n=new Lr(t);if(n.push(e,!0),n.err)throw n.msg||Sr[n.err];return n.result}Lr.prototype.push=function(e,t){var n,i,r,o,a,s,l=this.strm,d=this.options.chunkSize,c=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?Er.Z_FINISH:Er.Z_NO_FLUSH,"string"==typeof e?l.input=Cr.binstring2buf(e):"[object ArrayBuffer]"===Pr.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new _r.Buf8(d),l.next_out=0,l.avail_out=d),(n=kr.inflate(l,Er.Z_NO_FLUSH))===Er.Z_NEED_DICT&&c&&(s="string"==typeof c?Cr.string2buf(c):"[object ArrayBuffer]"===Pr.call(c)?new Uint8Array(c):c,n=kr.inflateSetDictionary(this.strm,s)),n===Er.Z_BUF_ERROR&&!0===u&&(n=Er.Z_OK,u=!1),n!==Er.Z_STREAM_END&&n!==Er.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Er.Z_STREAM_END&&(0!==l.avail_in||i!==Er.Z_FINISH&&i!==Er.Z_SYNC_FLUSH)||("string"===this.options.to?(r=Cr.utf8border(l.output,l.next_out),o=l.next_out-r,a=Cr.buf2string(l.output,r),l.next_out=o,l.avail_out=d-o,o&&_r.arraySet(l.output,l.output,r,o,0),this.onData(a)):this.onData(_r.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(u=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Er.Z_STREAM_END);return n===Er.Z_STREAM_END&&(i=Er.Z_FINISH),i===Er.Z_FINISH?(n=kr.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Er.Z_OK):i!==Er.Z_SYNC_FLUSH||(this.onEnd(Er.Z_OK),l.avail_out=0,!0)},Lr.prototype.onData=function(e){this.chunks.push(e)},Lr.prototype.onEnd=function(e){e===Er.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Ji.Inflate=Lr,Ji.inflate=Ir,Ji.inflateRaw=function(e,t){return(t=t||{}).raw=!0,Ir(e,t)},Ji.ungzip=Ir;var zr={};(0,Sn.assign)(zr,An,Ji,xr);var Br,Mr=zr;En.exports=Br={},function(e,t){e.toRGBA8=function(t){var n=t.width,i=t.height;if(null==t.tabs.acTL)return[e.toRGBA8.decodeImage(t.data,n,i,t).buffer];var r=[];null==t.frames[0].data&&(t.frames[0].data=t.data);for(var o,a=new Uint8Array(n*i*4),s=0;s<t.frames.length;s++){var l=t.frames[s],d=l.rect.x,c=l.rect.y,u=l.rect.width,h=l.rect.height,p=e.toRGBA8.decodeImage(l.data,u,h,t);if(0==s?o=p:0==l.blend?e._copyTile(p,u,h,o,n,i,d,c,0):1==l.blend&&e._copyTile(p,u,h,o,n,i,d,c,1),r.push(o.buffer),o=o.slice(0),0==l.dispose);else if(1==l.dispose)e._copyTile(a,u,h,o,n,i,d,c,0);else if(2==l.dispose){for(var f=s-1;2==t.frames[f].dispose;)f--;o=new Uint8Array(r[f]).slice(0)}}return r},e.toRGBA8.decodeImage=function(t,n,i,r){var o=n*i,a=e.decode._getBPP(r),s=Math.ceil(n*a/8),l=new Uint8Array(4*o),d=new Uint32Array(l.buffer),c=r.ctype,u=r.depth,h=e._bin.readUshort;if(6==c){var p=o<<2;if(8==u)for(var f=0;f<p;f++)l[f]=t[f];if(16==u)for(f=0;f<p;f++)l[f]=t[f<<1]}else if(2==c){var g=r.tabs.tRNS,m=-1,v=-1,w=-1;if(g&&(m=g[0],v=g[1],w=g[2]),8==u)for(f=0;f<o;f++){var y=3*f;l[S=f<<2]=t[y],l[S+1]=t[y+1],l[S+2]=t[y+2],l[S+3]=255,-1!=m&&t[y]==m&&t[y+1]==v&&t[y+2]==w&&(l[S+3]=0)}if(16==u)for(f=0;f<o;f++)y=6*f,l[S=f<<2]=t[y],l[S+1]=t[y+2],l[S+2]=t[y+4],l[S+3]=255,-1!=m&&h(t,y)==m&&h(t,y+2)==v&&h(t,y+4)==w&&(l[S+3]=0)}else if(3==c){var b=r.tabs.PLTE,x=r.tabs.tRNS,k=x?x.length:0;if(1==u)for(var _=0;_<i;_++){var C=_*s,E=_*n;for(f=0;f<n;f++){var S=E+f<<2,A=3*(T=t[C+(f>>3)]>>7-((7&f)<<0)&1);l[S]=b[A],l[S+1]=b[A+1],l[S+2]=b[A+2],l[S+3]=T<k?x[T]:255}}if(2==u)for(_=0;_<i;_++)for(C=_*s,E=_*n,f=0;f<n;f++)S=E+f<<2,A=3*(T=t[C+(f>>2)]>>6-((3&f)<<1)&3),l[S]=b[A],l[S+1]=b[A+1],l[S+2]=b[A+2],l[S+3]=T<k?x[T]:255;if(4==u)for(_=0;_<i;_++)for(C=_*s,E=_*n,f=0;f<n;f++)S=E+f<<2,A=3*(T=t[C+(f>>1)]>>4-((1&f)<<2)&15),l[S]=b[A],l[S+1]=b[A+1],l[S+2]=b[A+2],l[S+3]=T<k?x[T]:255;if(8==u)for(f=0;f<o;f++){var T;S=f<<2,A=3*(T=t[f]),l[S]=b[A],l[S+1]=b[A+1],l[S+2]=b[A+2],l[S+3]=T<k?x[T]:255}}else if(4==c){if(8==u)for(f=0;f<o;f++){S=f<<2;var P=t[L=f<<1];l[S]=P,l[S+1]=P,l[S+2]=P,l[S+3]=t[L+1]}if(16==u)for(f=0;f<o;f++){var L;S=f<<2,P=t[L=f<<2],l[S]=P,l[S+1]=P,l[S+2]=P,l[S+3]=t[L+2]}}else if(0==c){if(m=r.tabs.tRNS?r.tabs.tRNS:-1,1==u)for(f=0;f<o;f++){var I=(P=255*(t[f>>3]>>7-(7&f)&1))==255*m?0:255;d[f]=I<<24|P<<16|P<<8|P}if(2==u)for(f=0;f<o;f++)I=(P=85*(t[f>>2]>>6-((3&f)<<1)&3))==85*m?0:255,d[f]=I<<24|P<<16|P<<8|P;if(4==u)for(f=0;f<o;f++)I=(P=17*(t[f>>1]>>4-((1&f)<<2)&15))==17*m?0:255,d[f]=I<<24|P<<16|P<<8|P;if(8==u)for(f=0;f<o;f++)I=(P=t[f])==m?0:255,d[f]=I<<24|P<<16|P<<8|P;if(16==u)for(f=0;f<o;f++)P=t[f<<1],I=h(t,f<<1)==m?0:255,d[f]=I<<24|P<<16|P<<8|P}return l},e.decode=function(t){for(var n,i=new Uint8Array(t),r=8,o=e._bin,a=o.readUshort,s=o.readUint,l={tabs:{},frames:[]},d=new Uint8Array(i.length),c=0,u=0,h=[137,80,78,71,13,10,26,10],p=0;p<8;p++)if(i[p]!=h[p])throw"The input is not a PNG file!";for(;r<i.length;){var f=o.readUint(i,r);r+=4;var g=o.readASCII(i,r,4);if(r+=4,"IHDR"==g)e.decode._IHDR(i,r,l);else if("IDAT"==g){for(p=0;p<f;p++)d[c+p]=i[r+p];c+=f}else if("acTL"==g)l.tabs[g]={num_frames:s(i,r),num_plays:s(i,r+4)},n=new Uint8Array(i.length);else if("fcTL"==g){0!=u&&((C=l.frames[l.frames.length-1]).data=e.decode._decompress(l,n.slice(0,u),C.rect.width,C.rect.height),u=0);var m={x:s(i,r+12),y:s(i,r+16),width:s(i,r+4),height:s(i,r+8)},v=a(i,r+22);v=a(i,r+20)/(0==v?100:v);var w={rect:m,delay:Math.round(1e3*v),dispose:i[r+24],blend:i[r+25]};l.frames.push(w)}else if("fdAT"==g){for(p=0;p<f-4;p++)n[u+p]=i[r+p+4];u+=f-4}else if("pHYs"==g)l.tabs[g]=[o.readUint(i,r),o.readUint(i,r+4),i[r+8]];else if("cHRM"==g)for(l.tabs[g]=[],p=0;p<8;p++)l.tabs[g].push(o.readUint(i,r+4*p));else if("tEXt"==g){null==l.tabs[g]&&(l.tabs[g]={});var y=o.nextZero(i,r),b=o.readASCII(i,r,y-r),x=o.readASCII(i,y+1,r+f-y-1);l.tabs[g][b]=x}else if("iTXt"==g){null==l.tabs[g]&&(l.tabs[g]={}),y=0;var k=r;y=o.nextZero(i,k),b=o.readASCII(i,k,y-k),i[k=y+1],i[k+1],k+=2,y=o.nextZero(i,k),o.readASCII(i,k,y-k),k=y+1,y=o.nextZero(i,k),o.readUTF8(i,k,y-k),k=y+1,x=o.readUTF8(i,k,f-(k-r)),l.tabs[g][b]=x}else if("PLTE"==g)l.tabs[g]=o.readBytes(i,r,f);else if("hIST"==g){var _=l.tabs.PLTE.length/3;for(l.tabs[g]=[],p=0;p<_;p++)l.tabs[g].push(a(i,r+2*p))}else if("tRNS"==g)3==l.ctype?l.tabs[g]=o.readBytes(i,r,f):0==l.ctype?l.tabs[g]=a(i,r):2==l.ctype&&(l.tabs[g]=[a(i,r),a(i,r+2),a(i,r+4)]);else if("gAMA"==g)l.tabs[g]=o.readUint(i,r)/1e5;else if("sRGB"==g)l.tabs[g]=i[r];else if("bKGD"==g)0==l.ctype||4==l.ctype?l.tabs[g]=[a(i,r)]:2==l.ctype||6==l.ctype?l.tabs[g]=[a(i,r),a(i,r+2),a(i,r+4)]:3==l.ctype&&(l.tabs[g]=i[r]);else if("IEND"==g){var C;0!=u&&((C=l.frames[l.frames.length-1]).data=e.decode._decompress(l,n.slice(0,u),C.rect.width,C.rect.height),u=0),l.data=e.decode._decompress(l,d,l.width,l.height);break}r+=f,o.readUint(i,r),r+=4}return delete l.compress,delete l.interlace,delete l.filter,l},e.decode._decompress=function(t,n,i,r){return 0==t.compress&&(n=e.decode._inflate(n)),0==t.interlace?n=e.decode._filterZero(n,t,0,i,r):1==t.interlace&&(n=e.decode._readInterlace(n,t)),n},e.decode._inflate=function(e){return t.inflate(e)},e.decode._readInterlace=function(t,n){for(var i=n.width,r=n.height,o=e.decode._getBPP(n),a=o>>3,s=Math.ceil(i*o/8),l=new Uint8Array(r*s),d=0,c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],f=0;f<7;){for(var g=h[f],m=p[f],v=0,w=0,y=c[f];y<r;)y+=g,w++;for(var b=u[f];b<i;)b+=m,v++;var x=Math.ceil(v*o/8);e.decode._filterZero(t,n,d,v,w);for(var k=0,_=c[f];_<r;){for(var C=u[f],E=d+k*x<<3;C<i;){var S;if(1==o&&(S=(S=t[E>>3])>>7-(7&E)&1,l[_*s+(C>>3)]|=S<<7-((3&C)<<0)),2==o&&(S=(S=t[E>>3])>>6-(7&E)&3,l[_*s+(C>>2)]|=S<<6-((3&C)<<1)),4==o&&(S=(S=t[E>>3])>>4-(7&E)&15,l[_*s+(C>>1)]|=S<<4-((1&C)<<2)),o>=8)for(var A=_*s+C*a,T=0;T<a;T++)l[A+T]=t[(E>>3)+T];E+=o,C+=m}k++,_+=g}v*w!=0&&(d+=w*(1+x)),f+=1}return l},e.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},e.decode._filterZero=function(t,n,i,r,o){var a=e.decode._getBPP(n),s=Math.ceil(r*a/8),l=e.decode._paeth;a=Math.ceil(a/8);for(var d=0;d<o;d++){var c=i+d*s,u=c+d+1,h=t[u-1];if(0==h)for(var p=0;p<s;p++)t[c+p]=t[u+p];else if(1==h){for(p=0;p<a;p++)t[c+p]=t[u+p];for(p=a;p<s;p++)t[c+p]=t[u+p]+t[c+p-a]&255}else if(0==d){for(p=0;p<a;p++)t[c+p]=t[u+p];if(2==h)for(p=a;p<s;p++)t[c+p]=255&t[u+p];if(3==h)for(p=a;p<s;p++)t[c+p]=t[u+p]+(t[c+p-a]>>1)&255;if(4==h)for(p=a;p<s;p++)t[c+p]=t[u+p]+l(t[c+p-a],0,0)&255}else{if(2==h)for(p=0;p<s;p++)t[c+p]=t[u+p]+t[c+p-s]&255;if(3==h){for(p=0;p<a;p++)t[c+p]=t[u+p]+(t[c+p-s]>>1)&255;for(p=a;p<s;p++)t[c+p]=t[u+p]+(t[c+p-s]+t[c+p-a]>>1)&255}if(4==h){for(p=0;p<a;p++)t[c+p]=t[u+p]+l(0,t[c+p-s],0)&255;for(p=a;p<s;p++)t[c+p]=t[u+p]+l(t[c+p-a],t[c+p-s],t[c+p-a-s])&255}}}return t},e.decode._paeth=function(e,t,n){var i=e+t-n,r=Math.abs(i-e),o=Math.abs(i-t),a=Math.abs(i-n);return r<=o&&r<=a?e:o<=a?t:n},e.decode._IHDR=function(t,n,i){var r=e._bin;i.width=r.readUint(t,n),n+=4,i.height=r.readUint(t,n),n+=4,i.depth=t[n],n++,i.ctype=t[n],n++,i.compress=t[n],n++,i.filter=t[n],n++,i.interlace=t[n],n++},e._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},writeASCII:function(e,t,n){for(var i=0;i<n.length;i++)e[t+i]=n.charCodeAt(i)},readBytes:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(e[t+r]);return i},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,n,i){for(var r,o="",a=0;a<i;a++)o+="%"+e._bin.pad(t[n+a].toString(16));try{r=decodeURIComponent(o)}catch(r){return e._bin.readASCII(t,n,i)}return r}},e._copyTile=function(e,t,n,i,r,o,a,s,l){for(var d=Math.min(t,r),c=Math.min(n,o),u=0,h=0,p=0;p<c;p++)for(var f=0;f<d;f++)if(a>=0&&s>=0?(u=p*t+f<<2,h=(s+p)*r+a+f<<2):(u=(-s+p)*t-a+f<<2,h=p*r+f<<2),0==l)i[h]=e[u],i[h+1]=e[u+1],i[h+2]=e[u+2],i[h+3]=e[u+3];else if(1==l){var g=e[u+3]*(1/255),m=e[u]*g,v=e[u+1]*g,w=e[u+2]*g,y=i[h+3]*(1/255),b=i[h]*y,x=i[h+1]*y,k=i[h+2]*y,_=1-g,C=g+y*_,E=0==C?0:1/C;i[h+3]=255*C,i[h+0]=(m+b*_)*E,i[h+1]=(v+x*_)*E,i[h+2]=(w+k*_)*E}else if(2==l)g=e[u+3],m=e[u],v=e[u+1],w=e[u+2],y=i[h+3],b=i[h],x=i[h+1],k=i[h+2],g==y&&m==b&&v==x&&w==k?(i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=0):(i[h]=m,i[h+1]=v,i[h+2]=w,i[h+3]=g);else if(3==l){if(g=e[u+3],m=e[u],v=e[u+1],w=e[u+2],y=i[h+3],b=i[h],x=i[h+1],k=i[h+2],g==y&&m==b&&v==x&&w==k)continue;if(g<220&&y>20)return!1}return!0},e.encode=function(t,n,i,r,o,a){null==r&&(r=0),null==a&&(a=!1);for(var s=new Uint8Array(t[0].byteLength*t.length+100),l=[137,80,78,71,13,10,26,10],d=0;d<8;d++)s[d]=l[d];var c=8,u=e._bin,h=e.crc.crc,p=u.writeUint,f=u.writeUshort,g=u.writeASCII,m=e.encode.compressPNG(t,n,i,r,a);p(s,c,13),g(s,c+=4,"IHDR"),p(s,c+=4,n),p(s,c+=4,i),s[c+=4]=m.depth,s[++c]=m.ctype,s[++c]=0,s[++c]=0,s[++c]=0,p(s,++c,h(s,c-17,17)),p(s,c+=4,1),g(s,c+=4,"sRGB"),s[c+=4]=1,p(s,++c,h(s,c-5,5)),c+=4;var v=t.length>1;if(v&&(p(s,c,8),g(s,c+=4,"acTL"),p(s,c+=4,t.length),p(s,c+=4,0),p(s,c+=4,h(s,c-12,12)),c+=4),3==m.ctype){for(p(s,c,3*(S=m.plte.length)),g(s,c+=4,"PLTE"),c+=4,d=0;d<S;d++){var w=3*d,y=m.plte[d],b=255&y,x=y>>8&255,k=y>>16&255;s[c+w+0]=b,s[c+w+1]=x,s[c+w+2]=k}if(p(s,c+=3*S,h(s,c-3*S-4,3*S+4)),c+=4,m.gotAlpha){for(p(s,c,S),g(s,c+=4,"tRNS"),c+=4,d=0;d<S;d++)s[c+d]=m.plte[d]>>24&255;p(s,c+=S,h(s,c-S-4,S+4)),c+=4}}for(var _=0,C=0;C<m.frames.length;C++){var E=m.frames[C];v&&(p(s,c,26),g(s,c+=4,"fcTL"),p(s,c+=4,_++),p(s,c+=4,E.rect.width),p(s,c+=4,E.rect.height),p(s,c+=4,E.rect.x),p(s,c+=4,E.rect.y),f(s,c+=4,o[C]),f(s,c+=2,1e3),s[c+=2]=E.dispose,s[++c]=E.blend,p(s,++c,h(s,c-30,30)),c+=4);var S,A=E.cimg;p(s,c,(S=A.length)+(0==C?0:4));var T=c+=4;for(g(s,c,0==C?"IDAT":"fdAT"),c+=4,0!=C&&(p(s,c,_++),c+=4),d=0;d<S;d++)s[c+d]=A[d];p(s,c+=S,h(s,T,c-T)),c+=4}return p(s,c,0),g(s,c+=4,"IEND"),p(s,c+=4,h(s,c-4,4)),c+=4,s.buffer.slice(0,c)},e.encode.compressPNG=function(t,n,i,r,o){for(var a=e.encode.compress(t,n,i,r,!1,o),s=0;s<t.length;s++){var l=a.frames[s];l.rect.width;var d=l.rect.height,c=l.bpl,u=l.bpp,h=new Uint8Array(d*c+d);l.cimg=e.encode._filterZero(l.img,d,u,c,h)}return a},e.encode.compress=function(t,n,i,r,o,a){null==a&&(a=!1);for(var s=6,l=8,d=4,c=255,u=0;u<t.length;u++)for(var h=new Uint8Array(t[u]),p=h.length,f=0;f<p;f+=4)c&=h[f+3];var g=255!=c,m={},v=[];if(0!=t.length&&(m[0]=0,v.push(0),0!=r&&r--),0!=r){var w=e.quantize(t,r,o);for(t=w.bufs,f=0;f<w.plte.length;f++)null==m[b=w.plte[f].est.rgba]&&(m[b]=v.length,v.push(b))}else for(u=0;u<t.length;u++){var y=new Uint32Array(t[u]);for(p=y.length,f=0;f<p;f++){var b=y[f];if((f<n||b!=y[f-1]&&b!=y[f-n])&&null==m[b]&&(m[b]=v.length,v.push(b),v.length>=300))break}}var x=!!g&&o,k=v.length;k<=256&&0==a&&(l=k<=2?1:k<=4?2:k<=16?4:8,o&&(l=8),g=!0);var _=[];for(u=0;u<t.length;u++){var C=new Uint8Array(t[u]),E=new Uint32Array(C.buffer),S=0,A=0,T=n,P=i,L=0;if(0!=u&&!x){for(var I=o||1==u||2==_[_.length-2].dispose?1:2,z=0,B=1e9,M=0;M<I;M++){for(var O=new Uint8Array(t[u-1-M]),R=new Uint32Array(t[u-1-M]),N=n,U=i,D=-1,V=-1,F=0;F<i;F++)for(var $=0;$<n;$++)E[f=F*n+$]!=R[f]&&($<N&&(N=$),$>D&&(D=$),F<U&&(U=F),F>V&&(V=F));var j=-1==D?1:(D-N+1)*(V-U+1);j<B&&(B=j,z=M,-1==D?(S=A=0,T=P=1):(S=N,A=U,T=D-N+1,P=V-U+1))}O=new Uint8Array(t[u-1-z]),1==z&&(_[_.length-1].dispose=2);var W=new Uint8Array(T*P*4);new Uint32Array(W.buffer),e._copyTile(O,n,i,W,T,P,-S,-A,0),e._copyTile(C,n,i,W,T,P,-S,-A,3)?(e._copyTile(C,n,i,W,T,P,-S,-A,2),L=1):(e._copyTile(C,n,i,W,T,P,-S,-A,0),L=0),C=W,E=new Uint32Array(C.buffer)}var H=4*T;if(k<=256&&0==a){for(H=Math.ceil(l*T/8),W=new Uint8Array(H*P),F=0;F<P;F++){f=F*H;var Y=F*T;if(8==l)for($=0;$<T;$++)W[f+$]=m[E[Y+$]];else if(4==l)for($=0;$<T;$++)W[f+($>>1)]|=m[E[Y+$]]<<4-4*(1&$);else if(2==l)for($=0;$<T;$++)W[f+($>>2)]|=m[E[Y+$]]<<6-2*(3&$);else if(1==l)for($=0;$<T;$++)W[f+($>>3)]|=m[E[Y+$]]<<7-1*(7&$)}C=W,s=3,d=1}else if(0==g&&1==t.length){W=new Uint8Array(T*P*3);var X=T*P;for(f=0;f<X;f++){var q=3*f,G=4*f;W[q]=C[G],W[q+1]=C[G+1],W[q+2]=C[G+2]}C=W,s=2,d=3,H=3*T}_.push({rect:{x:S,y:A,width:T,height:P},img:C,bpl:H,bpp:d,blend:L,dispose:x?1:0})}return{ctype:s,depth:l,plte:v,gotAlpha:g,frames:_}},e.encode._filterZero=function(n,i,r,o,a){for(var s=[],l=0;l<5;l++)if(!(i*o>5e5)||2!=l&&3!=l&&4!=l){for(var d=0;d<i;d++)e.encode._filterLine(a,n,d,o,r,l);if(s.push(t.deflate(a)),1==r)break}for(var c,u=1e9,h=0;h<s.length;h++)s[h].length<u&&(c=h,u=s[h].length);return s[c]},e.encode._filterLine=function(t,n,i,r,o,a){var s=i*r,l=s+i,d=e.decode._paeth;if(t[l]=a,l++,0==a)for(var c=0;c<r;c++)t[l+c]=n[s+c];else if(1==a){for(c=0;c<o;c++)t[l+c]=n[s+c];for(c=o;c<r;c++)t[l+c]=n[s+c]-n[s+c-o]+256&255}else if(0==i){for(c=0;c<o;c++)t[l+c]=n[s+c];if(2==a)for(c=o;c<r;c++)t[l+c]=n[s+c];if(3==a)for(c=o;c<r;c++)t[l+c]=n[s+c]-(n[s+c-o]>>1)+256&255;if(4==a)for(c=o;c<r;c++)t[l+c]=n[s+c]-d(n[s+c-o],0,0)+256&255}else{if(2==a)for(c=0;c<r;c++)t[l+c]=n[s+c]+256-n[s+c-r]&255;if(3==a){for(c=0;c<o;c++)t[l+c]=n[s+c]+256-(n[s+c-r]>>1)&255;for(c=o;c<r;c++)t[l+c]=n[s+c]+256-(n[s+c-r]+n[s+c-o]>>1)&255}if(4==a){for(c=0;c<o;c++)t[l+c]=n[s+c]+256-d(0,n[s+c-r],0)&255;for(c=o;c<r;c++)t[l+c]=n[s+c]+256-d(n[s+c-o],n[s+c-r],n[s+c-o-r])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,i=0;i<8;i++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(t,n,i,r){for(var o=0;o<r;o++)t=e.crc.table[255&(t^n[i+o])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.quantize=function(t,n,i){for(var r=[],o=0,a=0;a<t.length;a++)r.push(e.encode.alphaMul(new Uint8Array(t[a]),i)),o+=t[a].byteLength;var s=new Uint8Array(o),l=new Uint32Array(s.buffer),d=0;for(a=0;a<r.length;a++){for(var c=r[a],u=c.length,h=0;h<u;h++)s[d+h]=c[h];d+=u}var p={i0:0,i1:s.length,bst:null,est:null,tdst:0,left:null,right:null};p.bst=e.quantize.stats(s,p.i0,p.i1),p.est=e.quantize.estats(p.bst);for(var f=[p];f.length<n;){var g=0,m=0;for(a=0;a<f.length;a++)f[a].est.L>g&&(g=f[a].est.L,m=a);if(g<.001)break;var v=f[m],w=e.quantize.splitPixels(s,l,v.i0,v.i1,v.est.e,v.est.eMq255),y={i0:v.i0,i1:w,bst:null,est:null,tdst:0,left:null,right:null};y.bst=e.quantize.stats(s,y.i0,y.i1),y.est=e.quantize.estats(y.bst);var b={i0:w,i1:v.i1,bst:null,est:null,tdst:0,left:null,right:null};for(b.bst={R:[],m:[],N:v.bst.N-y.bst.N},a=0;a<16;a++)b.bst.R[a]=v.bst.R[a]-y.bst.R[a];for(a=0;a<4;a++)b.bst.m[a]=v.bst.m[a]-y.bst.m[a];b.est=e.quantize.estats(b.bst),v.left=y,v.right=b,f[m]=y,f.push(b)}f.sort((function(e,t){return t.bst.N-e.bst.N}));for(var x=0;x<r.length;x++){var k=e.quantize.planeDst,_=new Uint8Array(r[x].buffer),C=new Uint32Array(r[x].buffer),E=_.length;for(a=0;a<E;a+=4){for(var S=_[a]*(1/255),A=_[a+1]*(1/255),T=_[a+2]*(1/255),P=_[a+3]*(1/255),L=p;L.left;)L=k(L.est,S,A,T,P)<=0?L.left:L.right;C[a>>2]=L.est.rgba}r[x]=C.buffer}return{bufs:r,plte:f}},e.quantize.getNearest=function(t,n,i,r,o){if(null==t.left)return t.tdst=e.quantize.dist(t.est.q,n,i,r,o),t;var a=e.quantize.planeDst(t.est,n,i,r,o),s=t.left,l=t.right;a>0&&(s=t.right,l=t.left);var d=e.quantize.getNearest(s,n,i,r,o);if(d.tdst<=a*a)return d;var c=e.quantize.getNearest(l,n,i,r,o);return c.tdst<d.tdst?c:d},e.quantize.planeDst=function(e,t,n,i,r){var o=e.e;return o[0]*t+o[1]*n+o[2]*i+o[3]*r-e.eMq},e.quantize.dist=function(e,t,n,i,r){var o=t-e[0],a=n-e[1],s=i-e[2],l=r-e[3];return o*o+a*a+s*s+l*l},e.quantize.splitPixels=function(t,n,i,r,o,a){var s=e.quantize.vecDot;for(r-=4;i<r;){for(;s(t,i,o)<=a;)i+=4;for(;s(t,r,o)>a;)r-=4;if(i>=r)break;var l=n[i>>2];n[i>>2]=n[r>>2],n[r>>2]=l,i+=4,r-=4}for(;s(t,i,o)>a;)i-=4;return i+4},e.quantize.vecDot=function(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]},e.quantize.stats=function(e,t,n){for(var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0],o=n-t>>2,a=t;a<n;a+=4){var s=e[a]*(1/255),l=e[a+1]*(1/255),d=e[a+2]*(1/255),c=e[a+3]*(1/255);r[0]+=s,r[1]+=l,r[2]+=d,r[3]+=c,i[0]+=s*s,i[1]+=s*l,i[2]+=s*d,i[3]+=s*c,i[5]+=l*l,i[6]+=l*d,i[7]+=l*c,i[10]+=d*d,i[11]+=d*c,i[15]+=c*c}return i[4]=i[1],i[8]=i[2],i[12]=i[3],i[9]=i[6],i[13]=i[7],i[14]=i[11],{R:i,m:r,N:o}},e.quantize.estats=function(t){var n=t.R,i=t.m,r=t.N,o=i[0],a=i[1],s=i[2],l=i[3],d=0==r?0:1/r,c=[n[0]-o*o*d,n[1]-o*a*d,n[2]-o*s*d,n[3]-o*l*d,n[4]-a*o*d,n[5]-a*a*d,n[6]-a*s*d,n[7]-a*l*d,n[8]-s*o*d,n[9]-s*a*d,n[10]-s*s*d,n[11]-s*l*d,n[12]-l*o*d,n[13]-l*a*d,n[14]-l*s*d,n[15]-l*l*d],u=c,h=e.M4,p=[.5,.5,.5,.5],f=0,g=0;if(0!=r)for(var m=0;m<10&&(p=h.multVec(u,p),g=Math.sqrt(h.dot(p,p)),p=h.sml(1/g,p),!(Math.abs(g-f)<1e-9));m++)f=g;var v=[o*d,a*d,s*d,l*d],w=h.dot(h.sml(255,v),p),y=v[3]<.001?0:1/v[3];return{Cov:c,q:v,e:p,L:f,eMq255:w,eMq:h.dot(p,v),rgba:(Math.round(255*v[3])<<24|Math.round(255*v[2]*y)<<16|Math.round(255*v[1]*y)<<8|Math.round(255*v[0]*y)<<0)>>>0}},e.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},e.encode.alphaMul=function(e,t){for(var n=new Uint8Array(e.length),i=e.length>>2,r=0;r<i;r++){var o=r<<2,a=e[o+3];t&&(a=a<128?0:255);var s=a*(1/255);n[o+0]=e[o+0]*s,n[o+1]=e[o+1]*s,n[o+2]=e[o+2]*s,n[o+3]=a}return n}}(Br,Mr);var Or=En.exports,Rr={exports:{}};!function(e){function t(e){var t,n,i,r,o,a=Math.floor,s=new Array(64),l=new Array(64),d=new Array(64),c=new Array(64),u=new Array(65535),h=new Array(65535),p=new Array(64),f=new Array(64),g=[],m=0,v=7,w=new Array(64),y=new Array(64),b=new Array(64),x=new Array(256),k=new Array(2048),_=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],E=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],T=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],L=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function z(e,t){for(var n=0,i=0,r=new Array,o=1;o<=16;o++){for(var a=1;a<=e[o];a++)r[t[i]]=[],r[t[i]][0]=n,r[t[i]][1]=o,i++,n++;n*=2}return r}function B(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(m|=1<<v),n--,--v<0&&(255==m?(M(255),M(0)):M(m),v=7,m=0)}function M(e){g.push(e)}function O(e){M(e>>8&255),M(255&e)}function R(e,t,n,i,r){for(var o,a=r[0],s=r[240],l=function(e,t){var n,i,r,o,a,s,l,d,c,u,h=0;for(c=0;c<8;++c){n=e[h],i=e[h+1],r=e[h+2],o=e[h+3],a=e[h+4],s=e[h+5],l=e[h+6];var f=n+(d=e[h+7]),g=n-d,m=i+l,v=i-l,w=r+s,y=r-s,b=o+a,x=o-a,k=f+b,_=f-b,C=m+w,E=m-w;e[h]=k+C,e[h+4]=k-C;var S=.707106781*(E+_);e[h+2]=_+S,e[h+6]=_-S;var A=.382683433*((k=x+y)-(E=v+g)),T=.5411961*k+A,P=1.306562965*E+A,L=.707106781*(C=y+v),I=g+L,z=g-L;e[h+5]=z+T,e[h+3]=z-T,e[h+1]=I+P,e[h+7]=I-P,h+=8}for(h=0,c=0;c<8;++c){n=e[h],i=e[h+8],r=e[h+16],o=e[h+24],a=e[h+32],s=e[h+40],l=e[h+48];var B=n+(d=e[h+56]),M=n-d,O=i+l,R=i-l,N=r+s,U=r-s,D=o+a,V=o-a,F=B+D,$=B-D,j=O+N,W=O-N;e[h]=F+j,e[h+32]=F-j;var H=.707106781*(W+$);e[h+16]=$+H,e[h+48]=$-H;var Y=.382683433*((F=V+U)-(W=R+M)),X=.5411961*F+Y,q=1.306562965*W+Y,G=.707106781*(j=U+R),Z=M+G,K=M-G;e[h+40]=K+X,e[h+24]=K-X,e[h+8]=Z+q,e[h+56]=Z-q,h++}for(c=0;c<64;++c)u=e[c]*t[c],p[c]=u>0?u+.5|0:u-.5|0;return p}(e,t),d=0;d<64;++d)f[_[d]]=l[d];var c=f[0]-n;n=f[0],0==c?B(i[0]):(B(i[h[o=32767+c]]),B(u[o]));for(var g=63;g>0&&0==f[g];g--);if(0==g)return B(a),n;for(var m,v=1;v<=g;){for(var w=v;0==f[v]&&v<=g;++v);var y=v-w;if(y>=16){m=y>>4;for(var b=1;b<=m;++b)B(s);y&=15}o=32767+f[v],B(r[(y<<4)+h[o]]),B(u[o]),v++}return 63!=g&&B(a),n}function N(e){e<=0&&(e=1),e>100&&(e=100),o!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var i=a((t[n]*e+50)/100);i<1?i=1:i>255&&(i=255),s[_[n]]=i}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var u=a((r[o]*e+50)/100);u<1?u=1:u>255&&(u=255),l[_[o]]=u}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,f=0;f<8;f++)for(var g=0;g<8;g++)d[p]=1/(s[_[p]]*h[f]*h[g]*8),c[p]=1/(l[_[p]]*h[f]*h[g]*8),p++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),o=e)}this.encode=function(e,o){(new Date).getTime(),o&&N(o),g=new Array,m=0,v=7,O(65496),O(65504),O(16),M(74),M(70),M(73),M(70),M(0),M(1),M(1),M(0),O(1),O(1),M(0),M(0),function(e){if(e){O(65505),69===e[0]&&120===e[1]&&105===e[2]&&102===e[3]?O(e.length+2):(O(e.length+5+2),M(69),M(120),M(105),M(102),M(0));for(var t=0;t<e.length;t++)M(e[t])}}(e.exifBuffer),function(){O(65499),O(132),M(0);for(var e=0;e<64;e++)M(s[e]);M(1);for(var t=0;t<64;t++)M(l[t])}(),function(e,t){O(65472),O(17),M(8),O(t),O(e),M(3),M(1),M(17),M(0),M(2),M(17),M(1),M(3),M(17),M(1)}(e.width,e.height),function(){O(65476),O(418),M(0);for(var e=0;e<16;e++)M(C[e+1]);for(var t=0;t<=11;t++)M(E[t]);M(16);for(var n=0;n<16;n++)M(S[n+1]);for(var i=0;i<=161;i++)M(A[i]);M(1);for(var r=0;r<16;r++)M(T[r+1]);for(var o=0;o<=11;o++)M(P[o]);M(17);for(var a=0;a<16;a++)M(L[a+1]);for(var s=0;s<=161;s++)M(I[s])}(),O(65498),O(12),M(3),M(1),M(0),M(2),M(17),M(3),M(17),M(0),M(63),M(0);var a=0,u=0,h=0;m=0,v=7,this.encode.displayName="_encode_";for(var p,f,x,_,z,U,D,V,F,$=e.data,j=e.width,W=e.height,H=4*j,Y=0;Y<W;){for(p=0;p<H;){for(U=z=H*Y+p,D=-1,V=0,F=0;F<64;F++)U=z+(V=F>>3)*H+(D=4*(7&F)),Y+V>=W&&(U-=H*(Y+1+V-W)),p+D>=H&&(U-=p+D-H+4),f=$[U++],x=$[U++],_=$[U++],w[F]=(k[f]+k[x+256>>0]+k[_+512>>0]>>16)-128,y[F]=(k[f+768>>0]+k[x+1024>>0]+k[_+1280>>0]>>16)-128,b[F]=(k[f+1280>>0]+k[x+1536>>0]+k[_+1792>>0]>>16)-128;a=R(w,d,a,t,i),u=R(y,c,u,n,r),h=R(b,c,h,n,r),p+=32}Y+=8}if(v>=0){var X=[];X[1]=v+1,X[0]=(1<<v+1)-1,B(X)}return O(65497),Buffer.from(g)},(new Date).getTime(),e||(e=50),function(){for(var e=String.fromCharCode,t=0;t<256;t++)x[t]=e(t)}(),t=z(C,E),n=z(T,P),i=z(S,A),r=z(L,I),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var i=e;i<t;i++)h[32767+i]=n,u[32767+i]=[],u[32767+i][1]=n,u[32767+i][0]=i;for(var r=-(t-1);r<=-e;r++)h[32767+r]=n,u[32767+r]=[],u[32767+r][1]=n,u[32767+r][0]=t-1+r;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)k[e]=19595*e,k[e+256>>0]=38470*e,k[e+512>>0]=7471*e+32768,k[e+768>>0]=-11059*e,k[e+1024>>0]=-21709*e,k[e+1280>>0]=32768*e+8421375,k[e+1536>>0]=-27439*e,k[e+1792>>0]=-5329*e}(),N(e),(new Date).getTime()}Rr.exports=function(e,n){return void 0===n&&(n=50),{data:new t(n).encode(e,n),width:e.width,height:e.height}}}();var Nr={exports:{}};!function(e){var t=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,i=3406,r=2276,o=1567,a=3784,s=5793,l=2896;function d(){}function c(e,t){for(var n,i,r=0,o=[],a=16;a>0&&!e[a-1];)a--;o.push({children:[],index:0});var s,l=o[0];for(n=0;n<a;n++){for(i=0;i<e[n];i++){for((l=o.pop()).children[l.index]=t[r];l.index>0;){if(0===o.length)throw new Error("Could not recreate Huffman Table");l=o.pop()}for(l.index++,o.push(l);o.length<=n;)o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;r++}n+1<a&&(o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return o[0].children}function u(t,n,i,r,o,a,s,l,d,c){i.precision,i.samplesPerLine,i.scanLines;var u=i.mcusPerLine,h=i.progressive;i.maxH,i.maxV;var p=n,f=0,g=0;function m(){if(g>0)return g--,f>>g&1;if(255==(f=t[n++])){var e=t[n++];if(e)throw new Error("unexpected marker: "+(f<<8|e).toString(16))}return g=7,f>>>7}function v(e){for(var t,n=e;null!==(t=m());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw new Error("invalid huffman sequence")}return null}function w(e){for(var t=0;e>0;){var n=m();if(null===n)return;t=t<<1|n,e--}return t}function y(e){var t=w(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b,x=0,k=0;function _(e,t,n,i,r){var o=n%u,a=(n/u|0)*e.v+i,s=o*e.h+r;void 0===e.blocks[a]&&c.tolerantDecoding||t(e,e.blocks[a][s])}function C(e,t,n){var i=n/e.blocksPerLine|0,r=n%e.blocksPerLine;void 0===e.blocks[i]&&c.tolerantDecoding||t(e,e.blocks[i][r])}var E,S,A,T,P,L,I=r.length;L=h?0===a?0===l?function(e,t){var n=v(e.huffmanTableDC),i=0===n?0:y(n)<<d;t[0]=e.pred+=i}:function(e,t){t[0]|=m()<<d}:0===l?function(t,n){if(x>0)x--;else for(var i=a,r=s;i<=r;){var o=v(t.huffmanTableAC),l=15&o,c=o>>4;if(0!==l)n[e[i+=c]]=y(l)*(1<<d),i++;else{if(c<15){x=w(c)+(1<<c)-1;break}i+=16}}}:function(t,n){for(var i=a,r=s,o=0;i<=r;){var l=e[i],c=n[l]<0?-1:1;switch(k){case 0:var u=v(t.huffmanTableAC),h=15&u;if(o=u>>4,0===h)o<15?(x=w(o)+(1<<o),k=4):(o=16,k=1);else{if(1!==h)throw new Error("invalid ACn encoding");b=y(h),k=o?2:3}continue;case 1:case 2:n[l]?n[l]+=(m()<<d)*c:0==--o&&(k=2==k?3:0);break;case 3:n[l]?n[l]+=(m()<<d)*c:(n[l]=b<<d,k=0);break;case 4:n[l]&&(n[l]+=(m()<<d)*c)}i++}4===k&&0==--x&&(k=0)}:function(t,n){var i=v(t.huffmanTableDC),r=0===i?0:y(i);n[0]=t.pred+=r;for(var o=1;o<64;){var a=v(t.huffmanTableAC),s=15&a,l=a>>4;if(0!==s)n[e[o+=l]]=y(s),o++;else{if(l<15)break;o+=16}}};var z,B,M,O,R=0;for(B=1==I?r[0].blocksPerLine*r[0].blocksPerColumn:u*i.mcusPerColumn,o||(o=B);R<B;){for(S=0;S<I;S++)r[S].pred=0;if(x=0,1==I)for(E=r[0],P=0;P<o;P++)C(E,L,R),R++;else for(P=0;P<o;P++){for(S=0;S<I;S++)for(M=(E=r[S]).h,O=E.v,A=0;A<O;A++)for(T=0;T<M;T++)_(E,L,R,A,T);if(++R===B)break}if(R===B)do{if(255===t[n]&&0!==t[n+1])break;n+=1}while(n<t.length-2);if(g=0,(z=t[n]<<8|t[n+1])<65280)throw new Error("marker was not found");if(!(z>=65488&&z<=65495))break;n+=2}return n-p}function h(e,d){var c,u,h=[],p=d.blocksPerLine,f=d.blocksPerColumn,g=p<<3,v=new Int32Array(64),w=new Uint8Array(64);function y(e,c,u){var h,p,f,g,m,v,w,y,b,x,k=d.quantizationTable,_=u;for(x=0;x<64;x++)_[x]=e[x]*k[x];for(x=0;x<8;++x){var C=8*x;0!=_[1+C]||0!=_[2+C]||0!=_[3+C]||0!=_[4+C]||0!=_[5+C]||0!=_[6+C]||0!=_[7+C]?(h=s*_[0+C]+128>>8,p=s*_[4+C]+128>>8,f=_[2+C],g=_[6+C],m=l*(_[1+C]-_[7+C])+128>>8,y=l*(_[1+C]+_[7+C])+128>>8,v=_[3+C]<<4,w=_[5+C]<<4,b=h-p+1>>1,h=h+p+1>>1,p=b,b=f*a+g*o+128>>8,f=f*o-g*a+128>>8,g=b,b=m-w+1>>1,m=m+w+1>>1,w=b,b=y+v+1>>1,v=y-v+1>>1,y=b,b=h-g+1>>1,h=h+g+1>>1,g=b,b=p-f+1>>1,p=p+f+1>>1,f=b,b=m*r+y*i+2048>>12,m=m*i-y*r+2048>>12,y=b,b=v*n+w*t+2048>>12,v=v*t-w*n+2048>>12,w=b,_[0+C]=h+y,_[7+C]=h-y,_[1+C]=p+w,_[6+C]=p-w,_[2+C]=f+v,_[5+C]=f-v,_[3+C]=g+m,_[4+C]=g-m):(b=s*_[0+C]+512>>10,_[0+C]=b,_[1+C]=b,_[2+C]=b,_[3+C]=b,_[4+C]=b,_[5+C]=b,_[6+C]=b,_[7+C]=b)}for(x=0;x<8;++x){var E=x;0!=_[8+E]||0!=_[16+E]||0!=_[24+E]||0!=_[32+E]||0!=_[40+E]||0!=_[48+E]||0!=_[56+E]?(h=s*_[0+E]+2048>>12,p=s*_[32+E]+2048>>12,f=_[16+E],g=_[48+E],m=l*(_[8+E]-_[56+E])+2048>>12,y=l*(_[8+E]+_[56+E])+2048>>12,v=_[24+E],w=_[40+E],b=h-p+1>>1,h=h+p+1>>1,p=b,b=f*a+g*o+2048>>12,f=f*o-g*a+2048>>12,g=b,b=m-w+1>>1,m=m+w+1>>1,w=b,b=y+v+1>>1,v=y-v+1>>1,y=b,b=h-g+1>>1,h=h+g+1>>1,g=b,b=p-f+1>>1,p=p+f+1>>1,f=b,b=m*r+y*i+2048>>12,m=m*i-y*r+2048>>12,y=b,b=v*n+w*t+2048>>12,v=v*t-w*n+2048>>12,w=b,_[0+E]=h+y,_[56+E]=h-y,_[8+E]=p+w,_[48+E]=p-w,_[16+E]=f+v,_[40+E]=f-v,_[24+E]=g+m,_[32+E]=g-m):(b=s*u[x+0]+8192>>14,_[0+E]=b,_[8+E]=b,_[16+E]=b,_[24+E]=b,_[32+E]=b,_[40+E]=b,_[48+E]=b,_[56+E]=b)}for(x=0;x<64;++x){var S=128+(_[x]+8>>4);c[x]=S<0?0:S>255?255:S}}m(g*f*8);for(var b=0;b<f;b++){var x=b<<3;for(c=0;c<8;c++)h.push(new Uint8Array(g));for(var k=0;k<p;k++){y(d.blocks[b][k],w,v);var _=0,C=k<<3;for(u=0;u<8;u++){var E=h[x+u];for(c=0;c<8;c++)E[C+c]=w[_++]}}}return h}function p(e){return e<0?0:e>255?255:e}d.prototype={load:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(t.response||t.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),t.send(null)},parse:function(t){var n=1e3*this.opts.maxResolutionInMP*1e3,i=0;function r(){var e=t[i]<<8|t[i+1];return i+=2,e}function o(e){var t,n,i=0,r=0;for(n in e.components)e.components.hasOwnProperty(n)&&(i<(t=e.components[n]).h&&(i=t.h),r<t.v&&(r=t.v));var o=Math.ceil(e.samplesPerLine/8/i),a=Math.ceil(e.scanLines/8/r);for(n in e.components)if(e.components.hasOwnProperty(n)){t=e.components[n];var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/i),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/r),d=o*t.h,c=a*t.v,u=[];m(c*d*256);for(var h=0;h<c;h++){for(var p=[],f=0;f<d;f++)p.push(new Int32Array(64));u.push(p)}t.blocksPerLine=s,t.blocksPerColumn=l,t.blocks=u}e.maxH=i,e.maxV=r,e.mcusPerLine=o,e.mcusPerColumn=a}t.length;var a,s,l,d,p=null,f=null,g=[],v=[],w=[],y=[],b=r(),x=-1;if(this.comments=[],65496!=b)throw new Error("SOI not found");for(b=r();65497!=b;){switch(b){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var k=(void 0,void 0,l=r(),d=t.subarray(i,i+l-2),i+=d.length,d);if(65534===b){var _=String.fromCharCode.apply(null,k);this.comments.push(_)}65504===b&&74===k[0]&&70===k[1]&&73===k[2]&&70===k[3]&&0===k[4]&&(p={version:{major:k[5],minor:k[6]},densityUnits:k[7],xDensity:k[8]<<8|k[9],yDensity:k[10]<<8|k[11],thumbWidth:k[12],thumbHeight:k[13],thumbData:k.subarray(14,14+3*k[12]*k[13])}),65505===b&&69===k[0]&&120===k[1]&&105===k[2]&&102===k[3]&&0===k[4]&&(this.exifBuffer=k.subarray(5,k.length)),65518===b&&65===k[0]&&100===k[1]&&111===k[2]&&98===k[3]&&101===k[4]&&0===k[5]&&(f={version:k[6],flags0:k[7]<<8|k[8],flags1:k[9]<<8|k[10],transformCode:k[11]});break;case 65499:for(var C=r()+i-2;i<C;){var E=t[i++];m(256);var S=new Int32Array(64);if(E>>4==0)for(q=0;q<64;q++)S[e[q]]=t[i++];else{if(E>>4!=1)throw new Error("DQT: invalid table spec");for(q=0;q<64;q++)S[e[q]]=r()}g[15&E]=S}break;case 65472:case 65473:case 65474:r(),(a={}).extended=65473===b,a.progressive=65474===b,a.precision=t[i++],a.scanLines=r(),a.samplesPerLine=r(),a.components={},a.componentsOrder=[];var A=a.scanLines*a.samplesPerLine;if(A>n){var T=Math.ceil((A-n)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${T}MP`)}var P,L=t[i++];for(Y=0;Y<L;Y++){P=t[i];var I=t[i+1]>>4,z=15&t[i+1],B=t[i+2];a.componentsOrder.push(P),a.components[P]={h:I,v:z,quantizationIdx:B},i+=3}o(a),v.push(a);break;case 65476:var M=r();for(Y=2;Y<M;){var O=t[i++],R=new Uint8Array(16),N=0;for(q=0;q<16;q++,i++)N+=R[q]=t[i];m(16+N);var U=new Uint8Array(N);for(q=0;q<N;q++,i++)U[q]=t[i];Y+=17+N,(O>>4==0?y:w)[15&O]=c(R,U)}break;case 65501:r(),s=r();break;case 65500:r(),r();break;case 65498:r();var D=t[i++],V=[];for(Y=0;Y<D;Y++){G=a.components[t[i++]];var F=t[i++];G.huffmanTableDC=y[F>>4],G.huffmanTableAC=w[15&F],V.push(G)}var $=t[i++],j=t[i++],W=t[i++],H=u(t,i,a,V,s,$,j,W>>4,15&W,this.opts);i+=H;break;case 65535:255!==t[i]&&i--;break;default:if(255==t[i-3]&&t[i-2]>=192&&t[i-2]<=254){i-=3;break}if(224===b||225==b){if(-1!==x)throw new Error(`first unknown JPEG marker at offset ${x.toString(16)}, second unknown JPEG marker ${b.toString(16)} at offset ${(i-1).toString(16)}`);x=i-1;const e=r();if(255===t[i+e-2]){i+=e-2;break}}throw new Error("unknown JPEG marker "+b.toString(16))}b=r()}if(1!=v.length)throw new Error("only single frame JPEGs supported");for(var Y=0;Y<v.length;Y++){var X=v[Y].components;for(var q in X)X[q].quantizationTable=g[X[q].quantizationIdx],delete X[q].quantizationIdx}for(this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=p,this.adobe=f,this.components=[],Y=0;Y<a.componentsOrder.length;Y++){var G=a.components[a.componentsOrder[Y]];this.components.push({lines:h(0,G),scaleX:G.h/a.maxH,scaleY:G.v/a.maxV})}},getData:function(e,t){var n,i,r,o,a,s,l,d,c,u,h,f,g,v,w,y,b,x,k,_,C,E=this.width/e,S=this.height/t,A=0,T=e*t*this.components.length;m(T);var P=new Uint8Array(T);switch(this.components.length){case 1:for(n=this.components[0],u=0;u<t;u++)for(a=n.lines[0|u*n.scaleY*S],c=0;c<e;c++)h=a[0|c*n.scaleX*E],P[A++]=h;break;case 2:for(n=this.components[0],i=this.components[1],u=0;u<t;u++)for(a=n.lines[0|u*n.scaleY*S],s=i.lines[0|u*i.scaleY*S],c=0;c<e;c++)h=a[0|c*n.scaleX*E],P[A++]=h,h=s[0|c*i.scaleX*E],P[A++]=h;break;case 3:for(C=!0,this.adobe&&this.adobe.transformCode?C=!0:void 0!==this.opts.colorTransform&&(C=!!this.opts.colorTransform),n=this.components[0],i=this.components[1],r=this.components[2],u=0;u<t;u++)for(a=n.lines[0|u*n.scaleY*S],s=i.lines[0|u*i.scaleY*S],l=r.lines[0|u*r.scaleY*S],c=0;c<e;c++)C?(h=a[0|c*n.scaleX*E],f=s[0|c*i.scaleX*E],x=p(h+1.402*((g=l[0|c*r.scaleX*E])-128)),k=p(h-.3441363*(f-128)-.71413636*(g-128)),_=p(h+1.772*(f-128))):(x=a[0|c*n.scaleX*E],k=s[0|c*i.scaleX*E],_=l[0|c*r.scaleX*E]),P[A++]=x,P[A++]=k,P[A++]=_;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(C=!1,this.adobe&&this.adobe.transformCode?C=!0:void 0!==this.opts.colorTransform&&(C=!!this.opts.colorTransform),n=this.components[0],i=this.components[1],r=this.components[2],o=this.components[3],u=0;u<t;u++)for(a=n.lines[0|u*n.scaleY*S],s=i.lines[0|u*i.scaleY*S],l=r.lines[0|u*r.scaleY*S],d=o.lines[0|u*o.scaleY*S],c=0;c<e;c++)C?(h=a[0|c*n.scaleX*E],f=s[0|c*i.scaleX*E],g=l[0|c*r.scaleX*E],v=d[0|c*o.scaleX*E],w=255-p(h+1.402*(g-128)),y=255-p(h-.3441363*(f-128)-.71413636*(g-128)),b=255-p(h+1.772*(f-128))):(w=a[0|c*n.scaleX*E],y=s[0|c*i.scaleX*E],b=l[0|c*r.scaleX*E],v=d[0|c*o.scaleX*E]),P[A++]=255-w,P[A++]=255-y,P[A++]=255-b,P[A++]=255-v;break;default:throw new Error("Unsupported color mode")}return P},copyToImageData:function(e,t){var n,i,r,o,a,s,l,d,c,u=e.width,h=e.height,f=e.data,g=this.getData(u,h),m=0,v=0;switch(this.components.length){case 1:for(i=0;i<h;i++)for(n=0;n<u;n++)r=g[m++],f[v++]=r,f[v++]=r,f[v++]=r,t&&(f[v++]=255);break;case 3:for(i=0;i<h;i++)for(n=0;n<u;n++)l=g[m++],d=g[m++],c=g[m++],f[v++]=l,f[v++]=d,f[v++]=c,t&&(f[v++]=255);break;case 4:for(i=0;i<h;i++)for(n=0;n<u;n++)a=g[m++],s=g[m++],r=g[m++],l=255-p(a*(1-(o=g[m++])/255)+o),d=255-p(s*(1-o/255)+o),c=255-p(r*(1-o/255)+o),f[v++]=l,f[v++]=d,f[v++]=c,t&&(f[v++]=255);break;default:throw new Error("Unsupported color mode")}}};var f=0,g=0;function m(e=0){var t=f+e;if(t>g){var n=Math.ceil((t-g)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${n}MB`)}f=t}return d.resetMaxMemoryUsage=function(e){f=0,g=e},d.getBytesAllocated=function(){return f},d.requestMemoryAllocation=m,d}();e.exports=function(e,n={}){var i={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...n},r=new Uint8Array(e),o=new t;o.opts=i,t.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),o.parse(r);var a=i.formatAsRGBA?4:3,s=o.width*o.height*a;try{t.requestMemoryAllocation(s);var l={width:o.width,height:o.height,exifBuffer:o.exifBuffer,data:i.useTArray?new Uint8Array(s):Buffer.alloc(s)};o.comments.length>0&&(l.comments=o.comments)}catch(e){throw e instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+s):e}return o.copyToImageData(l,i.formatAsRGBA),l}}(Nr);var Ur,Dr={encode:Rr.exports,decode:Nr.exports};Ur=function(e){var t;return t=window.atob(e.slice(e.indexOf(",")+1)),new Uint8Array(new ArrayBuffer(t.length)).map((function(e,n){return t.charCodeAt(n)}))};var Vr,Fr,$r,jr,Wr,Hr,Yr,Xr,qr;qr=function(e,t){return function(n){var i,r;r=function(t){var o,a;return(a=new FileReader).onload=function(e){return n(e.target.result)},t.target.files.length>0&&(o=t.target.files[0],"image"===e||"any"===e&&o.type.startsWith("image/")?a.readAsDataURL(o):a.readAsText(o)),i.removeEventListener("change",r)},(i=t.find("#general-file-input")).addEventListener("change",r),i.click(),i.value=""}},Vr=function(e,t){var n,i;return n=function(){t.mouseDown=!1},i=function(t,...n){return e.findComponent("asyncDialog").fire(t,...n)},{getChoice:function(e,t){return function(r){n(),i("show-chooser",e,t,r)}},getText:function(e){return function(t){n(),i("show-text-input",e,t)}},getYesOrNo:function(e){return function(t){n(),i("show-yes-or-no",e,t)}},showMessage:function(e){return function(t){n(),i("show-message",e,t)}}}},Fr=function(e,t){var n;return n=function(){e.mouseDown=!1},{confirm:function(e){return n(),window.confirm(e)},input:function(e){return n(),window.prompt(e,"")},notify:function(e){return n(),t(e)},yesOrNo:function(e){return n(),window.confirm(e)}}},jr=function(e,t,n){return{exportFile:function(e){return function(t){window.saveAs(new Blob([e],{type:"text/plain:charset=utf-8"}),t)}},exportBlob:function(e){return function(t){return window.saveAs(e,t)}},getNlogo:function(){var t,i,r,o;if(({result:i,success:r}=n.exportNlogo({info:W(e.get("info")),code:e.get("code"),widgets:function(){var n,i;for(t in i=[],n=e.get("widgetObj"))o=n[t],i.push(o);return i}(),turtleShapes:turtleShapes,linkShapes:linkShapes})),r)return i;throw new Error("The current model could not be converted to 'nlogo' format")},getOutput:function(){var t,n;return null!=(t=null!=(n=e.findComponent("outputWidget"))?n.get("text"):void 0)?t:e.findComponent("console").get("output")},getViewBase64:function(){return t.view.visibleCanvas.toDataURL("image/png")},getViewBlob:function(e){return t.view.visibleCanvas.toBlob(e,"image/png")},importFile:function(t){return function(t){qr("any",e)(t)}},importModel:function(e,t){window.postMessage({nlogo:e,path:t,type:"nlw-load-model"},"*")}}},Wr=function(){return{inspect:function(e){return window.alert("Agent inspection is not yet implemented")},stopInspecting:function(e){},clearDead:function(){}}},$r=function(e){return{importFile:function(e){return function(e){console.warn("Unsupported operation: `importFile`")}},slurpFileDialogAsync:function(t){qr("any",e)(t)},slurpURL:function(e){var t,n,i,r,o;return(i=new XMLHttpRequest).open("GET",e,!1),i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(),r=i.response,(n=i.getResponseHeader("content-type")).startsWith("image/")?(t=function(e,t){return e+String.fromCharCode(255&r.charCodeAt(t))},o=function(){for(var e=[],t=0,n=r.length;0<=n?t<n:t>n;0<=n?t++:t--)e.push(t);return e}.apply(this).reduce(t,""),`data:${n};base64,${btoa(o)}`):r},slurpURLAsync:function(e){return function(t,n){var i;i=function(e){return n(["Extension exception: Could not fetch resource from the given URL. Make sure the URL is correct, that there are no network issues, and that CORS access is permitted. The exact error message is below.","",e.message])},fetch(e).then((function(e){var r;return e.ok?e.headers.get("content-type").startsWith("image/")?e.blob().then((function(e){var n;return(n=new FileReader).onload=function(e){return t(e.target.result)},n.readAsDataURL(e)})).catch(i):e.text().then(t).catch(i):("Extension exception: Server gave a failure response when trying to fetch URL.",r=`${e.status}: ${e.statusText}`,n(["Extension exception: Server gave a failure response when trying to fetch URL.","",r]))})).catch(i)}}}},Hr=function(e){return{peekIsDown:function(){return e.mouseDown},peekIsInside:function(){return e.mouseInside},peekX:e.mouseXcor,peekY:e.mouseYcor}},Yr=function(e,t){return{clear:function(){var t;if(null!=(t=e.findComponent("outputWidget")))return t.setText("")},write:function(n){var i;return null!=(i=e.findComponent("outputWidget"))?i.appendText(n):t(n)}}},Xr=function(e){return{resizeWorld:function(){Object.values(e.get("widgetObj")).filter((function({type:e,forever:t,running:n}){return"button"===e&&t&&n})).forEach((function(e){return e.running=!1}))}}};var Gr=function(e,t,n,i){var r,o,a,s;return a=function(t){return e.fire("nlw-notify",t)},s=function(t){return e.fire("nlw-extension-error",t)},r=function(t){return e.set("consoleOutput",e.get("consoleOutput")+t)},o=function(e){var t,n,i;return({array:t,height:n,width:i}=function(e){var t,n,i,r,o;n=Ur(e);try{try{if(r=Or.decode(n),(t=new Uint8ClampedArray(Or.toRGBA8(r)[0])).length===r.height*r.width*4)return{array:t,height:r.height,width:r.width,didSucceed:!0};throw new Error(`Converted PNG bytes have length ${t.length}, but valid PNG bytes would have length ${r.height*r.width*4}.`)}catch(e){if((i=e).includes("is not a PNG")){if(o=window.Buffer,window.Buffer=pn.Buffer,r=Dr.decode(n),window.Buffer=o,(t=new Uint8ClampedArray(r.data)).length===r.height*r.width*4)return{array:t,height:r.height,width:r.width,didSucceed:!0};throw new Error(`Converted JPEG bytes have length ${t.length}, but valid JPEG bytes would have length ${r.height*r.width*4}.`)}throw i}}catch(e){return{didSucceed:!1}}}(e)),new ImageData(t,i,n)},{asyncDialog:Vr(e,t),base64ToImageData:o,dialog:Fr(t,a),importExport:jr(e,t,i),inspection:Wr(),io:$r(e),mouse:Hr(t),output:Yr(e,r),print:{write:r},plotOps:{},reportErrors:s,world:Xr(e)}};const Zr={default:{rotate:!0,elements:[{xcors:[150,40,150,260],ycors:[5,250,205,250],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},airplane:{rotate:!0,elements:[{xcors:[150,135,120,120,15,15,120,135,105,120,150,180,210,165,180,285,285,180,180,165],ycors:[0,15,60,105,165,195,180,240,270,285,270,285,270,240,180,195,165,105,60,15],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},arrow:{rotate:!0,elements:[{xcors:[150,0,105,105,195,195,300],ycors:[0,150,150,293,293,150,150],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},box:{rotate:!1,elements:[{xcors:[150,285,285,150],ycors:[285,225,75,135],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[150,15,150,285],ycors:[135,75,15,75],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[15,15,150,150],ycors:[75,225,285,135],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x1:150,y1:285,x2:150,y2:135,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x1:150,y1:135,x2:15,y2:75,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x1:150,y1:135,x2:285,y2:75,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1}]},bug:{rotate:!0,elements:[{x:96,y:182,diam:108,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:110,y:127,diam:80,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:110,y:75,diam:80,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x1:150,y1:100,x2:80,y2:30,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:150,y1:100,x2:220,y2:30,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},butterfly:{rotate:!0,elements:[{xcors:[150,209,225,225,195,165,150],ycors:[165,199,225,255,270,255,240],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[150,89,75,75,105,135,150],ycors:[165,198,225,255,270,255,240],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[139,100,55,25,10,10,25,40,85,139],ycors:[148,105,90,90,105,135,180,195,194,163],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[162,200,245,275,290,290,275,260,215,162],ycors:[150,105,90,90,105,135,180,195,195,165],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[150,135,120,135,150,165,180,165],ycors:[255,225,150,120,105,120,150,225],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:135,y:90,diam:30,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x1:150,y1:105,x2:195,y2:60,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x1:150,y1:105,x2:105,y2:60,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1}]},car:{rotate:!1,elements:[{xcors:[300,279,261,240,226,213,203,185,159,135,75,0,0,0,300,300],ycors:[180,164,144,135,132,106,84,63,50,50,60,150,165,225,225,180],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:180,y:180,diam:90,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:30,y:180,diam:90,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[162,132,134,209,194,189,180],ycors:[80,78,135,135,105,96,89],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:47,y:195,diam:58,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:195,y:195,diam:58,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},circle:{rotate:!1,elements:[{x:0,y:0,diam:300,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},"circle 2":{rotate:!1,elements:[{x:0,y:0,diam:300,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:30,y:30,diam:240,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},cloud:{rotate:!1,elements:[{x:13,y:118,diam:94,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:86,y:101,diam:127,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:51,y:51,diam:108,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:118,y:43,diam:95,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:158,y:68,diam:134,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},"co2-molecule":{rotate:!0,elements:[{x:183,y:63,diam:84,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{x:183,y:63,diam:84,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x:75,y:75,diam:150,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:75,y:75,diam:150,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x:33,y:63,diam:84,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{x:33,y:63,diam:84,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1}]},cow:{rotate:!1,elements:[{xcors:[200,197,179,177,166,140,93,78,72,49,48,37,25,25,45,103,179,198,252,272,293,285,255,242,224],ycors:[193,249,249,196,187,189,191,179,211,209,181,149,120,89,72,84,75,76,64,81,103,121,121,118,167],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[73,86,62,48],ycors:[210,251,249,208],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[25,16,9,23,25,39],ycors:[114,195,204,213,200,123],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},cylinder:{rotate:!1,elements:[{x:0,y:0,diam:300,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},dot:{rotate:!1,elements:[{x:90,y:90,diam:120,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},"face happy":{rotate:!1,elements:[{x:8,y:8,diam:285,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:60,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:180,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[150,90,62,47,67,90,109,150,192,210,227,251,236,212],ycors:[255,239,213,191,179,203,218,225,218,203,181,194,217,240],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},"face neutral":{rotate:!1,elements:[{x:8,y:7,diam:285,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:60,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:180,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xmin:60,ymin:195,xmax:240,ymax:225,type:"rectangle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},"face sad":{rotate:!1,elements:[{x:8,y:8,diam:285,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:60,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:180,y:75,diam:60,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[150,90,62,47,67,90,109,150,192,210,227,251,236,212],ycors:[168,184,210,232,244,220,205,198,205,220,242,229,206,183],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},fish:{rotate:!1,elements:[{xcors:[44,21,15,0,15,0,13,20,45],ycors:[131,87,86,120,150,180,214,212,166],type:"polygon",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{xcors:[135,119,95,76,46,60],ycors:[195,235,218,210,204,165],type:"polygon",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{xcors:[75,83,71,86,166,135],ycors:[45,77,103,114,78,60],type:"polygon",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{xcors:[30,151,226,280,292,292,287,270,195,151,30],ycors:[136,77,81,119,146,160,170,195,210,212,166],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:215,y:106,diam:30,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},flag:{rotate:!1,elements:[{xmin:60,ymin:15,xmax:75,ymax:300,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[90,270,90],ycors:[150,90,30],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x1:75,y1:135,x2:90,y2:135,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:75,y1:45,x2:90,y2:45,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},flower:{rotate:!1,elements:[{xcors:[135,165,180,180,150,165,195,195,165],ycors:[120,165,210,240,300,300,240,195,135],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{x:85,y:132,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:130,y:147,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:192,y:85,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:85,y:40,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:177,y:40,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:177,y:132,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:70,y:85,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:130,y:25,diam:38,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:96,y:51,diam:108,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:113,y:68,diam:74,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[189,219,249,279,234],ycors:[233,188,173,188,218],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[180,150,105,75,135],ycors:[255,210,210,240,240],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1}]},house:{rotate:!1,elements:[{xmin:45,ymin:120,xmax:255,ymax:285,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xmin:120,ymin:210,xmax:180,ymax:285,type:"rectangle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[15,150,285],ycors:[120,15,120],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x1:30,y1:120,x2:270,y2:120,type:"line",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1}]},leaf:{rotate:!1,elements:[{xcors:[150,135,120,60,30,60,60,15,30,15,40,45,60,90,105,120,105,120,135,150,165,180,195,180,195,210,240,255,263,285,270,285,240,240,270,240,180,165],ycors:[210,195,210,210,195,180,165,135,120,105,104,90,90,105,120,120,60,60,30,15,30,60,60,120,120,105,90,90,104,105,120,135,165,180,195,210,210,195],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[135,135,120,105,105,135,165,165],ycors:[195,240,255,255,285,285,240,195],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},line:{rotate:!0,elements:[{x1:150,y1:0,x2:150,y2:300,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},"line half":{rotate:!0,elements:[{x1:150,y1:0,x2:150,y2:150,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},"molecule water":{rotate:!0,elements:[{x:183,y:63,diam:84,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{x:183,y:63,diam:84,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x:75,y:75,diam:150,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:75,y:75,diam:150,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1},{x:33,y:63,diam:84,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{x:33,y:63,diam:84,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!1,marked:!1}]},pentagon:{rotate:!1,elements:[{xcors:[150,15,60,240,285],ycors:[15,120,285,285,120],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},person:{rotate:!1,elements:[{x:110,y:5,diam:80,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[105,120,90,105,135,150,165,195,210,180,195],ycors:[90,195,285,300,300,225,300,300,285,195,90],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xmin:127,ymin:79,xmax:172,ymax:94,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[195,240,225,165],ycors:[90,150,180,105],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[105,60,75,135],ycors:[90,150,180,105],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},plant:{rotate:!1,elements:[{xmin:135,ymin:90,xmax:165,ymax:300,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[135,90,45,75,135],ycors:[255,210,195,255,285],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[165,210,255,225,165],ycors:[255,210,195,255,285],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[135,90,45,75,135],ycors:[180,135,120,180,210],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[165,165,225,255,210],ycors:[180,210,180,120,135],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[135,90,45,75,135],ycors:[105,60,45,105,135],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[165,165,225,255,210],ycors:[105,135,105,45,60],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[135,120,150,180,165],ycors:[90,45,15,45,90],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},ray:{rotate:!0,elements:[{x1:150,y1:0,x2:150,y2:315,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:120,y1:255,x2:150,y2:225,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:150,y1:225,x2:180,y2:255,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:120,y1:165,x2:150,y2:135,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:120,y1:75,x2:150,y2:45,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:150,y1:135,x2:180,y2:165,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:150,y1:45,x2:180,y2:75,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},sheep:{rotate:!1,elements:[{x:203,y:65,diam:88,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{x:70,y:65,diam:162,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{x:150,y:105,diam:120,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{xcors:[218,240,255,278],ycors:[120,165,165,120],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!1},{x:214,y:72,diam:67,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!1},{xmin:164,ymin:223,xmax:179,ymax:298,type:"rectangle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{xcors:[45,30,30,15,45],ycors:[285,285,240,195,210],type:"polygon",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{x:3,y:83,diam:150,type:"circle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{xmin:65,ymin:221,xmax:80,ymax:296,type:"rectangle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{xcors:[195,210,210,240,195],ycors:[285,285,240,210,210],type:"polygon",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!0},{xcors:[276,285,302,294],ycors:[85,105,99,83],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!1},{xcors:[219,210,193,201],ycors:[85,105,99,83],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!1}]},square:{rotate:!1,elements:[{xmin:30,ymin:30,xmax:270,ymax:270,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},"square 2":{rotate:!1,elements:[{xmin:30,ymin:30,xmax:270,ymax:270,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xmin:60,ymin:60,xmax:240,ymax:240,type:"rectangle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},star:{rotate:!1,elements:[{xcors:[151,185,298,207,242,151,59,94,3,116],ycors:[1,108,108,175,282,216,282,175,108,108],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},target:{rotate:!1,elements:[{x:0,y:0,diam:300,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:30,y:30,diam:240,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:60,y:60,diam:180,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:90,y:90,diam:120,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:120,y:120,diam:60,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},tree:{rotate:!1,elements:[{x:118,y:3,diam:94,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xmin:120,ymin:195,xmax:180,ymax:300,type:"rectangle",color:"rgba(157, 110, 72, 1.0)",filled:!0,marked:!1},{x:65,y:21,diam:108,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:116,y:41,diam:127,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:45,y:90,diam:120,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:104,y:74,diam:152,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},triangle:{rotate:!1,elements:[{xcors:[150,15,285],ycors:[30,255,255],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},"triangle 2":{rotate:!1,elements:[{xcors:[150,15,285],ycors:[30,255,255],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[151,225,75],ycors:[99,223,224],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1}]},truck:{rotate:!1,elements:[{xmin:4,ymin:45,xmax:195,ymax:187,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[296,296,259,244,208,207],ycors:[193,150,134,104,104,194],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xmin:195,ymin:60,xmax:195,ymax:105,type:"rectangle",color:"rgba(255, 255, 255, 1.0)",filled:!0,marked:!1},{xcors:[238,252,219,218],ycors:[112,141,141,112],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:234,y:174,diam:42,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xmin:181,ymin:185,xmax:214,ymax:194,type:"rectangle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:144,y:174,diam:42,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:24,y:174,diam:42,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x:24,y:174,diam:42,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x:144,y:174,diam:42,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x:234,y:174,diam:42,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},turtle:{rotate:!0,elements:[{xcors:[215,240,246,228,215,193],ycors:[204,233,254,266,252,210],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[195,225,245,260,269,261,240,225,210],ycors:[90,75,75,89,108,124,105,105,105],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[105,75,55,40,31,39,60,75,90],ycors:[90,75,75,89,108,124,105,105,105],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[132,134,107,108,150,192,192,169,172],ycors:[85,64,51,17,2,18,52,65,87],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[85,60,54,72,85,107],ycors:[204,233,254,266,252,210],type:"polygon",color:"rgba(89, 176, 60, 1.0)",filled:!0,marked:!1},{xcors:[119,179,209,224,220,175,128,81,74,88],ycors:[75,75,101,135,225,261,261,224,135,99],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},wheel:{rotate:!1,elements:[{x:3,y:3,diam:294,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x:30,y:30,diam:240,type:"circle",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{x1:150,y1:285,x2:150,y2:15,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:15,y1:150,x2:285,y2:150,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x:120,y:120,diam:60,type:"circle",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{x1:216,y1:40,x2:79,y2:269,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:40,y1:84,x2:269,y2:221,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:40,y1:216,x2:269,y2:79,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0},{x1:84,y1:40,x2:221,y2:269,type:"line",color:"rgba(141, 141, 141, 1.0)",filled:!1,marked:!0}]},wolf:{rotate:!1,elements:[{xcors:[253,245,245],ycors:[133,131,133],type:"polygon",color:"rgba(0, 0, 0, 1.0)",filled:!0,marked:!1},{xcors:[2,13,30,38,38,20,20,27,38,40,31,31,60,68,75,66,65,82,84,100,103,77,79,100,98,119,143,160,166,172,173,167,160,154,169,178,186,198,200,217,219,207,195,192,210,227,242,259,284,277,293,299,297,273,270],ycors:[194,197,191,193,205,226,257,265,266,260,253,230,206,198,209,228,243,261,268,267,261,239,231,207,196,201,202,195,210,213,238,251,248,265,264,247,240,260,271,271,262,258,230,198,184,164,144,145,151,141,140,134,127,119,105],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[-1,14,36,40,53,82,134,159,188,227,236,238,268,269,281,269,269],ycors:[195,180,166,153,140,131,133,126,115,108,102,98,86,92,87,103,113],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]},x:{rotate:!1,elements:[{xcors:[270,225,30,75],ycors:[75,30,225,270],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0},{xcors:[30,75,270,225],ycors:[75,30,225,270],type:"polygon",color:"rgba(141, 141, 141, 1.0)",filled:!0,marked:!0}]}};var Kr,Jr,Qr,eo,to,no,io;Kr=class{constructor(e,t){this.shapes=e,this.onePixel=t}setTransparency(e,t){return e.globalAlpha=t.length>3?t[3]/255:1}drawShape(e,t,n,i=1){e.translate(.5,-.5),e.scale(-1/300,1/300),this.setTransparency(e,t),e.save(),e.beginPath(),e.rect(0,0,300,300),e.clip(),this.drawRawShape(e,t,n,i),e.restore()}drawRawShape(e,t,n,i=1){var r,o,a,s;for(e.lineWidth=300*this.onePixel*i,o=0,a=(s=(this.shapes[n]||Jr).elements).length;o<a;o++)r=s[o],Qr[r.type](e,t,r)}},to=function(e,t,n){t=De(t),n.filled?n.marked?e.fillStyle=t:e.fillStyle=n.color:n.marked?e.strokeStyle=t:e.strokeStyle=n.color},eo=function(e,t,n){to(e,t,n),n.filled?e.fill():e.stroke()},Qr={circle:function(e,t,n){var i;i=n.diam/2,e.beginPath(),e.arc(n.x+i,n.y+i,i,0,2*Math.PI,!1),e.closePath(),eo(e,t,n)},polygon:function(e,t,n){var i,r,o,a,s,l,d,c;for(l=n.xcors,c=n.ycors,e.beginPath(),e.moveTo(l[0],c[0]),i=r=0,o=(a=l.slice(1)).length;r<o;i=++r)s=a[i],d=c[i+1],e.lineTo(s,d);e.closePath(),eo(e,t,n)},rectangle:function(e,t,n){var i,r,o,a;o=n.xmin,a=n.ymin,r=n.xmax-o,i=n.ymax-a,to(e,t,n),n.filled?e.fillRect(o,a,r,i):e.strokeRect(o,a,r,i)},line:function(e,t,n){n.x2,n.x1,n.y2,n.y1,to(e,t,n),e.beginPath(),e.moveTo(n.x1,n.y1),e.lineTo(n.x2,n.y2),e.stroke()}},Jr={rotate:!0,elements:[{type:"polygon",color:"grey",filled:"true",marked:"true",xcors:[150,40,150,260],ycors:[5,250,205,250]}]},no=class{constructor(e,t,n,i){this.x1=e,this.y1=t,this.x2=n,this.y2=i}midpoint(){return[(this.x1+this.x2)/2,(this.y1+this.y2)/2]}},io=class{constructor(e,t){var n,i,r,o;for(i in this.traceCurvedLine=this.traceCurvedLine.bind(this),this._drawLinkLine=this._drawLinkLine.bind(this),this.view=e,this.shapes=t,n={},r=this.shapes)o=r[i],n[i]=o["direction-indicator"];this.linkShapeDrawer=new Kr(n,this.view.onePixel)}traceCurvedLine(e,t,n,i,r,o,a){return a.moveTo(e,t),a.quadraticCurveTo(r,o,n,i)}shouldWrapInDim(e,t,n,i){var r;return r=Math.abs(n-i),e&&r>t/2}calculateShortestLineAngle(e,t,n,i){var r,o;return r=Math.min(e-n,n-e),o=Math.min(t-i,i-t),Math.atan2(o,r)}calculateComps(e,t,n,i,r){return[(i-t)/r,(e-n)/r]}calculateSublineOffset(e,t,n,i){var r;return[e*(r=t/this.view.onePixel)*n,e*r*i]}getOffsetSubline(e,t,n,i,r,o){return new no(e+r,t+o,n+r,i+o)}calculateControlPoint(e,t,n,i,r){return[e-n*i,t-n*r]}drawSubline({x1:e,y1:t,x2:n,y2:i},r,o,a,s,l,d,c){return c.save(),c.beginPath(),c.setLineDash(r.map((e=>e*this.view.onePixel))),c.strokeStyle=Ne(a),c.lineWidth=o,c.lineCap=s?"round":"square",this.traceCurvedLine(e,t,n,i,l,d,c),c.stroke(),c.setLineDash([1,0]),c.restore()}drawShape(e,t,n,i,r,o,a,s,l,d){var c,u,h,p,f,g,m,v,w,y;return d.save(),w=this.calculateShortestLineAngle(e,t,n,i),f=e-n>0?-1:1,g=t-i>0?-1:1,m=e+(p=20*this.view.onePixel)*Math.abs(Math.cos(w))*f,v=t+p*Math.abs(Math.sin(w))*g,h=Math.atan2(v-t,m-e)-Math.PI/2,d.translate(m,v),s["direction-indicator"].rotate?d.rotate(h):d.rotate(Math.PI),y=a/this.view.onePixel,a<=1?(u=1/this.view.onePixel/5,c=10*a):(u=y/2,c=.5),d.scale(u,u),this.linkShapeDrawer.drawShape(d,o,l,c),d.restore()}drawLabel(e,t,n,i){return this.view.drawLabel(e-3*this.view.onePixel,t+3*this.view.onePixel,n,i)}draw(e,t,n,i,r,o=this.view.ctx,a=!1){var s,l,d,c,u,h,p,f,g;if(!e["hidden?"])return({color:l,thickness:d}=e),({xcor:h,ycor:f}=t),({xcor:p,ycor:g}=n),this.calculateShortestLineAngle(h,f,p,g),s=d>this.view.onePixel?d:this.view.onePixel,c=this.shouldWrapInDim(i,this.view.worldWidth,h,p),u=this.shouldWrapInDim(r,this.view.worldHeight,f,g),this.getWrappedLines(h,f,p,g,c,u).forEach(this._drawLinkLine(e,s,o,a))}_drawLinkLine({color:e,size:t,heading:n,"directed?":i,shape:r,label:o,"label-color":a},s,l,d){return({x1:c,y1:u,x2:h,y2:p})=>{var f,g,m;return m=this.shapes[r],({curviness:f,lines:g}=m),g.forEach((v=>{var w,y,b,x,k,_,C,E,S,A,T,P,L,I,z;if(({"x-offset":w,"dash-pattern":x,"is-visible":T}=v),T&&([L,z]=this.calculateComps(c,u,h,p,t),[P,I]=this.calculateSublineOffset(w,s,L,z),A=this.getOffsetSubline(c,u,h,p,P,I),C=v===g[1],_=f>0,k=null!=o,[E,S]=A.midpoint(),[y,b]=this.calculateControlPoint(E,S,f,L,z),this.drawSubline(A,x,s,e,_,y,b,l),C&&(i&&t>.25*this.view.onePixel&&this.drawShape(h,p,y,b,n,e,s,m,r,l),k&&!d)))return this.drawLabel(y,b,o,a)}))}}getWrappedLines(e,t,n,i,r,o){var a,s;return s=this.view.worldWidth,a=this.view.worldHeight,r&&o?e<n?t<i?[new no(e,t,n-s,i-a),new no(e+s,t,n,i-a),new no(e+s,t+a,n,i),new no(e,t+a,n-s,i)]:[new no(e,t,n-s,i+a),new no(e+s,t,n,i+a),new no(e+s,t-a,n,i),new no(e,t-a,n-s,i)]:t<i?[new no(e,t,n+s,i-a),new no(e-s,t,n,i-a),new no(e-s,t+a,n,i),new no(e,t+a,n+s,i)]:[new no(e,t,n+s,i+a),new no(e-s,t,n,i+a),new no(e-s,t-a,n,i),new no(e,t-a,n+s,i)]:r?e<n?[new no(e,t,n-s,i),new no(e+s,t,n,i)]:[new no(e,t,n+s,i),new no(e-s,t,n,i)]:o?t<i?[new no(e,t,n,i-a),new no(e,t+a,n,i)]:[new no(e,t-a,n,i),new no(e,t,n,i+a)]:[new no(e,t,n,i)]}};var ro,oo,ao,so,lo,co,uo,ho,po=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};ro=tortoise_require("agentmodel"),ho=class{constructor(e,t){this.mouseXcor=this.mouseXcor.bind(this),this.mouseYcor=this.mouseYcor.bind(this),this.container=e,this.view=new uo(t),this.turtleDrawer=new co(this.view),this.drawingLayer=new ao(this.view,this.turtleDrawer,(()=>this.repaint())),this.patchDrawer=new so(this.view),this.spotlightDrawer=new lo(this.view),this.container.appendChild(this.view.visibleCanvas),this.mouseDown=!1,this.mouseInside=!1,this.mouseX=0,this.mouseY=0,this.initMouseTracking(),this.initTouchTracking(),this.model=new ro,this.model.world.turtleshapelist=Zr,this.repaint()}mouseXcor(){return this.view.xPixToPcor(this.mouseX)}mouseYcor(){return this.view.yPixToPcor(this.mouseY)}initMouseTracking(){return this.view.visibleCanvas.addEventListener("mousedown",(e=>this.mouseDown=!0)),document.addEventListener("mouseup",(e=>this.mouseDown=!1)),this.view.visibleCanvas.addEventListener("mouseenter",(e=>this.mouseInside=!0)),this.view.visibleCanvas.addEventListener("mouseleave",(e=>this.mouseInside=!1)),this.view.visibleCanvas.addEventListener("mousemove",(e=>{var t;return t=this.view.visibleCanvas.getBoundingClientRect(),this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top}))}initTouchTracking(){var e,t;e=e=>{this.mouseDown=!1,this.mouseInside=!1},t=({clientX:e,clientY:t})=>{var n,i,r,o;({bottom:n,left:i,top:o,right:r}=this.view.visibleCanvas.getBoundingClientRect()),i<=e&&e<=r&&o<=t&&t<=n?(this.mouseInside=!0,this.mouseX=e-i,this.mouseY=t-o):this.mouseInside=!1},document.addEventListener("touchend",e),document.addEventListener("touchcancel",e),this.view.visibleCanvas.addEventListener("touchmove",(e=>{e.preventDefault(),t(e.changedTouches[0])})),this.view.visibleCanvas.addEventListener("touchstart",(e=>{this.mouseDown=!0,t(e.touches[0])}))}repaint(){return this.view.transformToWorld(this.model.world),this.patchDrawer.repaint(this.model),this.drawingLayer.repaint(this.model),this.turtleDrawer.repaint(this.model),this.spotlightDrawer.repaint(this.model),this.view.repaint(this.model)}applyUpdate(e){var t,n,i,r;for(t=0,n=(r=Array.isArray(e)?e:[e]).length;t<n;t++)i=r[t],this.model.update(i)}update(e){this.applyUpdate(e),this.repaint()}},uo=function(){class e{constructor(e){this.usePatchCoordinates=this.usePatchCoordinates.bind(this),this.fontSize=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.visibleCanvas=document.createElement("canvas"),this.visibleCanvas.classList.add("netlogo-canvas","unselectable"),this.visibleCanvas.width=500,this.visibleCanvas.height=500,this.visibleCanvas.style.width="100%",this.visibleCtx=this.visibleCanvas.getContext("2d"),this._zoomLevel=null}transformToWorld(e){return this.transformCanvasToWorld(e,this.canvas,this.ctx)}transformCanvasToWorld(e,t,n){var i;return this.quality=Math.max(null!=(i=window.devicePixelRatio)?i:2,2),this.maxpxcor=null!=e.maxpxcor?e.maxpxcor:25,this.minpxcor=null!=e.minpxcor?e.minpxcor:-25,this.maxpycor=null!=e.maxpycor?e.maxpycor:25,this.minpycor=null!=e.minpycor?e.minpycor:-25,this.patchsize=null!=e.patchsize?e.patchsize:9,this.wrapX=e.wrappingallowedinx,this.wrapY=e.wrappingallowediny,this.onePixel=1/this.patchsize,this.worldWidth=this.maxpxcor-this.minpxcor+1,this.worldHeight=this.maxpycor-this.minpycor+1,this.worldCenterX=(this.maxpxcor+this.minpxcor)/2,this.worldCenterY=(this.maxpycor+this.minpycor)/2,this.centerX=this.worldWidth/2,this.centerY=this.worldHeight/2,t.width=this.worldWidth*this.patchsize*this.quality,t.height=this.worldHeight*this.patchsize*this.quality,t.style.width=this.worldWidth*this.patchsize+"px",t.style.height=this.worldHeight*this.patchsize+"px",n.font=this.fontSize+'px "Lucida Grande", sans-serif',n.imageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1,n.oImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1}usePatchCoordinates(e=this.ctx){return t=>{var n,i;return e.save(),i=this.canvas.width,n=this.canvas.height,e.setTransform(i/this.worldWidth,0,0,-n/this.worldHeight,-(this.minpxcor-.5)*i/this.worldWidth,(this.maxpycor+.5)*n/this.worldHeight),t(),e.restore()}}withCompositing(e,t=this.ctx){return function(n){var i;return i=t.globalCompositeOperation,t.globalCompositeOperation=e,n(),t.globalCompositeOperation=i}}offsetX(){return this.worldCenterX-this.centerX}offsetY(){return this.worldCenterY-this.centerY}xPixToPcor(e){return(this.worldWidth*e/this.visibleCanvas.clientWidth+this.worldWidth-this.offsetX())%this.worldWidth+this.minpxcor-.5}yPixToPcor(e){return(-this.worldHeight*e/this.visibleCanvas.clientHeight+2*this.worldHeight-this.offsetY())%this.worldHeight+this.minpycor-.5}xPcorToCanvas(e){return(e-this.minpxcor+.5)/this.worldWidth*this.visibleCanvas.width}yPcorToCanvas(e){return(this.maxpycor+.5-e)/this.worldHeight*this.visibleCanvas.height}drawLabel(e,t,n,i,r){if(null==r&&(r=this.ctx),(n=null!=n?n.toString():"").length>0)return this.drawWrapped(e,t,n.length*this.fontSize/this.onePixel,((e,t)=>(r.save(),r.translate(e,t),r.scale(this.onePixel,-this.onePixel),r.textAlign="end",r.fillStyle=Ne(i),r.fillText(n,0,0),r.restore())))}drawWrapped(e,t,n,i){var r,o,a,s,l,d,c,u;for(d=this.wrapX?[e-this.worldWidth,e,e+this.worldWidth]:[e],u=this.wrapY?[t-this.worldHeight,t,t+this.worldHeight]:[t],r=0,a=d.length;r<a;r++)if((l=d[r])+n/2>this.minpxcor-.5&&l-n/2<this.maxpxcor+.5)for(o=0,s=u.length;o<s;o++)(c=u[o])+n/2>this.minpycor-.5&&c-n/2<this.maxpycor+.5&&i(l,c)}watch(e){var t,n,i,r,o,a;if(({observer:i,turtles:o,links:n,patches:r}=e),!(0!==e.observer.perspective&&i.targetagent&&i.targetagent[1]>=0))return null;switch([a,t]=i.targetagent,a){case this.turtleType:return e.turtles[t];case this.patchType:return e.patches[t];case this.linkType:return e.links[t]}}follow(e){var t;return 2===(t=e.observer.perspective)||1===t?this.watch(e):null}setZoom(e){this._zoomLevel=Number.isInteger(e)?Math.min(Math.max(0,e),Math.floor(this.worldWidth/2),Math.floor(this.worldHeight/2)):null}repaint(e){var t,n,i,r,o,a,s,l,d,c,u,h,p;if(l=this.follow(e),this.visibleCanvas.width=this.canvas.width,this.visibleCanvas.height=this.canvas.height,this.visibleCanvas.style.width=this.canvas.style.width,this.visibleCanvas.style.height=this.canvas.style.height,null!=l)for(d=this.visibleCanvas.width,i=this.visibleCanvas.height,this.centerX=l.xcor,this.centerY=l.ycor,c=-this.xPcorToCanvas(this.centerX)+d/2,h=-this.yPcorToCanvas(this.centerY)+i/2,u=this.wrapX?[c-d,c,c+d]:[c],p=this.wrapY?[h-i,h,h+i]:[h],r=0,a=u.length;r<a;r++)for(t=u[r],o=0,s=p.length;o<s;o++)n=p[o],this.visibleCtx.drawImage(this.canvas,t,n);else this.centerX=this.worldCenterX,this.centerY=this.worldCenterY,this.visibleCtx.drawImage(this.canvas,0,0);this._handleZoom()}_handleZoom(){var e,t,n,i;null!==this._zoomLevel&&(t=(2*this._zoomLevel+1)*(2*this.patchsize),e=this.visibleCanvas.width/2-t/2,i=this.visibleCanvas.height/2-t/2,(n=document.createElement("canvas")).width=this.visibleCanvas.width,n.height=this.visibleCanvas.height,n.getContext("2d").drawImage(this.visibleCanvas,0,0),this.visibleCtx.save(),this.visibleCtx.setTransform(1,0,0,1,0,0),this.visibleCtx.clearRect(0,0,this.visibleCanvas.width,this.visibleCanvas.height),this.visibleCtx.drawImage(n,e,i,t,t,0,0,this.visibleCanvas.width,this.visibleCanvas.height),this.visibleCtx.restore())}}return e.prototype.turtleType=1,e.prototype.patchType=2,e.prototype.linkType=3,e}.call(this),oo=class{constructor(e){this.view=e}},ao=class e extends oo{constructor(e,t,n){super(),this.importDrawing=this.importDrawing.bind(this),this.drawLine=this.drawLine.bind(this),this.view=e,this.turtleDrawer=t,this.repaintView=n,this.canvas=document.createElement("canvas"),this.canvas.id="dlayer",this.ctx=this.canvas.getContext("2d")}resizeCanvas(){return this.canvas.width=this.view.canvas.width,this.canvas.height=this.view.canvas.height}clearDrawing(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}importDrawing(t){var n;po(this,e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),(n=new Image).onload=()=>{var e,t,i,r;e=this.canvas.width/this.canvas.height,i=n.width/n.height,r=this.canvas.width,t=this.canvas.height,e>=i?r=i/e*this.canvas.width:t=e/i*this.canvas.height,this.ctx.drawImage(n,(this.canvas.width-r)/2,(this.canvas.height-t)/2,r,t),this.repaintView()},n.src=t}_rgbToCss([e,t,n]){return`rgb(${e}, ${t}, ${n})`}makeMockTurtleObject({x:e,y:t,shapeName:n,size:i,heading:r,color:o}){return{xcor:e,ycor:t,shape:n,size:i,heading:r,color:o}}makeMockLinkObject({x1:e,y1:t,x2:n,y2:i,shapeName:r,color:o,heading:a,size:s,"directed?":l,"hidden?":d,midpointX:c,midpointY:u,thickness:h}){return[{shape:r,color:o,heading:a,size:s,"directed?":l,"hidden?":d,midpointX:c,midpointY:u,thickness:h},{xcor:e,ycor:t},{xcor:n,ycor:i}]}stampTurtle(e){var t;return t=this.makeMockTurtleObject(e),this.view.usePatchCoordinates(this.ctx)((()=>this.view.withCompositing(this.compositingOperation(e.stampMode),this.ctx)((()=>this.turtleDrawer.drawTurtle(t,this.ctx,!0)))))}stampLink(e){var t;return t=this.makeMockLinkObject(e),this.view.usePatchCoordinates(this.ctx)((()=>this.view.withCompositing(this.compositingOperation(e.stampMode),this.ctx)((()=>this.turtleDrawer.linkDrawer.draw(...t,this.wrapX,this.wrapY,this.ctx,!0)))))}compositingOperation(e){return"erase"===e?"destination-out":"source-over"}drawStamp({agentType:e,stamp:t}){return"turtle"===e?this.stampTurtle(t):"link"===e?this.stampLink(t):void 0}drawLine({rgb:t,size:n,penMode:i,fromX:r,fromY:o,toX:a,toY:s}){var l;if(po(this,e),"up"!==i)return l=t,this.view.usePatchCoordinates(this.ctx)((()=>(this.ctx.save(),this.ctx.strokeStyle=this._rgbToCss(l),this.ctx.lineWidth=n*this.view.onePixel,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(r,o),this.ctx.lineTo(a,s),this.view.withCompositing(this.compositingOperation(i),this.ctx)((()=>this.ctx.stroke())),this.ctx.restore())))}draw(){return this.events.forEach((e=>{switch(e.type){case"clear-drawing":return this.clearDrawing();case"line":return this.drawLine(e);case"stamp-image":return this.drawStamp(e);case"import-drawing":return this.importDrawing(e.imageBase64)}}))}repaint(e){var t;return t=e.world,this.wrapX=t.wrappingallowedinx,this.wrapY=t.wrappingallowediny,this.events=e.drawingEvents,e.drawingEvents=[],this.canvas.width===this.view.canvas.width&&this.canvas.height===this.view.canvas.height||this.resizeCanvas(),this.draw(),this.view.ctx.drawImage(this.canvas,0,0)}},lo=function(){class e extends oo{constructor(e){super(),this.view=e}outer(){return 10/this.view.patchsize}middle(){return 8/this.view.patchsize}inner(){return 4/this.view.patchsize}drawCircle(e,t,n,i,r){var o;return(o=this.view.ctx).fillStyle=r,o.beginPath(),o.arc(e,t,i/2,0,2*Math.PI),o.arc(e,t,n/2,0,2*Math.PI,!0),o.fill()}drawSpotlight(e,t,n,i){var r;return(r=this.view.ctx).lineWidth=this.view.onePixel,r.beginPath(),i&&(this.view.drawWrapped(e,t,n+this.outer(),((e,t)=>(r.moveTo(e,t),r.arc(e,t,(n+this.outer())/2,0,2*Math.PI,!0)))),r.rect(this.view.minpxcor-.5,this.view.minpycor-.5,this.view.worldWidth,this.view.worldHeight),r.fillStyle=this.dimmed,r.fill()),this.view.drawWrapped(e,t,n+this.outer(),((e,t)=>(this.drawCircle(e,t,n,n+this.outer(),this.dimmed),this.drawCircle(e,t,n,n+this.middle(),this.spotlightOuterBorder),this.drawCircle(e,t,n,n+this.inner(),this.spotlightInnerBorder))))}adjustSize(e){return Math.max(e,this.view.worldWidth/16,this.view.worldHeight/16)}dimensions(e){return null!=e.xcor?[e.xcor,e.ycor,2*e.size]:null!=e.pxcor?[e.pxcor,e.pycor,2]:[e.midpointx,e.midpointy,e.size]}repaint(e){return this.view.usePatchCoordinates()((()=>{var t,n,i,r;if(null!=(n=this.view.watch(e)))return[i,r,t]=this.dimensions(n),this.drawSpotlight(i,r,this.adjustSize(t),3===e.observer.perspective)}))}}return e.prototype.dimmed=`rgba(0, 0, 50, ${100/255})`,e.prototype.spotlightInnerBorder=`rgba(200, 255, 255, ${100/255})`,e.prototype.spotlightOuterBorder=`rgba(200, 255, 255, ${50/255})`,e.prototype.clear="white",e}.call(this),co=class extends oo{constructor(e){super(),this.view=e,this.turtleShapeDrawer=new Kr({},this.view.onePixel),this.linkDrawer=new io(this.view,{})}drawTurtle(e,t=this.view.ctx,n=!1){var i,r,o;if(!e["hidden?"]&&(r=e.xcor,o=e.ycor,i=e.size,this.view.drawWrapped(r,o,i,((n,i)=>this.drawTurtleAt(e,n,i,t))),!n))return this.view.drawLabel(r+e.size/2,o-e.size/2,e.label,e["label-color"],t)}drawTurtleAt(e,t,n,i){var r,o,a,s,l;return o=e.heading,a=e.size,r=(180-o)/360*2*Math.PI,l=e.shape,s=this.turtleShapeDrawer.shapes[l]||Jr,i.save(),i.translate(t,n),s.rotate?i.rotate(r):i.rotate(Math.PI),i.scale(a,a),this.turtleShapeDrawer.drawShape(i,e.color,l,1/a),i.restore()}drawLink(e,t,n,i,r){return this.linkDrawer.draw(e,t,n,i,r)}repaint(e){var t,n,i,r,o,a;return a=e.world,o=e.turtles,t=e.links,r=null!=a.turtleshapelist&&a.turtleshapelist!==this.turtleShapeDrawer.shapes,n=this.turtleShapeDrawer.onePixel!==this.view.onePixel,(r||n)&&(this.turtleShapeDrawer=new Kr(null!=(i=a.turtleshapelist)?i:this.turtleShapeDrawer.shapes,this.view.onePixel)),a.linkshapelist!==this.linkDrawer.shapes&&null!=a.linkshapelist&&(this.linkDrawer=new io(this.view,a.linkshapelist)),this.view.usePatchCoordinates()((()=>{this.drawAgents(t,null!=a.linkbreeds?a.linkbreeds:["LINKS"],(e=>this.drawLink(e,o[e.end1],o[e.end2],a.wrappingallowedinx,a.wrappingallowediny))),this.view.ctx.lineWidth=this.onePixel,this.drawAgents(o,null!=a.turtlebreeds?a.turtlebreeds:["TURTLES"],(e=>this.drawTurtle(e)))}))}drawAgents(e,t,n){var i,r,o,a,s,l,d,c;for(i in a={},e)r=e[i],d=[],null==a[o=r.breed.toUpperCase()]?a[o]=d:d=a[o],d.push(r);for(c=[],s=0,l=t.length;s<l;s++)null!=a[o=t[s]]?(d=a[o],c.push(function(){var e,t,i;for(i=[],e=0,t=d.length;e<t;e++)r=d[e],i.push(n(r));return i}())):c.push(void 0);return c}},so=class{constructor(e){this.view=e,this.scratchCanvas=document.createElement("canvas"),this.scratchCtx=this.scratchCanvas.getContext("2d")}colorPatches(e){var t,n,i,r,o,a,s,l,d,c,u,h,p,f,g;for(g=this.view.worldWidth,i=this.view.worldHeight,c=this.view.minpxcor,l=this.view.maxpxcor,u=this.view.minpycor,d=this.view.maxpycor,this.scratchCanvas.width=g,this.scratchCanvas.height=i,o=this.scratchCtx.createImageData(g,i),r=s=0,f=4*((d-u)*g+(l-c));0<=f?s<f:s>f;r=0<=f?++s:--s)null!=(h=e[r])&&(a=4*r,[p,n,t]=Ve(h.pcolor),o.data[a+0]=p,o.data[a+1]=n,o.data[a+2]=t,o.data[a+3]=255);return this.scratchCtx.putImageData(o,0,0),this.view.ctx.drawImage(this.scratchCanvas,0,0,this.view.canvas.width,this.view.canvas.height)}labelPatches(e){return this.view.usePatchCoordinates()((()=>{var t,n,i;for(t in i=[],e)n=e[t],i.push(this.view.drawLabel(n.pxcor+.5,n.pycor-.5,n.plabel,n["plabel-color"]));return i}))}clearPatches(){return this.view.ctx.fillStyle="black",this.view.ctx.fillRect(0,0,this.view.canvas.width,this.view.canvas.height)}repaint(e){var t,n;if(n=e.world,t=e.patches,n.patchesallblack?this.clearPatches():this.colorPatches(t),n.patcheswithlabels)return this.labelPatches(t)}};var fo,go,mo,vo=ho;mo=function(e,t,n,i,r,o,a){var s,l,d,c,u,h,p,f;return l="string"==typeof e?document.querySelector(e):e,d=null,h=function(){return d.redraw(),d.updateWidgets()},u=function(e,t,n){return d.reportError(e,t,n)},c=ln(l,t,n,i,r,o,(function(e){return a.isReporter(e)})),l.querySelector(".netlogo-model").focus({preventScroll:!0}),f=t.find((function({type:e}){return"view"===e})),c.set("primaryView",f),p=new vo(l.querySelector(".netlogo-view-container"),f.fontSize),go(f,p.model.world),fo([[f,"fontSize"],[p.view,"fontSize"]],f.fontSize),s=Gr(c,p,l,a),d=new We(c,p,s),de(u,t,h,d.plotSetupHelper()),hn(d),dn(c),cn(c),d},fo=function(e,t){var n,i,r,o,a;for(n=t,i=0,o=e.length;i<o;i++)[a,r]=e[i],Object.defineProperty(a,r,{get:function(){return n},set:function(e){return n=e}})},go=function(e,t){var n,i,r;for(r in i={maxPxcor:"maxpxcor",maxPycor:"maxpycor",minPxcor:"minpxcor",minPycor:"minpycor",patchSize:"patchsize",wrappingAllowedInX:"wrappingallowedinx",wrappingAllowedInY:"wrappingallowediny"})n=i[r],fo([[e.dimensions,r],[t,n]],e.dimensions[r])};var wo,yo,bo,xo=mo,ko=[].splice;yo=null!=(bo="undefined"!=typeof performance&&null!==performance?performance.now.bind(performance):void 0)?bo:Date.now.bind(Date),wo=eval;var _o,Co,Eo,So,Ao,To,Po,Lo,Io,zo,Bo,Mo=function(){class e{constructor(e,t,n,i,r,o,a,s,l,d,c){var u;this.eventLoop=this.eventLoop.bind(this),this.promptFilename=this.promptFilename.bind(this),this.tortoise=e,this.compiler=n,this.rewriters=i,this._eventLoopTimeout=-1,this._lastRedraw=0,this._lastUpdate=0,this.drawEveryFrame=!1,this.widgetController=xo(t,r,o,a,s,l,this.compiler),this.widgetController.ractive.on("*.recompile",((e,t,n)=>this.recompile(t,n))),this.widgetController.ractive.on("*.recompile-for-plot",((e,t,n,i)=>this.recompile((function(){}),!0,t,n,i))),this.widgetController.ractive.on("export-nlogo",((e,t)=>this.exportNlogo(t))),this.widgetController.ractive.on("export-html",((e,t)=>this.exportHtml(t))),this.widgetController.ractive.on("open-new-file",((e,t)=>this.openNewFile())),this.widgetController.ractive.on("*.run",((e,t,n)=>this.run(t,n))),this.widgetController.ractive.on("*.set-global",((e,t,n)=>this.setGlobal(t,n))),this.widgetController.ractive.on("*.recompile-procedures",((e,t,n,i)=>this.recompileProcedures(t,n,i))),this.widgetController.ractive.set("lastCompileFailed",c),window.modelConfig=Object.assign(null!=(u=window.modelConfig)?u:{},this.widgetController.configs),window.modelConfig.version="2.10.1",wo(d)}modelTitle(){return this.widgetController.ractive.get("modelTitle")}startLoop(){return ProcedurePrims.hasCommand("startup")&&ee("startup",this.widgetController.reportError,(function(){return ProcedurePrims.callCommand("startup")})),this.widgetController.redraw(),this.widgetController.updateWidgets(),requestAnimationFrame(this.eventLoop)}updateDelay(){var e,t,n,i;return i=this.widgetController.widgets().filter((function({type:e}){return"view"===e}))[0],t=this.widgetController.speed(),e=1e3/i.frameRate,t>0?e*(1-(n=Math.pow(Math.abs(t),.5))):1e3*(n=Math.pow(Math.abs(t),4))+e*(1-n)}redrawDelay(){var e;return this.widgetController.speed()>0?1e3*(e=Math.pow(Math.abs(this.widgetController.speed()),2))+33.333333333333336*(1-e):33.333333333333336}eventLoop(e){var t,n,i,r,o;if(this._eventLoopTimeout=requestAnimationFrame(this.eventLoop),o=Math.min(this._lastRedraw+this.redrawDelay(),yo()+100),i=this.drawEveryFrame?1:(yo()-this._lastUpdate)/this.updateDelay(),!this.widgetController.ractive.get("isEditing"))for(t=n=1,r=i;n<=r&&(this._lastUpdate=yo(),this.widgetController.runForevers(),!(yo()>=o));t=n+=1);return Updater.hasUpdates()&&(t>i||yo()-this._lastRedraw>this.redrawDelay()||this.drawEveryFrame)&&(this._lastRedraw=yo(),this.widgetController.redraw()),this.widgetController.updateWidgets()}teardown(){return this.widgetController.teardown(),cancelAnimationFrame(this._eventLoopTimeout)}rewriteCode(e){var t;return t=function(e,t){return null!=t.injectCode?t.injectCode(e):e},this.rewriters.reduce(t,e)}rewriteExport(e){var t;return t=function(e,t){return null!=t.exportCode?t.exportCode(e):e},this.rewriters.reduce(t,e)}rewriterCommands(){var e;return e=function(e,t){return null!=t.getExtraCommands?e.concat(t.getExtraCommands()):e},this.rewriters.reduce(e,[])}rewriteErrors(e,t,n){var i;return n=n.map((e=>(e.lineNumber=t.slice(0,e.start).split("\n").length,e))),i=function(n,i){return null!=i.updateErrors?i.updateErrors(e,t,n):n},this.rewriters.reduce(i,n)}cloneWidgets(e){var t;return t=["currentValue"],e.map((function(e){var n;return n={},Object.keys(e).filter((function(e){return!t.includes(e)})).forEach((function(t){return n[t]=e[t]})),n}))}recompile(e=function(){},t=!0,n="",i="",r={}){var o,a,s,l,d,c;o=this.widgetController.code(),l=this.widgetController.widgets(),c=this.rewriteCode(o),s=this.rewriterCommands(),a={code:c,widgets:this.cloneWidgets(l),commands:s,reporters:[],turtleShapes:"undefined"!=typeof turtleShapes&&null!==turtleShapes?turtleShapes:[],linkShapes:"undefined"!=typeof linkShapes&&null!==linkShapes?linkShapes:[]},d=()=>{var t,s,d,u,h,p,f;try{(p=this.compiler.fromModel(a)).model.success?(f=world.exportState(),t=Object.values(world.breedManager.breeds()).map((function(e){return[e.name,e.getShape()]})),this.widgetController.redraw(),n!==i&&((h=this.widgetController.configs.plotOps)[n].dispose(),delete h[n]),this.widgetController.ractive.set("isStale",!1),this.widgetController.ractive.set("lastCompiledCode",o),this.widgetController.ractive.set("lastCompileFailed",!1),this.widgetController.redraw(),this.widgetController.freshenUpWidgets(l,wo(p.widgets)),wo(p.model.result),t.forEach((function([e,t]){return world.breedManager.get(e).setShape(t)})),u=plotManager.getPlots(),f.plotManager=G(f.plotManager,u,r,n,i),world.importState(f),e(),p.commands.forEach((function(e){if(e.success)return new Function(e.result)()})),this.rewriters.forEach((function(e){return"function"==typeof e.compileComplete?e.compileComplete():void 0}))):(this.widgetController.ractive.set("lastCompileFailed",!0),s=this.rewriteErrors(o,c,p.model.result),this.widgetController.reportError("compiler","recompile",s))}catch(e){d=e,this.widgetController.reportError("compiler","recompile",[d.toString()])}finally{this.tortoise.finishLoading()}},t?this.tortoise.startLoading(d):d()}recompileProcedures(e,t,n){var i,r;try{(r=this.compiler.compileProceduresIncremental(e,t)).success?(wo(r.result),n()):this.widgetController.reportError("compiler","recompile-procedures",r.result)}catch(e){i=e,this.widgetController.reportError("compiler","recompile-procedures",[i.toString()])}finally{this.tortoise.finishLoading()}}getNlogo(){return this.compiler.exportNlogo({info:W(this.widgetController.ractive.get("info")),code:this.rewriteExport(this.widgetController.code()),widgets:this.widgetController.widgets(),turtleShapes:turtleShapes,linkShapes:linkShapes})}exportNlogo(){var e,t,n;if(null!=(t=this.promptFilename(".nlogo")))return(n=this.getNlogo()).success?(e=new Blob([n.result],{type:"text/plain:charset=utf-8"}),saveAs(e,t)):this.widgetController.reportError("compiler","export-nlogo",n.result)}promptFilename(e){var t;return t=this.modelTitle()+e,window.prompt("Filename:",t)}exportHtml(){var e,t;if(null!=(e=this.promptFilename(".html")))return(t=new XMLHttpRequest).open("GET",window.standaloneURL),t.onreadystatechange=()=>{var n,i,r,o,a;if(t.readyState===t.DONE)return 200===t.status?(r=this.getNlogo()).success?((o=(n=(new DOMParser).parseFromString(t.responseText,"text/html")).querySelector("#nlogo-code")).textContent=r.result,o.dataset.filename=e.replace(/\.html$/,".nlogo"),(a=document.createElement("div")).appendChild(n.documentElement),i=new Blob([a.innerHTML],{type:"text/html:charset=utf-8"}),saveAs(i,e)):this.widgetController.reportError("compiler","export-html",r.result):alert("Couldn't get standalone page")},t.send("")}openNewFile(){confirm("Are you sure you want to open a new model?  You will lose any changes that you have not exported.")&&(parent.postMessage({hash:"NewModel",type:"nlw-set-hash"},"*"),window.postMessage({type:"nlw-open-new"},"*"))}asyncRunBabyBehaviorSpace(e,t){return this.tortoise.startLoading((()=>(t(this.runBabyBehaviorSpace(e)),this.tortoise.finishLoading())))}runBabyBehaviorSpace({experimentName:e,parameterSet:t,repetitionsPerCombo:n,metrics:i,setupCode:r,goCode:o,stopConditionCode:a,iterationLimit:s}){var l,d,c,u,h,p,f,g,m,v,w,y,b,x,k,_,C,E;return({last:c,map:u,toObject:_,zip:E}=tortoise_require("brazier/array")),({pipeline:m}=tortoise_require("brazier/function")),y=this.rewriteCode(this.widgetController.code()),g=this.cloneWidgets(this.widgetController.widgets()),w=this.compiler.fromModel({code:y,widgets:g,commands:[r,o],reporters:i.map((function(e){return e.reporter})).concat([a]),turtleShapes:[],linkShapes:[]}),C=function(e,t){return function({result:n,success:i}){return new Function(`${e}${i?n:t}`)}},[x,d]=w.commands.map(C("","")),v=w.reporters.map(C("return ","-1")),[...p]=v,ko.call(p,-1),k=C("return ","false")(c(w.reporters)),l=function([{reporter:e,interval:t},n]){return[e,{reporter:n,interval:t}]},h={experimentName:e,parameterSet:t,repetitionsPerCombo:n,metrics:m(E(i),u(l),_)(p),setup:x,go:d,stopCondition:k,iterationLimit:s},b=world.observer.setGlobal.bind(world.observer),D(h,b,f=function(e){var t;return Array.isArray(e)?e.map(f):"boolean"==(t=typeof e)||"number"===t||"string"===t?e:workspace.dump(e)})}setGlobal(e,t){world.observer.setGlobal(e,t)}run(e,t){var n,i,r,o;i=this.compiler.compileCommand(t),({result:r,success:o}=i),o?(n=new Function(r),ee(e,this.widgetController.reportError,n)):this.widgetController.reportError("compiler",e,r)}runReporter(e){var t,n,i,r;if(n=this.compiler.compileReporter(e),({result:i,success:r}=n),!r)return{success:!1,error:`Reporter compile error: ${i}`};t=new Function(`return ( ${i} );`);try{return{success:!0,value:t()}}catch(e){return{success:!1,error:`Runtime error: ${e.toString()}`}}}}return e.prototype.widgetController=void 0,e}.call(this);Io=function(e,t,n,i,r,o,a){var s,l,d,c,u;return({code:s,info:l,model:{result:d},widgets:u}=i),c=Lo(u),l=H(l),new Mo(_o,e,t,n,c,s,l,r,o,d,a)},zo=function(e,t,n,i,r,o,a){return n=null!=n?n:F(t),Io(e,i,r,o,!1,n,a)},Ao=function(e,t,n,i,r=[]){var o,a;o=(a=n.split(/\/|\\/))[a.length-1],Co(t,n,o,e,i,r)},So=function(e,t,n,i,r=[]){Bo((function(){return Ao(e,t,n,i,r),Eo()}))},Po=function(e,t,n,i,r=[]){Bo((function(){var o;(o=new XMLHttpRequest).open("GET",e),o.onreadystatechange=function(){var a;o.readyState===o.DONE&&(0===o.status||o.status>=400?i({type:"failure",source:"load-from-url",errors:[e]}):(a=o.responseText,Co(n,e,t,a,i,r)),Eo())},o.send("")}))},Co=function(e,t,n,i,r,o){var a,s,l,d,c,u,h;a=new BrowserCompiler,c=function(e,t){return null!=t.injectNlogo?t.injectNlogo(e):e},u=o.reduce(c,i),l=function(e,t){return null!=t.getExtraCommands?e.concat(t.getExtraCommands()):e},s=o.reduce(l,[]),(d=a.fromNlogo(u,s)).model.success?(d.code=i===u?d.code:V(i)[0].slice(0,-1),r({type:"success",session:zo(e,t,n,a,o,d,!1)}),d.commands.forEach((function(e){if(e.success)return new Function(e.result)()})),o.forEach((function(e){return"function"==typeof e.compileComplete?e.compileComplete():void 0}))):null!=(h=To(i,a))?(r({type:"failure",source:"compile-recoverable",session:zo(e,t,n,a,o,h,!0),errors:d.model.result}),d.commands.forEach((function(e){if(e.success)return new Function(e.result)()})),o.forEach((function(e){return"function"==typeof e.compileComplete?e.compileComplete():void 0}))):r({type:"failure",source:"compile-fatal",errors:d.model.result})},To=function(e,t){var n,i,r,o;return 12!==(o=V(e)).length?null:(i=o[0].slice(0,-1),o[0]="",n=j(o),(r=t.fromNlogo(n,[])).model.success?(r.code=i,r):null)},_o={startLoading:Bo=function(e){document.querySelector("#loading-overlay").style.display="",null!=e&&setTimeout(e,20)},finishLoading:Eo=function(){document.querySelector("#loading-overlay").style.display="none"},fromNlogo:So,fromNlogoSync:Ao,fromURL:Po},Lo=eval;var Oo,Ro=_o,No=document.getElementById("loading-overlay"),Uo=No,Do=document.querySelector("#netlogo-model-container"),Vo=document.querySelector("#nlogo-code"),Fo=function(e){return null!=e&&""!=e?"NetLogo Web: "+e:"NetLogo Web"},$o=0,jo=function(e){(Oo=e).widgetController.ractive.set("speed",$o),document.title=Fo(Oo.modelTitle()),Uo=Do,Oo.startLoop(),Yo.listenForErrors(Oo.widgetController)};const Wo=Vo.textContent.length>0,Ho=parent!==window,Yo=new L(document.getElementById("alert-container"),Wo),Xo=document.getElementById("alert-dialog");function qo(e){"success"===e.type?jo(e.session):("compile-recoverable"===e.source?jo(e.session):(Uo=Xo,No.style.display="none"),Yo.reportCompilerErrors(e.source,e.errors))}var Go=function(e,t){Yo.hide(),Oo&&Oo.teardown(),Uo=No,Ro.fromNlogo(e,Do,t,qo)};const Zo=function(e){return e.has("speed")?(t=-1,n=1,i=function(e,t){const n=Number.parseFloat(e);return NaN!==n?n:t}(e.get("speed"),0),Math.max(t,Math.min(n,i))):0;var t,n,i};if(Vo.textContent.length>0){const e=Vo.textContent,t=Vo.dataset.filename,n=new URLSearchParams(window.location.search);$o=Zo(n),Ro.fromNlogo(e,Do,t,qo)}else if(window.location.search.length>0){const e=new URLSearchParams(window.location.search),t=e.has("url")?e.get("url"):window.location.search.slice(1),n=e.has("name")?decodeURI(e.get("name")):void 0;$o=Zo(e),function(e){const t=new URL(e);if("https:"===t.protocol||"http:"===window.location.protocol)return!0;const n=window.location,i=t.hostname===n.hostname,r=i&&window.debugMode?"9443":"443",o=`https://${t.hostname}:${r}${t.pathname}`;if(!i&&Ho)return Yo.reportProtocolError(t,o),Uo=Xo,No.style.display="none",!1;const a=new URLSearchParams(window.location.search);var s="";a.has("url")?(a.set("url",o),s=a.toString()):s=o;const l=`https://${n.host}${n.pathname}?${s}`;return i?(window.location.href=l,!1):(Yo.reportProtocolError(t,o,l),Uo=Xo,No.style.display="none",!1)}(t)&&Ro.fromURL(t,n,Do,qo)}else Go(O,"NewModel");if(window.addEventListener("message",(function(e){switch(e.data.type){case"nlw-load-model":Go(e.data.nlogo,e.data.path);break;case"nlw-open-new":Go(O,"NewModel");break;case"nlw-update-model-state":Oo.widgetController.setCode(e.data.codeTabContents);break;case"run-baby-behaviorspace":Oo.asyncRunBabyBehaviorSpace(e.data.config,(function(t){e.source.postMessage({type:"baby-behaviorspace-results",id:e.data.id,data:t},"*")}));break;case"nlw-export-model":var t=Oo.getNlogo();e.source.postMessage({type:"nlw-export-model-results",id:e.data.id,export:t},"*")}})),Ho){var Ko="",Jo="";window.setInterval((function(){(Uo.offsetWidth!==Ko||Uo.offsetHeight!==Jo||void 0!==Oo&&document.title!=Fo(Oo.modelTitle()))&&(void 0!==Oo&&(document.title=Fo(Oo.modelTitle())),Ko=Uo.offsetWidth,Jo=Uo.offsetHeight,parent.postMessage({width:Uo.offsetWidth,height:Uo.offsetHeight,title:document.title,type:"nlw-resize"},"*"))}),200)}